<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>其他 on chestnut's blog</title><link>https://www.ch35tnut.site/zh-cn/others/</link><description>Recent content in 其他 on chestnut's blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 09 Nov 2021 22:18:45 +0800</lastBuildDate><atom:link href="https://www.ch35tnut.site/zh-cn/others/index.xml" rel="self" type="application/rss+xml"/><item><title>给hugo-theme-learn增加timeline功能</title><link>https://www.ch35tnut.site/zh-cn/others/add-timeline-shortcode/</link><pubDate>Mon, 05 Sep 2022 18:12:58 +0800</pubDate><guid>https://www.ch35tnut.site/zh-cn/others/add-timeline-shortcode/</guid><description><h3 id="前言">前言</h3><p>现在使用hugo-theme-learn主题，但这个主题没有提供时间线功能，为了给首页增加时间线功能，花了两天研究了一下怎么添加时间线功能。</p><p>为了方便增加时间线的事件，采用自定义shortcode的方式增加时间线，代码大部分参考引用链接里面的，魔改了一下以适应自己的主题，增加了过去多少天的显示。</p><h3 id="代码实现">代码实现</h3><p>在<code>layout/shortcodes</code>新增文件：<code>event.html</code>和<code>timeline.html</code>，内容分别如下</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>event.html</span></span><span style="display:flex;"><span>{{$duration := ""}}</span></span><span style="display:flex;"><span>{{$to := now }}</span></span><span style="display:flex;"><span>{{ if ne (.Get "to") ""}}</span></span><span style="display:flex;"><span>{{$to = time (.Get "to") }}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span>{{$enabledTime := ne (.Get "from") ""}}</span></span><span style="display:flex;"><span>{{if $enabledTime }}</span></span><span style="display:flex;"><span>{{$from := time (.Get "from") }}</span></span><span style="display:flex;"><span>{{ $diff := $to.Sub $from }}</span></span><span style="display:flex;"><span>{{ $days := div $diff.Hours 24 | math.Round }}</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span>{{$tmonths:=mul ($to.Sub $from).Hours 0.00136986301 }}</span></span><span style="display:flex;"><span>{{$months := mod $tmonths 12 }}</span></span><span style="display:flex;"><span>{{$years := math.Floor (div $tmonths 12)}}</span></span><span style="display:flex;"><span>{{$yearStr := "years"}}</span></span><span style="display:flex;"><span>{{if lt $years 2 }}</span></span><span style="display:flex;"><span>{{$yearStr = "year"}}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span>{{$monthStr := "months"}}</span></span><span style="display:flex;"><span>{{if lt $months 2 }}</span></span><span style="display:flex;"><span>{{$monthStr = "month"}}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span>{{$daysStr := "days"}}</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span>{{ $idays :=int $days }}</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span>{{$duration = ""}}</span></span><span style="display:flex;"><span>{{if gt $years 0 }}</span></span><span style="display:flex;"><span>{{$duration = printf "%s %.0f %s" $duration $years $yearStr}}</span></span><span style="display:flex;"><span>{{$idays = sub $idays (mul 365 $years)}}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span>{{if gt $months 0 }}</span></span><span style="display:flex;"><span>{{$duration = printf "%s %d %s" $duration $months $monthStr}}</span></span><span style="display:flex;"><span>{{$idays = sub $idays (mul 30 $months)}}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span>{{$idays = int $idays}}</span></span><span style="display:flex;"><span>{{if gt $idays 0}}</span></span><span style="display:flex;"><span>{{if lt $idays 2}}</span></span><span style="display:flex;"><span>{{$daysStr = "day"}}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span>{{$duration = printf "%s %d %s" $duration $idays $daysStr}}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span>{{end}}</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span>{{ $from := .Get "from" | time }}</span></span><span style="display:flex;"><span>{{ $to := now }}</span></span><span style="display:flex;"><span>{{ $diff := $to.Sub $from }}</span></span><span style="display:flex;"><span>{{ $ago := div $diff.Hours 24 | math.Round }}</span></span><span style="display:flex;"><span>{{ $measure := cond (eq 1 $ago) "day" "days" }}</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span>{{ $seed := "foo" }}</span></span><span style="display:flex;"><span>{{ $random := delimit (shuffle (split (md5 $seed) "" )) "" }}</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">"container"</span>></span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">"content"</span>></span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">"title"</span>>{{.Get "title"}}&lt;/<span style="color:#f92672">div</span>></span></span><span style="display:flex;"><span> {{if $enabledTime }}</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">"moment"</span><span style="color:#960050;background-color:#1e0010">{{</span><span style="color:#a6e22e">if</span><span style="color:#a6e22e">eq</span><span style="color:#960050;background-color:#1e0010">.</span><span style="color:#a6e22e">Ordinal</span><span style="color:#a6e22e">0</span><span style="color:#960050;background-color:#1e0010">}}</span><span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">"moment"</span><span style="color:#960050;background-color:#1e0010">{{</span><span style="color:#a6e22e">end</span><span style="color:#960050;background-color:#1e0010">}}</span><span style="color:#960050;background-color:#1e0010">{{</span><span style="color:#a6e22e">if</span><span style="color:#a6e22e">ne</span><span style="color:#960050;background-color:#1e0010">.</span><span style="color:#a6e22e">Ordinal</span><span style="color:#a6e22e">0</span><span style="color:#960050;background-color:#1e0010">}}</span><span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">"moment-{{ substr $random 0 16}}"</span><span style="color:#960050;background-color:#1e0010">{{</span><span style="color:#a6e22e">end</span><span style="color:#960050;background-color:#1e0010">}}</span>></span></span><span style="display:flex;"><span> {{ if ne .Ordinal 0 }} {{$duration}} {{ end }} | {{ $ago }} {{ $measure}} ago</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">div</span>></span></span><span style="display:flex;"><span> {{ end }}</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">"body"</span>></span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span> {{.Inner}}</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">div</span>></span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">div</span>></span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">div</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">"date"</span>>{{$to.Year}}&lt;/<span style="color:#f92672">div</span>></span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>></span></span><span style="display:flex;"><span>{{ if and (eq (.Ordinal) 0) $enabledTime }}</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>></span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span><span style="color:#a6e22e">non0plural</span>(<span style="color:#a6e22e">number</span>,<span style="color:#a6e22e">name</span>) {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">number</span><span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>) {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span><span style="color:#e6db74">""</span></span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">number</span><span style="color:#f92672">></span><span style="color:#ae81ff">1</span>) {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span><span style="color:#a6e22e">number</span><span style="color:#f92672">+</span><span style="color:#e6db74">" "</span><span style="color:#f92672">+</span><span style="color:#a6e22e">name</span><span style="color:#f92672">+</span><span style="color:#e6db74">"s"</span></span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span><span style="color:#a6e22e">number</span><span style="color:#f92672">+</span><span style="color:#e6db74">" "</span><span style="color:#f92672">+</span><span style="color:#a6e22e">name</span></span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span><span style="color:#a6e22e">refresh</span>() {</span></span><span style="display:flex;"><span><span style="color:#a6e22e">start</span><span style="color:#f92672">=</span><span style="color:#a6e22e">dayjs</span>({{.<span style="color:#a6e22e">Get</span><span style="color:#e6db74">"from"</span>}})</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#a6e22e">now</span><span style="color:#f92672">=</span><span style="color:#a6e22e">dayjs</span>()</span></span><span style="display:flex;"><span><span style="color:#a6e22e">total_days</span><span style="color:#f92672">=</span><span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">diff</span>(<span style="color:#a6e22e">start</span>,<span style="color:#e6db74">"d"</span>,<span style="color:#66d9ef">true</span>)</span></span><span style="display:flex;"><span><span style="color:#a6e22e">total_months</span><span style="color:#f92672">=</span><span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">diff</span>(<span style="color:#a6e22e">start</span>,<span style="color:#e6db74">"M"</span>,<span style="color:#66d9ef">true</span>)</span></span><span style="display:flex;"><span><span style="color:#a6e22e">months</span><span style="color:#f92672">=</span><span style="color:#a6e22e">total_months</span><span style="color:#f92672">%</span><span style="color:#ae81ff">12</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">years</span><span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">floor</span>((<span style="color:#a6e22e">total_months</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">12</span>)</span></span><span style="display:flex;"><span><span style="color:#75715e">// for (var i = 0, els = document.querySelectorAll(`[id^="moment"]`); i &lt; els.length; i++) {</span></span></span><span style="display:flex;"><span><span style="color:#75715e"/><span style="color:#75715e">// els[i].innerHTML = non0plural(years, "year") + " " + non0plural(months.toFixed(8), "month")</span></span></span><span style="display:flex;"><span><span style="color:#75715e"/><span style="color:#75715e">// }</span></span></span><span style="display:flex;"><span><span style="color:#75715e"/><span style="color:#75715e">// 如果月份大于1则</span></span></span><span style="display:flex;"><span><span style="color:#75715e"/><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">years</span><span style="color:#f92672">>=</span><span style="color:#ae81ff">1</span>){</span></span><span style="display:flex;"><span><span style="color:#a6e22e">total_days</span><span style="color:#f92672">-=</span><span style="color:#ae81ff">365</span><span style="color:#f92672">*</span><span style="color:#a6e22e">years</span></span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">months</span><span style="color:#f92672">>=</span><span style="color:#ae81ff">1</span>){</span></span><span style="display:flex;"><span><span style="color:#a6e22e">total_days</span><span style="color:#f92672">-=</span><span style="color:#ae81ff">30</span><span style="color:#f92672">*</span><span style="color:#a6e22e">months</span></span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span><span style="color:#a6e22e">el</span><span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">"#moment"</span>);</span></span><span style="display:flex;"><span><span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">innerHTML</span><span style="color:#f92672">=</span><span style="color:#a6e22e">years</span><span style="color:#f92672">></span><span style="color:#ae81ff">1</span><span style="color:#f92672">?</span><span style="color:#a6e22e">non0plural</span>(<span style="color:#a6e22e">years</span>,<span style="color:#e6db74">"year"</span>)<span style="color:#f92672">:</span><span style="color:#e6db74">""</span><span style="color:#f92672">+</span><span style="color:#e6db74">" "</span><span style="color:#f92672">+</span><span style="color:#a6e22e">months</span><span style="color:#f92672">></span><span style="color:#ae81ff">1</span><span style="color:#f92672">?</span><span style="color:#a6e22e">non0plural</span>(<span style="color:#a6e22e">months</span>.<span style="color:#a6e22e">toFixed</span>(<span style="color:#ae81ff">4</span>),<span style="color:#e6db74">"month"</span>)<span style="color:#f92672">:</span><span style="color:#e6db74">""</span><span style="color:#f92672">+</span><span style="color:#a6e22e">total_days</span><span style="color:#f92672">>=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">?</span><span style="color:#a6e22e">non0plural</span>(<span style="color:#a6e22e">total_days</span>.<span style="color:#a6e22e">toFixed</span>(<span style="color:#ae81ff">2</span>),<span style="color:#e6db74">"day"</span>)<span style="color:#f92672">:</span><span style="color:#e6db74">""</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">innerHTML</span><span style="color:#f92672">=</span><span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">innerHTML</span><span style="color:#f92672">+</span><span style="color:#e6db74">" ago"</span></span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span> window.<span style="color:#a6e22e">setInterval</span>(<span style="color:#a6e22e">refresh</span>,<span style="color:#ae81ff">100</span>);</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>></span></span><span style="display:flex;"><span>{{ end }}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>timeline.html</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">style</span><span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">"text/css"</span>></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">relative</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">margin</span>:<span style="color:#ae81ff">0</span><span style="color:#66d9ef">auto</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* The actual timeline (the vertical ruler) */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span>::<span style="color:#a6e22e">after</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">content</span>:<span style="color:#e6db74">""</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">absolute</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">width</span>:<span style="color:#ae81ff">6</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">background-color</span>:<span style="color:#ae81ff">#444</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">top</span>:<span style="color:#ae81ff">0</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">bottom</span>:<span style="color:#ae81ff">0</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">10</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">margin-left</span>:<span style="color:#ae81ff">-3</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* Container around content */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">container</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">padding</span>:<span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">40</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">margin-top</span>:<span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">relative</span>;</span></span><span style="display:flex;"><span><span style="color:#75715e">/* background-color: gray; */</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">width</span>:<span style="color:#ae81ff">90</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">10</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* The circles on the timeline */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">container</span>::<span style="color:#a6e22e">after</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">content</span>:<span style="color:#e6db74">""</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">absolute</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">width</span>:<span style="color:#ae81ff">25</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">height</span>:<span style="color:#ae81ff">25</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">-12</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">background-color</span>: rgb(<span style="color:#ae81ff">106</span>,<span style="color:#ae81ff">215</span>,<span style="color:#ae81ff">229</span>);</span></span><span style="display:flex;"><span><span style="color:#66d9ef">border</span>:<span style="color:#ae81ff">4</span><span style="color:#66d9ef">px</span><span style="color:#66d9ef">solid</span><span style="color:#ae81ff">#444</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">top</span>:<span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">border-radius</span>:<span style="color:#ae81ff">50</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">z-index</span>:<span style="color:#ae81ff">1</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* date display */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">container</span> .<span style="color:#a6e22e">date</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">absolute</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">top</span>:<span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">z-index</span>:<span style="color:#ae81ff">1</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">-15</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">font-size</span>:<span style="color:#66d9ef">large</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* Add arrows to the right container (pointing left) */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">container</span>::<span style="color:#a6e22e">before</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">content</span>:<span style="color:#e6db74">" "</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">height</span>:<span style="color:#ae81ff">0</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">absolute</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">top</span>:<span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">width</span>:<span style="color:#ae81ff">0</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">z-index</span>:<span style="color:#ae81ff">1</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">26</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">border</span>:<span style="color:#66d9ef">medium</span><span style="color:#66d9ef">solid</span><span style="color:#ae81ff">#6ad7e5</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">border-width</span>:<span style="color:#ae81ff">13</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">13</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">13</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">border-color</span>:<span style="color:#ae81ff">#6ad7e5</span><span style="color:#ae81ff">#6ad7e5</span><span style="color:#66d9ef">transparent</span><span style="color:#66d9ef">transparent</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* The actual content */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">content</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">box-shadow</span>:<span style="color:#ae81ff">0</span><span style="color:#ae81ff">0</span><span style="color:#ae81ff">3</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">3</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">#6ad7e5</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">background-color</span>:<span style="color:#66d9ef">white</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">relative</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">border-radius</span>:<span style="color:#ae81ff">6</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">transition</span>:<span style="color:#66d9ef">box-shadow</span><span style="color:#ae81ff">0.3</span><span style="color:#66d9ef">s</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* small shadow change on hover*/</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">content</span>:<span style="color:#a6e22e">hover</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">box-shadow</span>:<span style="color:#ae81ff">0</span><span style="color:#ae81ff">0</span><span style="color:#ae81ff">3</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">4</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">#6ad7e5</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* card title format */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">content</span> .<span style="color:#a6e22e">title</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">padding</span>:<span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">font-weight</span>:<span style="color:#66d9ef">bold</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">display</span>:<span style="color:#66d9ef">inline-block</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* time moment format*/</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">content</span> .<span style="color:#a6e22e">moment</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">color</span>:<span style="color:#ae81ff">#c41a16</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">text-align</span>:<span style="color:#66d9ef">right</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">absolute</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">top</span>:<span style="color:#ae81ff">0</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">right</span>:<span style="color:#ae81ff">0</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">padding</span>:<span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* body size */</span></span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">content</span> .<span style="color:#a6e22e">body</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">padding</span>:<span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">word-wrap</span>:<span style="color:#66d9ef">break-word</span>;</span></span><span style="display:flex;"><span><span style="color:#75715e">/* height: 73px; */</span></span></span><span style="display:flex;"><span><span style="color:#75715e">/* max-height: 120px; */</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">text-overflow</span>:<span style="color:#66d9ef">ellipsis</span>;</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#66d9ef">overflow</span>:<span style="color:#66d9ef">hidden</span>;</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span><span style="color:#75715e">/* responsive for small devices*/</span></span></span><span style="display:flex;"><span> @<span style="color:#66d9ef">media</span><span style="color:#f92672">screen</span><span style="color:#f92672">and</span><span style="color:#f92672">(</span><span style="color:#f92672">max-width</span><span style="color:#f92672">:</span><span style="color:#f92672">600px</span><span style="color:#f92672">)</span> {</span></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">container</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">padding</span>:<span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">10</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">40</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">5</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">width</span>:<span style="color:#ae81ff">95</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">container</span> .<span style="color:#a6e22e">date</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">font-size</span>:<span style="color:#66d9ef">small</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">transform</span>: rotate(<span style="color:#ae81ff">-90</span><span style="color:#66d9ef">deg</span>);</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">-5</span><span style="color:#66d9ef">%</span>;</span></span><span style="display:flex;"><span><span style="color:#66d9ef">top</span>:<span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">container</span>::<span style="color:#a6e22e">after</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span>:<span style="color:#ae81ff">3</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">content</span> .<span style="color:#a6e22e">body</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">padding</span>:<span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span><span style="color:#ae81ff">5</span><span style="color:#66d9ef">px</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span/></span><span style="display:flex;"><span> .<span style="color:#a6e22e">timeline</span> .<span style="color:#a6e22e">content</span> .<span style="color:#a6e22e">moment</span> {</span></span><span style="display:flex;"><span><span style="color:#66d9ef">position</span>:<span style="color:#66d9ef">relative</span>;</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span> }</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">style</span>></span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span><span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">"timeline"</span>></span></span><span style="display:flex;"><span> {{ .Inner }}</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>></span></span></code></pre></div><p>由于event.html里面引用了<code>dayjs</code>，这个js不在当前主题内，可以在config.toml新增<code>custom_js = ["js/dayjs.min.js"]</code>，然后把dayjs.min.js放在<code>theme\hugo-theme-learn\static\js</code>目录内，即可解决导入<code>dayjs</code>的问题。</p><p>此时可以在需要添加时间线的地方使用<code>timeline</code>的shortcode添加，以下是我博客首页的时间线代码：</p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>{{&lt; timeline >}}</span></span><span style="display:flex;"><span> {{% event title="09-03至09-04" from="2022-09-03" to="2022-09-04" %}}</span></span><span style="display:flex;"><span>这两天，给hugo主题增加了timeline的shortcode，见[增加timeline功能](others/add-timeline-shortcode)</span></span><span style="display:flex;"><span> {{% /event %}}</span></span><span style="display:flex;"><span> {{% event title="08-29至09-02" from="2022-08-29" to="2022-09-02" %}}</span></span><span style="display:flex;"><span>周内审计了代码</span></span><span style="display:flex;"><span> {{% /event %}}</span></span><span style="display:flex;"><span>{{&lt; /timeline >}}</span></span></code></pre></div><p>除了这个还顺便给博客新增了基于Github issue的评论功能，参考<a href="https://utteranc.es/" target="_blank">utteranc</a>。</p><p><strong>参考</strong></p><blockquote><p><a href="https://metalblueberry.github.io/post/howto/2021-02-28_hugo_timeline_shortcode/" target="_blank">https://metalblueberry.github.io/post/howto/2021-02-28_hugo_timeline_shortcode/</a></p></blockquote></description></item><item><title>在Windows server 2019上重置密码</title><link>https://www.ch35tnut.site/zh-cn/others/how-to-reset-password-administrator-on-windows-server-2019/</link><pubDate>Wed, 17 Nov 2021 14:40:40 +0800</pubDate><guid>https://www.ch35tnut.site/zh-cn/others/how-to-reset-password-administrator-on-windows-server-2019/</guid><description><h2 id="重置windows-server-2019的administrator密码">重置windows server 2019的administrator密码</h2><p>之前在Vmware上的Windows server 2019的Administrator密码忘记了，使用网上的方法时找不到用PE启动系统的办法，无奈只能使用其他办法。写此文记录一下。</p><h3 id="设置cddvd">设置CD/DVD</h3><p>首先在虚拟机-设置的硬件选项卡下面的CD/DVD设置为使用ISO映像文件并找到windows server 2019镜像位置，如下图</p><p><img alt="image-20211117145213632" src="/images/others/how-to-reset-password-administrator-on-windows-server-2019.assets/image-20211117145213632.png"/></p><p>之后选择虚拟机-电源-开机时打开固件启动虚拟机，虚拟机就会进入BIOS，在BIOS里选择CD/DVD启动，即会进入下图。</p><p><img src="https://www.osradar.com/wp-content/uploads/2019/10/pass-1024x768.jpeg" alt="Windows Server 2019 Installation screen" path="others/" if="others/how-to-reset-password-administrator-on-windows-server-2019.zh-cn.md"/></p><p>参考链接</p><blockquote><p><a href="https://www.osradar.com/how-to-reset-password-administrator-on-windows-server-2019/" target="_blank">https://www.osradar.com/how-to-reset-password-administrator-on-windows-server-2019/</a></p></blockquote></description></item><item><title>基于Vmware的小型域网络搭建</title><link>https://www.ch35tnut.site/zh-cn/others/vmware-based-implementation-of-small-domain-network-construction/</link><pubDate>Wed, 08 Sep 2021 21:14:32 +0800</pubDate><guid>https://www.ch35tnut.site/zh-cn/others/vmware-based-implementation-of-small-domain-network-construction/</guid><description><h2 id="基于vmware的小型域网络搭建">基于Vmware的小型域网络搭建</h2><h3 id="摘要">摘要</h3><p>在渗透的日常学习过程中经常需要一个内网环境，本篇文章介绍如何使用Vmware和MikroTik搭建简易的二层内网环境。</p><h3 id="网络结构">网络结构</h3><p>整个网络分为结构分为三层，第一层模拟外网环境，第二层为DMZ区域，该区域通过边界路由器的端口映射，将第二层网络主机的一些端口映射到边界路由器上对外提供服务，第三层模拟办公网，该层网络为域网络，同时可以控制第二层网络的主机。</p><p>整个网络拓扑图如下：</p><p><img alt="拓扑图" src="/images/others/vmware-based-implementation-of-small-domain-network-construction.zh-cn.assets/%E6%8B%93%E6%89%91%E5%9B%BE.png"/></p><p>IP设置：</p><p>第一层网络为（外网）：192.168.59.0/24</p><p>第二层网络为（DMZ区域）：192.168.72.0/24</p><p>第三层网络为（办公网）：172.16.2.0/24</p><p>路由器IP地址：</p><p>边界路由器：192.168.59.141 | 192.168.72.2</p><p>内网路由器：192.168.72.254 | 172.16.2.254</p><h3 id="网络搭建">网络搭建</h3><h4 id="网络设置">网络设置</h4><p>首先使用VMware的虚拟网络编辑器增加两个网络VMnet2、VMnet3，都勾选仅主机模式，同时取消下面两个勾，如下图：</p><p><img alt="虚拟网络编辑器图" src="/images/others/vmware-based-implementation-of-small-domain-network-construction.zh-cn.assets/vmnet2.png"/></p><p>VMnet3同理，同时在DHCP设置处设置相应的IP地址和掩码。其中外层网络为nat模式，VMnet2为DMZ区域网络，VMnet3为办公网络</p><h4 id="虚拟机搭建">虚拟机搭建</h4><p>整个网络在最少情况下一共需要六台虚拟机，分为两台ROS，四台网络中的主机。</p><p>ROS从hxxps://mikrotik.com/download下载stable版本的ova格式的镜像，之后导入到VMware中。一共需要导入两次，分别命名为ROS，ROS-1。除了下载镜像之外还需要下载winbox方便对路由器进行设置。</p><p>网络中主机分布：</p><p>DMZ：Ubuntu 2004、windows7</p><p>办公网：Windows server2019、windows7</p><p>创建上述虚拟机，并将DMZ区域的主机的网卡设置为VMnet2，办公网的主机设置为VMnet3.</p><p>将边界路由器ROS网卡设置为net模式和VMnet2模式，内网路由器设置为VMnet2和VMnet3模式。</p><h4 id="ip地址及路由器设置">IP地址及路由器设置</h4><p>经历上面的步骤之后，基本的网络拓扑已经搭建完成，接下来需要对网络内的主机和路由器进行设置使得网络中的主机能够相互ping通。</p><p>首先设置两个网络中的主机IP地址</p><p>DMZ：</p><p>Windows7：192.168.72.4/24 网关192.168.72.2 DNS114.114.114.114</p><p>Ubuntu ：192.168.72.3/24 网关192.168.72.2 DNS114.</p><p>114.114.114</p><p>办公网：</p><p>Windows server 2019：172.16.2.4/24 网关172.16. 2.254 DNS127.0.0.1</p><p>windows7：172.16.2.3/24 网关172.16.2.254 DNS172.16.2.4</p><p>至此，两个网络的主机应该可以ping通同一个网络的主机。接下来设置两个ROS的IP地址。</p><p>打开winbox，点击Neighbors按钮，会自动嗅探网络内的存活的路由器，如下图所示。</p><p><img alt="winbox界面" src="/images/others/vmware-based-implementation-of-small-domain-network-construction.zh-cn.assets/winbox.png"/></p><p>上图为边界路由器的IP地址，如果分配了IP地址则可以在浏览器通过IP地址浏览路由器的web界面，在如果没有分配IP地址则通过wibbox使用MAC地址登录</p><p><img alt="" src="/images/others/vmware-based-implementation-of-small-domain-network-construction.zh-cn.assets/winbox-mac.png"/></p><p><img alt="接口列表" src="/images/others/vmware-based-implementation-of-small-domain-network-construction.zh-cn.assets/ros.png"/></p><p>进入之后，在左侧选项卡会列出路由器拥有的所有网卡接口，点击之后进入到接口详情界面，在里面会列出该接口的一些基本信息，可以通过网卡的MAC分辨该网卡对应在vmware中的网卡，将两个网卡名称分别设置为ether1-wan和ether2-lan，之后在ip->addresses选项卡中将ether-lan设置为下图。ether1-wan不用设置，因为该网卡网络类型为nat会自动dhcp分配</p><p><img alt="ether2-lanIP地址设置" src="/images/others/vmware-based-implementation-of-small-domain-network-construction.zh-cn.assets/ether.png"/></p><p>之后在IP->Firewall->NAT中新建规则，chain：srcnat，out.interface:ether2-lan,action:masquerade</p><p>该规则将使得路由器两边的网络联通。</p><p><img alt="NAT规则" src="/images/others/vmware-based-implementation-of-small-domain-network-construction.zh-cn.assets/nat.png"/></p><p>参考</p><blockquote><p><a href="https://www.huaweicloud.com/articles/401014315f14d0fb8d5e3f5489693621.html" target="_blank">https://www.huaweicloud.com/articles/401014315f14d0fb8d5e3f5489693621.html</a><a href="http://www.roszj.com/1692.html" target="_blank">http://www.roszj.com/1692.html</a><a href="http://www.irouteros.com/?p=583" target="_blank">http://www.irouteros.com/?p=583</a></p></blockquote></description></item></channel></rss>